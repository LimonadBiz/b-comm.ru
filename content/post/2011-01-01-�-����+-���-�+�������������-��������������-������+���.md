---
title: 'О том как провайдеру Интернета распространять программы  с помощью Nullsoft Scriptable Install System (NSIS)'
author: wel
type: post
date: 2011-01-01T14:00:28+00:00
url: /4isp/о-том-как-провайдеру-интернета-распро
short-url:
  - http://bit.ly/i6htSS
wp-syntax-cache-content:
  - |
    a:1:{i:1;s:94731:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    103
    104
    105
    106
    107
    108
    109
    110
    111
    112
    113
    114
    115
    116
    117
    118
    119
    120
    121
    122
    123
    124
    125
    126
    127
    128
    129
    130
    131
    132
    133
    134
    135
    136
    137
    138
    139
    140
    141
    142
    143
    144
    145
    146
    147
    148
    149
    150
    151
    152
    153
    154
    155
    156
    157
    158
    159
    160
    161
    162
    163
    164
    165
    166
    167
    168
    169
    170
    171
    172
    173
    174
    175
    176
    177
    178
    179
    180
    181
    182
    183
    184
    185
    186
    187
    188
    189
    190
    191
    192
    193
    194
    195
    196
    197
    198
    199
    200
    201
    202
    203
    204
    205
    206
    207
    208
    209
    210
    211
    212
    213
    214
    215
    216
    217
    218
    219
    220
    221
    222
    223
    224
    225
    226
    227
    228
    229
    230
    231
    232
    233
    234
    235
    236
    237
    238
    239
    240
    241
    242
    243
    244
    245
    246
    247
    248
    249
    250
    251
    252
    253
    254
    255
    256
    257
    258
    259
    260
    261
    262
    263
    264
    265
    266
    267
    268
    269
    270
    271
    272
    273
    274
    275
    276
    277
    278
    279
    280
    281
    282
    283
    284
    285
    286
    287
    288
    289
    290
    291
    292
    293
    294
    295
    296
    297
    298
    299
    300
    301
    302
    303
    304
    305
    306
    307
    308
    309
    310
    311
    312
    313
    314
    315
    316
    317
    318
    319
    320
    321
    322
    323
    324
    325
    326
    327
    328
    329
    330
    331
    332
    333
    334
    335
    336
    337
    338
    339
    340
    341
    342
    343
    344
    345
    346
    347
    348
    349
    350
    351
    352
    353
    354
    355
    356
    357
    358
    359
    360
    361
    362
    363
    364
    365
    366
    367
    368
    369
    370
    371
    372
    373
    374
    375
    376
    377
    378
    379
    380
    381
    382
    383
    384
    385
    386
    387
    388
    389
    390
    391
    392
    393
    394
    395
    396
    397
    398
    399
    400
    401
    402
    403
    404
    405
    406
    407
    408
    409
    410
    411
    412
    413
    414
    415
    416
    417
    418
    419
    420
    421
    422
    423
    424
    425
    426
    427
    428
    429
    430
    431
    432
    433
    434
    435
    436
    437
    438
    439
    440
    441
    442
    443
    444
    445
    446
    447
    448
    449
    450
    451
    452
    453
    454
    455
    456
    457
    458
    459
    460
    461
    462
    463
    464
    465
    466
    467
    468
    469
    470
    471
    472
    473
    474
    475
    476
    477
    478
    479
    480
    481
    482
    483
    484
    485
    486
    487
    488
    489
    490
    491
    492
    493
    494
    495
    496
    497
    498
    499
    500
    501
    502
    503
    </pre></td><td class="code"><pre class="nsis" style="font-family:monospace;">&nbsp;
    <span style="color: #666666; font-style: italic;">; Script generated with the Venis Install Wizard</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">; Define your application name</span>
    <span style="color: #000066; font-weight:bold;">!define</span> APPNAME <span style="color: #660066;">&quot;Home&quot;</span>
    <span style="color: #000066; font-weight:bold;">!define</span> PRODUCT_VERSION <span style="color: #660066;">&quot;0.5&quot;</span>
    <span style="color: #000066; font-weight:bold;">!define</span> APPNAMEANDVERSION <span style="color: #660066;">&quot;Home pack ${PRODUCT_VERSION}&quot;</span>
    &nbsp;
      <span style="color: #000066;">VIProductVersion</span>         <span style="color: #660066;">&quot;1.${PRODUCT_VERSION}&quot;</span>
      <span style="color: #000066;">VIAddVersionKey</span>          <span style="color: #660066;">&quot;FileVersion&quot;</span>        <span style="color: #660066;">&quot;${PRODUCT_VERSION}&quot;</span> 
      <span style="color: #000066;">VIAddVersionKey</span>          <span style="color: #660066;">&quot;ProductName&quot;</span>           <span style="color: #660066;">&quot;Home pack&quot;</span>
      <span style="color: #000066;">VIAddVersionKey</span>          <span style="color: #660066;">&quot;CompanyName&quot;</span>          <span style="color: #660066;">&quot;Home&quot;</span>
      <span style="color: #000066;">VIAddVersionKey</span>          <span style="color: #660066;">&quot;LegalTrademarks&quot;</span>       <span style="color: #660066;">&quot;www.home&quot;</span>
      <span style="color: #000066;">VIAddVersionKey</span>          <span style="color: #660066;">&quot;LegalCopyright&quot;</span>        <span style="color: #660066;">&quot;CopyRights 2010© to valeranew@ukr.net&quot;</span> 
    	<span style="color: #000066;">VIAddVersionKey</span>          <span style="color: #660066;">&quot;FileDescription&quot;</span>       <span style="color: #660066;">&quot;dc++&quot;</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">; !define SF_SELECTED   1</span>
    <span style="color: #666666; font-style: italic;">; !define SF_SUBSEC     2</span>
    <span style="color: #666666; font-style: italic;">; !define SF_SUBSECEND  4</span>
    <span style="color: #666666; font-style: italic;">; !define SF_BOLD       8</span>
    <span style="color: #666666; font-style: italic;">; !define SF_RO         16</span>
    <span style="color: #666666; font-style: italic;">; !define SF_EXPAND     32</span>
    <span style="color: #666666; font-style: italic;">; !define SECTION_OFF   0xFFFFFFFE</span>
    <span style="color: #666666; font-style: italic;">; ExecShell</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">; Main Install settings</span>
    <span style="color: #000066;">Name</span> <span style="color: #660066;">&quot;${APPNAMEANDVERSION}&quot;</span>
    <span style="color: #000066;">InstallDir</span> <span style="color: #660066;">&quot;$PROGRAMFILES\Home&quot;</span>
    <span style="color: #000066;">InstallDirRegKey</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;Software\${APPNAME}&quot;</span> <span style="color: #660066;">&quot;&quot;</span>
    <span style="color: #666666; font-style: italic;">;OutFile &quot;home_pack_full.exe&quot;</span>
    <span style="color: #000066;">OutFile</span> <span style="color: #660066;">&quot;home_pack_full-${PRODUCT_VERSION}.exe&quot;</span>
    <span style="color: #666666; font-style: italic;">; Modern interface settings</span>
    <span style="color: #000066; font-weight:bold;">!include</span> <span style="color: #660066;">&quot;MUI2.nsh&quot;</span>
    <span style="color: #666666; font-style: italic;">;kill</span>
    <span style="color: #000066; font-weight:bold;">!include</span> <span style="color: #660066;">&quot;nsProcess.nsh&quot;</span>
    <span style="color: #000066; font-weight:bold;">!include</span> <span style="color: #660066;">&quot;Sections.nsh&quot;</span>
    &nbsp;
      <span style="color: #000066; font-weight:bold;">!define</span> <span style="color: #006600;">MUI_HEADERIMAGE</span>
      <span style="color: #000066; font-weight:bold;">!define</span> <span style="color: #006600;">MUI_HEADERIMAGE_BITMAP</span> <span style="color: #660066;">&quot;logo.bmp&quot;</span> <span style="color: #666666; font-style: italic;">; optional</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">;!define MUI_COMPONENTSPAGE_SMALLDESC</span>
    <span style="color: #000066; font-weight:bold;">!define</span> <span style="color: #006600;">MUI_INSTFILESPAGE_COLORS</span> <span style="color: #660066;">&quot;FFFFFF 000000&quot;</span> <span style="color: #666666; font-style: italic;">;Два цвета</span>
    &nbsp;
    &nbsp;
    <span style="color: #000066; font-weight:bold;">!define</span> <span style="color: #006600;">MUI_ABORTWARNING</span>
    <span style="color: #000066; font-weight:bold;">!define</span> <span style="color: #006600;">MUI_FINISHPAGE_RUN_NOTCHECKED</span>
    <span style="color: #000066; font-weight:bold;">!define</span> <span style="color: #006600;">MUI_FINISHPAGE_RUN_TEXT</span> <span style="color: #660066;">&quot;Выберите что бы запустить DC++&quot;</span>
    <span style="color: #000066; font-weight:bold;">!define</span> <span style="color: #006600;">MUI_FINISHPAGE_RUN</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\greylink.exe&quot;</span>
    &nbsp;
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_PAGE_WELCOME</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_PAGE_LICENSE</span> <span style="color: #660066;">&quot;License.txt&quot;</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_PAGE_COMPONENTS</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_PAGE_DIRECTORY</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_PAGE_INSTFILES</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_PAGE_FINISH</span>
    &nbsp;
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_UNPAGE_CONFIRM</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_UNPAGE_INSTFILES</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">; Set languages (first is default language)</span>
    <span style="color: #666666; font-style: italic;">;!insertmacro MUI_LANGUAGE &quot;English&quot;</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_LANGUAGE</span> <span style="color: #660066;">&quot;Russian&quot;</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_RESERVEFILE_LANGDLL</span>
    &nbsp;
    &nbsp;
    <span style="color: #000066;">Section</span> /o  <span style="color: #660066;">&quot;Windows x86 32bit&quot;</span> Section1
    &nbsp;
    	<span style="color: #666666; font-style: italic;">; Set Section properties</span>
    	<span style="color: #003366;">SetOverwrite</span> <span style="color: #ff6600;">on</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">; Set Section Files and Shortcuts</span>
    	<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\&quot;</span>
    	<span style="color: #000099;">File</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;greylink0025\greylink\*.*&quot;</span>
    &nbsp;
    	<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\homenet\&quot;</span>
    	<span style="color: #000099;">File</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;homenet_tool\*.*&quot;</span>
    &nbsp;
    	<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\tightvnc\&quot;</span>
    	<span style="color: #000099;">File</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;tightvnc\*.*&quot;</span>
    &nbsp;
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$DESKTOP\Greylink.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\greylink.exe&quot;</span>
    	<span style="color: #000099;">CreateDirectory</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\ping_test.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\homenet\ping.exe&quot;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">;сайты</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Сайт Home.lnk&quot;</span> <span style="color: #660066;">&quot;http://home/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$DESKTOP\Сайт Home.lnk&quot;</span> <span style="color: #660066;">&quot;http://home/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\homenet.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\WinMTR.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\winmtr_0.8\WinMTR.exe&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Статистика Интернета.lnk&quot;</span> <span style="color: #660066;">&quot;https://stat/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$DESKTOP\Статистика Интернета.lnk&quot;</span> <span style="color: #660066;">&quot;https://stat/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Медиасервер.lnk&quot;</span> <span style="color: #660066;">&quot;http://media.home/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\mediahome.ico&quot;</span>
    &nbsp;
    &nbsp;
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Greylink.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\greylink.exe&quot;</span>
      <span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\VNC.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\tightvnc\WinVNC.exe&quot;</span>
    &nbsp;
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Uninstall.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\uninstall.exe&quot;</span>
    		<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\IPTV.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\IPTVplayer\IpTvPlayer.exe&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;IPTV beta1&quot;</span> Section11
    	<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\IPTVplayer&quot;</span>
    &nbsp;
    	<span style="color: #000099;">File</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;IP-TV_Playerb1\*.*&quot;</span>
    &nbsp;
    	<span style="color: #000066;">SectionEnd</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;Windows x64 64bit&quot;</span> Section2
    &nbsp;
    	<span style="color: #666666; font-style: italic;">; Set Section properties</span>
    	<span style="color: #003366;">SetOverwrite</span> <span style="color: #ff6600;">on</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">; Set Section Files and Shortcuts</span>
    	<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\&quot;</span>
    	<span style="color: #000099;">File</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;greylink0022-x64\greylink\*.*&quot;</span>
    &nbsp;
    	<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\home\&quot;</span>
    	<span style="color: #000099;">File</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;home_tool\*.*&quot;</span>
    &nbsp;
    	<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\tightvnc\&quot;</span>
    	<span style="color: #000099;">File</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;tightvnc\*.*&quot;</span>
    &nbsp;
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$DESKTOP\Greylink.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\greylink.exe&quot;</span>
    	<span style="color: #000099;">CreateDirectory</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home&quot;</span>
    &nbsp;
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\ping_test.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\ping.exe&quot;</span>
      <span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Greylink.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\greylink.exe&quot;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">;сайты</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Сайт Home-net.lnk&quot;</span> <span style="color: #660066;">&quot;http://home/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\WinMTR.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\winmtr_0.8\WinMTR.exe&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$DESKTOP\Сайт Home.lnk&quot;</span> <span style="color: #660066;">&quot;http://home/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Статистика Интернета.lnk&quot;</span> <span style="color: #660066;">&quot;https://stat/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$DESKTOP\Статистика Интернета.lnk&quot;</span> <span style="color: #660066;">&quot;https://stat/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Homenet\Медиасервер home.lnk&quot;</span> <span style="color: #660066;">&quot;http://media.home/&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\home\home.ico&quot;</span>
    &nbsp;
      <span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\VNC.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\tightvnc\WinVNC.exe&quot;</span>
    &nbsp;
    	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Uninstall.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\uninstall.exe&quot;</span>
     	<span style="color: #000099;">CreateShortCut</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\IPTV.lnk&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\IPTVplayer\IpTvPlayer.exe&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    <span style="color: #666666; font-style: italic;">;служба DHCP-клиент (DHCP Client)</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;включить DHCP-клиент&quot;</span> Section3
    	<span style="color: #666666; font-style: italic;">; Set Section properties</span>
    	<span style="color: #003366;">SetOverwrite</span> <span style="color: #ff6600;">on</span>
    	<span style="color: #000099;">GetVersion</span>::<span style="color: #003399;">WindowsName
    </span>	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;7&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;Vista&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP x64&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    <span style="color: #666666; font-style: italic;">;DNS-клиент (DNS Client)</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;включить DNS-клиент&quot;</span> Section4
    	<span style="color: #666666; font-style: italic;">; Set Section properties</span>
    	<span style="color: #003366;">SetOverwrite</span> <span style="color: #ff6600;">on</span>
    	<span style="color: #000099;">GetVersion</span>::<span style="color: #003399;">WindowsName
    </span>	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;7&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;Vista&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP x64&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">;IPSEC Services (Службы IPSEC)</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;Отключить службу IPSEC&quot;</span> Section5
    	<span style="color: #666666; font-style: italic;">; Set Section properties</span>
    	<span style="color: #003366;">SetOverwrite</span> <span style="color: #ff6600;">on</span>
    	<span style="color: #000099;">GetVersion</span>::<span style="color: #003399;">WindowsName
    </span>	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;7&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;Vista&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP x64&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">;автозагрузка ДС+++</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;автозагрузка DC++&quot;</span> Section6
    	<span style="color: #666666; font-style: italic;">;autostart </span>
    	<span style="color: #000099;">WriteRegStr</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;Software\Microsoft\Windows\CurrentVersion\Run&quot;</span> <span style="color: #660066;">&quot;home&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\greylink.exe&quot;</span>
    <span style="color: #000066;">SectionEnd</span>
    &nbsp;
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;отключить IP версии 6&quot;</span> Section7
    	<span style="color: #666666; font-style: italic;">;ipv6</span>
    	<span style="color: #000099;">GetVersion</span>::<span style="color: #003399;">WindowsName
    </span>	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;Vista&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters\&quot;</span> <span style="color: #660066;">&quot;DisabledComponents&quot;</span> <span style="color: #660066;">&quot;0xffffffff&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;7&quot;</span> <span style="">0</span> +<span style="">2</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters\&quot;</span> <span style="color: #660066;">&quot;DisabledComponents&quot;</span> <span style="color: #660066;">&quot;4294967295&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    <span style="color: #666666; font-style: italic;">;службы для создания подключения</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;службы для создания подключения&quot;</span> Section8
    	<span style="color: #666666; font-style: italic;">; Set Section properties</span>
    	<span style="color: #003366;">SetOverwrite</span> <span style="color: #ff6600;">on</span>
    	<span style="color: #666666; font-style: italic;">;Remote Access Connection Manager (Диспетчер подключений удаленного доступа)</span>
    	<span style="color: #666666; font-style: italic;">;Remote Procedure Call (Локатор удаленного вызова процедур (RPC))</span>
     	<span style="color: #666666; font-style: italic;">;Plug and Play (Plug and Play)</span>
      <span style="color: #666666; font-style: italic;">;Telephony (Телефония)</span>
    	<span style="color: #666666; font-style: italic;">;TCP/IP NetBIOS Helper Service (Модуль поддержки NetBIOS через TCP/IP)</span>
    	<span style="color: #666666; font-style: italic;">;DCOM Server Process Launcher (Запуск серверных процессов DCOM)</span>
    	<span style="color: #666666; font-style: italic;">;Server (Сервер)</span>
    	<span style="color: #000099;">GetVersion</span>::<span style="color: #003399;">WindowsName
    </span>	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;7&quot;</span> <span style="">0</span> +<span style="">8</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RasAuto&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RasMan&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\lmhosts&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\LanmanServer&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;Vista&quot;</span> <span style="">0</span> +<span style="">8</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RasAuto&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RasMan&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\lmhosts&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\LanmanServer&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP&quot;</span> <span style="">0</span> +<span style="">8</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RasMan&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\PlugPlay&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\LmHosts&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\lanmanserver&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP x64&quot;</span> <span style="">0</span> +<span style="">8</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RasMan&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\PlugPlay&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\LmHosts&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\lanmanserver&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000002&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;отключить Брандмауэр Windows&quot;</span> Section9
    	<span style="color: #666666; font-style: italic;">;ipv6</span>
    	<span style="color: #000099;">GetVersion</span>::<span style="color: #003399;">WindowsName
    </span>	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    	<span style="color: #666666; font-style: italic;">;Общий доступ к подключению к Интернету (ICS) (Internet Connection Sharing (ICS))</span>
      <span style="color: #666666; font-style: italic;">;Брандмауэр Windows (Windows Firewall)</span>
    	<span style="color: #666666; font-style: italic;">;Security Center (Центр обеспечения безопасности)</span>
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;7&quot;</span> <span style="">0</span> +<span style="">4</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\MpsSv&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;Vista&quot;</span> <span style="">0</span> +<span style="">4</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\MpsSv&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP x64&quot;</span> <span style="">0</span> +<span style="">3</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>	
    &nbsp;
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;XP&quot;</span> <span style="">0</span> +<span style="">3</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    	<span style="color: #000099;">WriteRegDWORD</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot;</span> <span style="color: #660066;">&quot;Start&quot;</span> <span style="color: #660066;">&quot;00000004&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    <span style="color: #000066;">Section</span> /o <span style="color: #660066;">&quot;Перезаписать список Хабов&quot;</span> Section10
    	<span style="color: #003366;">SetOverwrite</span> <span style="color: #ff6600;">on</span>
    	<span style="color: #666666; font-style: italic;">;		SetOutPath &quot;$INSTDIR\greylink\Settings\&quot;</span>
    	<span style="color: #666666; font-style: italic;">;		File &quot;homenet_tool\Favorites.xml&quot;</span>
    &nbsp;
    &nbsp;
    		<span style="color: #000099;">IfFileExists</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\Settings\Favorites.xml&quot;</span> <span style="">0</span> true_section10 
    		<span style="color: #000099;">MessageBox</span> <span style="color: #ff6600;">MB_YESNO</span> <span style="color: #660066;">&quot;Файл с списком Хабов существует - Вы хотите его переписать? Если Вы его перепишете то пароли от хабов потеряются!!!&quot;</span> <span style="color: #ff6600;">IDYES</span> true_section10 <span style="color: #ff6600;">IDNO</span> false_section10
    		true_section10:	
    			<span style="color: #000099;">SetOutPath</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\Settings\&quot;</span>
    			<span style="color: #000099;">File</span> <span style="color: #660066;">&quot;settings\homenet\Favorites.xml&quot;</span>
    			<span style="color: #000099;">MessageBox</span> <span style="color: #ff6600;">MB_OK</span> <span style="color: #660066;">&quot;Текущий список хабов: home: hub.home (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться.&quot;</span>
    		  <span style="color: #000099;">Goto</span> next_section10
    		false_section10:
    			<span style="color: #000099;">MessageBox</span> <span style="color: #ff6600;">MB_OK</span> <span style="color: #660066;">&quot;Текущий список хабов: home: hub.home (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться.&quot;</span>
    		next_section10:
    &nbsp;
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    &nbsp;
    <span style="color: #000066;">Function</span> <span style="color: #006600;">.onSelChange</span> 
     <span style="color: #000099;">SectionGetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section1<span style="">&#125;</span></span> <span style="color: #660000;">$1</span> 
     <span style="color: #000099;">SectionGetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section2<span style="">&#125;</span></span> <span style="color: #660000;">$2</span> 
    &nbsp;
    <span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$1</span> <span style="color: #660066;">&quot;1&quot;</span> <span style="">0</span> N1 
     <span style="color: #000099;">SectionGetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section2<span style="">&#125;</span></span> <span style="color: #660000;">$0</span> 
     <span style="color: #000099;">IntOp</span> <span style="color: #660000;">$0</span> <span style="color: #660000;">$0</span> &amp; <span style="color: #006600;"><span style="color: #660000;">$<span style="">&#123;</span>SECTION_OFF<span style="">&#125;</span></span></span> 
     <span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section2<span style="">&#125;</span></span> <span style="color: #660000;">$0</span>
    &nbsp;
    &nbsp;
    N1: 
    <span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$2</span> <span style="color: #660066;">&quot;1&quot;</span> <span style="">0</span> N2 
     <span style="color: #000099;">SectionGetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section1<span style="">&#125;</span></span> <span style="color: #660000;">$0</span> 
     <span style="color: #000099;">IntOp</span> <span style="color: #660000;">$0</span> <span style="color: #660000;">$0</span> &amp; <span style="color: #006600;"><span style="color: #660000;">$<span style="">&#123;</span>SECTION_OFF<span style="">&#125;</span></span></span> 
     <span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section1<span style="">&#125;</span></span> <span style="color: #660000;">$0</span>  
    &nbsp;
    N2:
    &nbsp;
    &nbsp;
    <span style="color: #000066;">FunctionEnd</span>
    &nbsp;
    <span style="color: #000066;">Section</span> -FinishSection
    &nbsp;
    	<span style="color: #000099;">WriteRegStr</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;Software\${APPNAME}&quot;</span> <span style="color: #660066;">&quot;&quot;</span> <span style="color: #660066;">&quot;$INSTDIR&quot;</span>
    	<span style="color: #000099;">WriteRegStr</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot;</span> <span style="color: #660066;">&quot;DisplayName&quot;</span> <span style="color: #660066;">&quot;${APPNAME}&quot;</span>
    	<span style="color: #000099;">WriteRegStr</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot;</span> <span style="color: #660066;">&quot;UninstallString&quot;</span> <span style="color: #660066;">&quot;$INSTDIR\uninstall.exe&quot;</span>
    	<span style="color: #000099;">WriteUninstaller</span> <span style="color: #660066;">&quot;$INSTDIR\uninstall.exe&quot;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">;vnc section</span>
    	<span style="color: #666666; font-style: italic;">;seven</span>
    	<span style="color: #000099;">GetVersion</span>::<span style="color: #003399;">WindowsName
    </span>	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    	<span style="color: #666666; font-style: italic;">;DHCP-клиент (DHCP Client)</span>
    	<span style="color: #666666; font-style: italic;">;DNS-клиент (DNS Client)</span>
    	<span style="color: #666666; font-style: italic;">;Агент политики IPsec (IPsec Policy Agent)</span>
    	<span style="color: #666666; font-style: italic;">;Маршрутизация и удаленный доступ (Routing and Remote Access)</span>
    	<span style="color: #666666; font-style: italic;">;StrCmp $R0 &quot;7&quot; 0 +7</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegBin  HKCU &quot;Software\ORL\WinVNC3&quot; &quot;Password&quot; &quot;04a80c01b072856f&quot;</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegBin  HKCU &quot;Software\ORL\WinVNC3&quot; &quot;PasswordViewOnly&quot; &quot;04a80c01b072856f&quot;</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot; &quot;Start&quot; &quot;00000002&quot;</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot; &quot;Start&quot; &quot;00000002&quot;</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot; &quot;Start&quot; &quot;00000003&quot;</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RemoteAccess&quot; &quot;Start&quot; &quot;00000004&quot;</span>
    	<span style="color: #666666; font-style: italic;">;GetVersion::WindowsName</span>
    	<span style="color: #666666; font-style: italic;">;Pop $R0</span>
    	<span style="color: #666666; font-style: italic;">;StrCmp $R0 &quot;xp&quot; 0 +3</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegBin  HKCU &quot;S-1-5-21-1801674531-1343024091-789743027-1004\Software\ORL\WinVNC3&quot; &quot;Password&quot; &quot;04a80c01b072856f&quot;</span>
    	<span style="color: #666666; font-style: italic;">;WriteRegBin  HKCU &quot;S-1-5-21-1801674531-1343024091-789743027-1004\Software\ORL\WinVNC3&quot; &quot;PasswordViewOnly&quot; &quot;04a80c01b072856f&quot;</span>
    &nbsp;
    <span style="color: #000099;">MessageBox</span> <span style="color: #ff6600;">MB_YESNO</span>|<span style="color: #ff6600;">MB_ICONQUESTION</span> <span style="color: #660066;">&quot;Нужно перезегрузиться. Хотите выполнить перезагрузку сейчас?&quot;</span> <span style="color: #ff6600;">IDNO</span> +<span style="">3</span>
    <span style="color: #000099;">Exec</span> <span style="color: #660066;">'&quot;$INSTDIR\home\route_f.bat&quot;'</span>
    <span style="color: #000099;">Reboot</span>
    <span style="color: #000066;">SectionEnd</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">; Modern install component descriptions</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_FUNCTION_DESCRIPTION_BEGIN</span>
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section1<span style="">&#125;</span></span> <span style="color: #660066;">&quot;Windows XP,Vista,7 32bit&quot;</span>
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section2<span style="">&#125;</span></span> <span style="color: #660066;">&quot;Widows XP, Vista, 7 64bit&quot;</span>
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section3<span style="">&#125;</span></span> <span style="color: #660066;">&quot;Включить службу DHCP-клиент (DHCP Client)&quot;</span>
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section4<span style="">&#125;</span></span> <span style="color: #660066;">&quot;Включить службу DNS-клиент (DNS Client)&quot;</span>
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section5<span style="">&#125;</span></span> <span style="color: #660066;">&quot;Отключить службу IPSEC&quot;</span>	
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section6<span style="">&#125;</span></span> <span style="color: #660066;">&quot;включить автозагрузку ДС++&quot;</span>	
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section7<span style="">&#125;</span></span> <span style="color: #660066;">&quot;отключить TCP/IP версии 6 Windows Vista, 7 у Нас не используется но является брешью в безопасности&quot;</span>	
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section8<span style="">&#125;</span></span> <span style="color: #660066;">&quot;службы для создания подключения: 	Remote Access Connection Manager (Диспетчер подключений удаленного доступа), Remote Procedure Call (Локатор удаленного вызова процедур (RPC)), Plug and Play (Plug and Play), Telephony (Телефония), TCP/IP NetBIOS Helper Service (Модуль поддержки NetBIOS через TCP/IP), DCOM Server Process Launcher (Запуск серверных процессов DCOM),Server (Сервер)&quot;</span> 
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section9<span style="">&#125;</span></span> <span style="color: #660066;">&quot;Отключить службы: Общий доступ к подключению к Интернету (ICS) (Internet Connection Sharing (ICS)), Брандмауэр Windows (Windows Firewall), Security Center (Центр обеспечения безопасности)&quot;</span>
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_DESCRIPTION_TEXT</span> <span style="color: #660000;">$<span style="">&#123;</span>Section10<span style="">&#125;</span></span> <span style="color: #660066;">&quot;Записывает файл со списком хабов. Однако в этом же файле хранятся и пароли. Будьте внимательны если Вы не хотите потерять пароли!&quot;</span>
    <span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_FUNCTION_DESCRIPTION_END</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">;Uninstall section</span>
    <span style="color: #000066;">Section</span> Uninstall
    &nbsp;
    	<span style="color: #666666; font-style: italic;">;Remove from registry...</span>
    	<span style="color: #000099;">DeleteRegKey</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot;</span>
    	<span style="color: #000099;">DeleteRegValue</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;Software\Microsoft\Windows\CurrentVersion\Run&quot;</span> <span style="color: #660066;">&quot;homenet&quot;</span>
    	<span style="color: #000099;">DeleteRegKey</span> <span style="color: #ff6600;">HKLM</span> <span style="color: #660066;">&quot;SOFTWARE\${APPNAME}&quot;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">; Delete self</span>
    	<span style="color: #000099;">Delete</span> <span style="color: #660066;">&quot;$INSTDIR\uninstall.exe&quot;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">; Delete Shortcuts</span>
    	<span style="color: #000099;">Delete</span> <span style="color: #660066;">&quot;$DESKTOP\Greylink.lnk&quot;</span>
    	<span style="color: #000099;">Delete</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\ping_test.lnk&quot;</span> 
    	<span style="color: #000099;">Delete</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Greylink.lnk&quot;</span>
    	<span style="color: #000099;">Delete</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\Uninstall.lnk&quot;</span>
    	<span style="color: #666666; font-style: italic;">;Delete &quot;$SMPROGRAMS\Home\VNC.lnk&quot;</span>
    	<span style="color: #000099;">Delete</span> <span style="color: #660066;">&quot;$SMPROGRAMS\Home\ping_test.lnk&quot;</span> 
    	<span style="color: #666666; font-style: italic;">; RMDir /r &quot;$SMPROGRAMS\Home\&quot;</span>
    	<span style="color: #000099;">RMDir</span> <span style="color: #ff6600;">/r</span> <span style="color: #660066;">&quot;$INSTDIR\greylink\&quot;</span>
    &nbsp;
    <span style="color: #000066;">SectionEnd</span>
    &nbsp;
    <span style="color: #000066;">Function</span> <span style="color: #006600;">.onGUIEnd</span>
    	NSIS_SkinCrafter_P<span style="color: #000099;">lugin</span>::<span style="color: #003399;">destroy
    </span><span style="color: #000066;">FunctionEnd</span>
    &nbsp;
    <span style="color: #000066;">Function</span> <span style="color: #006600;">un.onInit</span>
        <span style="color: #666666; font-style: italic;">;User defined skin</span>
        <span style="color: #666666; font-style: italic;">;SetOutPath $TEMP</span>
        <span style="color: #666666; font-style: italic;">;File /oname=Stylish.skf &quot;Stylish.skf&quot;</span>
        <span style="color: #666666; font-style: italic;">;NSIS_SkinCrafter_Plugin::skin /NOUNLOAD $TEMP\Stylish.skf</span>
        <span style="color: #666666; font-style: italic;">;Delete $TEMP\Stylish.skf</span>
    &nbsp;
        <span style="color: #666666; font-style: italic;">;Default Skin</span>
        NSIS_SkinCrafter_P<span style="color: #000099;">lugin</span>::<span style="color: #003399;">skin </span><span style="color: #ff6600;">/NOUNLOAD</span>
    <span style="color: #000066;">FunctionEnd</span>
    &nbsp;
    <span style="color: #000066;">Function</span> <span style="color: #006600;">un.onGUIEnd</span>
    	NSIS_SkinCrafter_P<span style="color: #000099;">lugin</span>::<span style="color: #003399;">destroy
    </span><span style="color: #000066;">FunctionEnd</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">; On initialization</span>
    <span style="color: #000066;">Function</span> <span style="color: #006600;">.onInit</span>
    		<span style="color: #666666; font-style: italic;">;User defined skin</span>
        <span style="color: #000099;">SetOutPath</span> <span style="color: #660000;">$TEMP</span>
        <span style="color: #000099;">File</span> <span style="color: #ff6600;">/oname</span>=Gloss.skf <span style="color: #660066;">&quot;Gloss.skf&quot;</span>
        NSIS_SkinCrafter_P<span style="color: #000099;">lugin</span>::<span style="color: #003399;">skin </span><span style="color: #ff6600;">/NOUNLOAD</span> <span style="color: #660000;">$TEMP</span>\Gloss.skf
        <span style="color: #000099;">Delete</span> <span style="color: #660000;">$TEMP</span>\Gloss.skf
    &nbsp;
        <span style="color: #666666; font-style: italic;">;Default Skin</span>
        <span style="color: #666666; font-style: italic;">;NSIS_SkinCrafter_Plugin::skin /NOUNLOAD</span>
    &nbsp;
    &nbsp;
    	<span style="color: #666666; font-style: italic;">;enable DHCP client by default</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section3<span style="">&#125;</span></span> <span style="">1</span>
    	<span style="color: #666666; font-style: italic;">;enable DNS client by default</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section4<span style="">&#125;</span></span> <span style="">1</span>	
    	<span style="color: #666666; font-style: italic;">;disable IPSEC Services (Службы IPSEC)</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section5<span style="">&#125;</span></span> <span style="">1</span>	
    	<span style="color: #666666; font-style: italic;">;autostart dc++</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section6<span style="">&#125;</span></span> <span style="">1</span>	
    	<span style="color: #666666; font-style: italic;">;ип версии 6</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>Section7<span style="">&#125;</span></span> <span style="">1</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>Section8<span style="">&#125;</span></span> <span style="">1</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>Section9<span style="">&#125;</span></span> <span style="">0</span>
    	<span style="color: #666666; font-style: italic;">;IfFileExists &quot;$INSTDIR\greylink\Settings\Favorites.xml&quot; 0  </span>
    	<span style="color: #666666; font-style: italic;">;SectionSetFlags ${Section10} 0</span>
    	<span style="color: #666666; font-style: italic;">;Goto</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>Section10<span style="">&#125;</span></span> <span style="">1</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">;IfFileExists &quot;$INSTDIR\greylink\Settings\Favorites.xml&quot; 0 true_section10 </span>
    	<span style="color: #666666; font-style: italic;">;	MessageBox MB_YESNO &quot;Файл с списком Хабов существует - Вы хотите его переписать? Если Вы его перепишете то пароли от хабов потеряются!!!&quot; IDYES true_section10 IDNO false_section10</span>
    	<span style="color: #666666; font-style: italic;">;	true_section10:	</span>
    	<span style="color: #666666; font-style: italic;">;		SectionSetFlags ${Section10} 1</span>
    	<span style="color: #666666; font-style: italic;">;	  Goto next_section10</span>
    	<span style="color: #666666; font-style: italic;">;	false_section10:</span>
    	<span style="color: #666666; font-style: italic;">;		SectionSetFlags ${Section10} 0</span>
    	<span style="color: #666666; font-style: italic;">;		MessageBox MB_OK &quot;Текущий список хабов: home: hub.homenet (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться.&quot;</span>
    	<span style="color: #666666; font-style: italic;">;	next_section10:</span>
    	<span style="color: #666666; font-style: italic;">;	</span>
    	<span style="color: #666666; font-style: italic;">;if 32 bit set for 32bit</span>
    	<span style="color: #000099;">GetVersion</span>::WindowsPlatformId
    	<span style="color: #000099;">Pop</span> <span style="color: #660000;">$R0</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section1<span style="">&#125;</span></span> <span style="">0</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section2<span style="">&#125;</span></span> <span style="">1</span>
    	<span style="color: #666666; font-style: italic;">;Goto +7</span>
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="color: #660066;">&quot;64&quot;</span> <span style="">0</span> +<span style="">4</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section1<span style="">&#125;</span></span> <span style="">0</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section2<span style="">&#125;</span></span> <span style="">1</span>
    	<span style="color: #000099;">Goto</span> +<span style="">3</span>
    	<span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section1<span style="">&#125;</span></span> <span style="">1</span>
      <span style="color: #000099;">SectionSetFlags</span> <span style="color: #660000;">$<span style="">&#123;</span>section2<span style="">&#125;</span></span> <span style="">0</span>
    	<span style="color: #666666; font-style: italic;">;;;;;;;;;;;;;;;;;</span>
    <span style="color: #000099;">Goto</span> start
    end:
    	<span style="color: #000099;">Quit</span>
    start:	
    	<span style="color: #660000;">$<span style="">&#123;</span>nsP<span style="color: #000099;">rocess</span>::FindProcess<span style="">&#125;</span></span> <span style="color: #660066;">&quot;greylink.exe&quot;</span> <span style="color: #660000;">$R0</span>
    	<span style="color: #000099;">StrCmp</span> <span style="color: #660000;">$R0</span> <span style="">0</span> <span style="">0</span> +<span style="">5</span>
    	<span style="color: #000099;">MessageBox</span> <span style="color: #ff6600;">MB_OKCANCEL</span>|<span style="color: #ff6600;">MB_ICONEXCLAMATION</span> <span style="color: #660066;">'Закрыть &quot;ДС++&quot; для продолжения установки?'</span> <span style="color: #ff6600;">IDOK</span> loop <span style="color: #ff6600;">IDCANCEL</span> end
    loop:
    	<span style="color: #660000;">$<span style="">&#123;</span>nsP<span style="color: #000099;">rocess</span>::KillProcess<span style="">&#125;</span></span> <span style="color: #660066;">&quot;greylink.exe&quot;</span> <span style="color: #660000;">$R0</span>
    	<span style="color: #000099;">MessageBox</span> <span style="color: #ff6600;">MB_OK</span> <span style="color: #660066;">&quot;Приложение ДС++ было завершено&quot;</span> <span style="color: #666666; font-style: italic;">;	Errorlevel: [$R0]&quot;</span>
    	<span style="color: #660000;">$<span style="">&#123;</span>nsP<span style="color: #000099;">rocess</span>::Unload<span style="">&#125;</span></span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">;end:</span>
    	<span style="color: #666666; font-style: italic;">; kill DC++</span>
      <span style="color: #666666; font-style: italic;">; nsExec::Exec '$INSTDIR\home\wkill.exe -n &quot;greylink.exe&quot;'</span>
    	<span style="color: #000066; font-weight:bold;">!insertmacro</span> <span style="color: #006600;">MUI_LANGDLL_DISPLAY</span>
    &nbsp;
    <span style="color: #000066;">FunctionEnd</span>
    &nbsp;
    <span style="color: #000066;">BrandingText</span> <span style="color: #660066;">&quot;home&quot;</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">; eof</span></pre></td></tr></table><p class="theCode" style="display:none;">
    ; Script generated with the Venis Install Wizard
    
    ; Define your application name
    !define APPNAME &quot;Home&quot;
    !define PRODUCT_VERSION &quot;0.5&quot;
    !define APPNAMEANDVERSION &quot;Home pack ${PRODUCT_VERSION}&quot;
    
      VIProductVersion         &quot;1.${PRODUCT_VERSION}&quot;
      VIAddVersionKey          &quot;FileVersion&quot;        &quot;${PRODUCT_VERSION}&quot; 
      VIAddVersionKey          &quot;ProductName&quot;           &quot;Home pack&quot;
      VIAddVersionKey          &quot;CompanyName&quot;          &quot;Home&quot;
      VIAddVersionKey          &quot;LegalTrademarks&quot;       &quot;www.home&quot;
      VIAddVersionKey          &quot;LegalCopyright&quot;        &quot;CopyRights 2010© to valeranew@ukr.net&quot; 
    	VIAddVersionKey          &quot;FileDescription&quot;       &quot;dc++&quot;
    	
    ; !define SF_SELECTED   1
    ; !define SF_SUBSEC     2
    ; !define SF_SUBSECEND  4
    ; !define SF_BOLD       8
    ; !define SF_RO         16
    ; !define SF_EXPAND     32
    ; !define SECTION_OFF   0xFFFFFFFE
    ; ExecShell
    
    ; Main Install settings
    Name &quot;${APPNAMEANDVERSION}&quot;
    InstallDir &quot;$PROGRAMFILES\Home&quot;
    InstallDirRegKey HKLM &quot;Software\${APPNAME}&quot; &quot;&quot;
    ;OutFile &quot;home_pack_full.exe&quot;
    OutFile &quot;home_pack_full-${PRODUCT_VERSION}.exe&quot;
    ; Modern interface settings
    !include &quot;MUI2.nsh&quot;
    ;kill
    !include &quot;nsProcess.nsh&quot;
    !include &quot;Sections.nsh&quot;
    
      !define MUI_HEADERIMAGE
      !define MUI_HEADERIMAGE_BITMAP &quot;logo.bmp&quot; ; optional
    	
    ;!define MUI_COMPONENTSPAGE_SMALLDESC
    !define MUI_INSTFILESPAGE_COLORS &quot;FFFFFF 000000&quot; ;Два цвета
    
    
    !define MUI_ABORTWARNING
    !define MUI_FINISHPAGE_RUN_NOTCHECKED
    !define MUI_FINISHPAGE_RUN_TEXT &quot;Выберите что бы запустить DC++&quot;
    !define MUI_FINISHPAGE_RUN &quot;$INSTDIR\greylink\greylink.exe&quot;
    
    !insertmacro MUI_PAGE_WELCOME
    !insertmacro MUI_PAGE_LICENSE &quot;License.txt&quot;
    !insertmacro MUI_PAGE_COMPONENTS
    !insertmacro MUI_PAGE_DIRECTORY
    !insertmacro MUI_PAGE_INSTFILES
    !insertmacro MUI_PAGE_FINISH
    
    !insertmacro MUI_UNPAGE_CONFIRM
    !insertmacro MUI_UNPAGE_INSTFILES
    
    ; Set languages (first is default language)
    ;!insertmacro MUI_LANGUAGE &quot;English&quot;
    !insertmacro MUI_LANGUAGE &quot;Russian&quot;
    !insertmacro MUI_RESERVEFILE_LANGDLL
    
    
    Section /o  &quot;Windows x86 32bit&quot; Section1
     	
    	; Set Section properties
    	SetOverwrite on
    
    	; Set Section Files and Shortcuts
    	SetOutPath &quot;$INSTDIR\greylink\&quot;
    	File /r &quot;greylink0025\greylink\*.*&quot;
    	
    	SetOutPath &quot;$INSTDIR\homenet\&quot;
    	File /r &quot;homenet_tool\*.*&quot;
    
    	SetOutPath &quot;$INSTDIR\tightvnc\&quot;
    	File /r &quot;tightvnc\*.*&quot;
    	
    	CreateShortCut &quot;$DESKTOP\Greylink.lnk&quot; &quot;$INSTDIR\greylink\greylink.exe&quot;
    	CreateDirectory &quot;$SMPROGRAMS\Home&quot;
    	CreateShortCut &quot;$SMPROGRAMS\Home\ping_test.lnk&quot; &quot;$INSTDIR\homenet\ping.exe&quot;
    	
    	;сайты
    	CreateShortCut &quot;$SMPROGRAMS\Home\Сайт Home.lnk&quot; &quot;http://home/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    	CreateShortCut &quot;$DESKTOP\Сайт Home.lnk&quot; &quot;http://home/&quot; &quot;&quot; &quot;$INSTDIR\home\homenet.ico&quot;
    	CreateShortCut &quot;$SMPROGRAMS\Home\WinMTR.lnk&quot; &quot;$INSTDIR\home\winmtr_0.8\WinMTR.exe&quot;
    	CreateShortCut &quot;$SMPROGRAMS\Home\Статистика Интернета.lnk&quot; &quot;https://stat/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    	CreateShortCut &quot;$DESKTOP\Статистика Интернета.lnk&quot; &quot;https://stat/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    	CreateShortCut &quot;$SMPROGRAMS\Home\Медиасервер.lnk&quot; &quot;http://media.home/&quot; &quot;&quot; &quot;$INSTDIR\home\mediahome.ico&quot;
    
    	
    	CreateShortCut &quot;$SMPROGRAMS\Home\Greylink.lnk&quot; &quot;$INSTDIR\greylink\greylink.exe&quot;
      CreateShortCut &quot;$SMPROGRAMS\Home\VNC.lnk&quot; &quot;$INSTDIR\tightvnc\WinVNC.exe&quot;
    
    	CreateShortCut &quot;$SMPROGRAMS\Home\Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot;
    		CreateShortCut &quot;$SMPROGRAMS\Home\IPTV.lnk&quot; &quot;$INSTDIR\IPTVplayer\IpTvPlayer.exe&quot;
    	
    SectionEnd
    Section /o &quot;IPTV beta1&quot; Section11
    	SetOutPath &quot;$INSTDIR\IPTVplayer&quot;
    	
    	File /r &quot;IP-TV_Playerb1\*.*&quot;
    	
    	SectionEnd
    Section /o &quot;Windows x64 64bit&quot; Section2
    
    	; Set Section properties
    	SetOverwrite on
    
    	; Set Section Files and Shortcuts
    	SetOutPath &quot;$INSTDIR\greylink\&quot;
    	File /r &quot;greylink0022-x64\greylink\*.*&quot;
    
    	SetOutPath &quot;$INSTDIR\home\&quot;
    	File /r &quot;home_tool\*.*&quot;
    
    	SetOutPath &quot;$INSTDIR\tightvnc\&quot;
    	File /r &quot;tightvnc\*.*&quot;
    	
    	CreateShortCut &quot;$DESKTOP\Greylink.lnk&quot; &quot;$INSTDIR\greylink\greylink.exe&quot;
    	CreateDirectory &quot;$SMPROGRAMS\Home&quot;
    
    	CreateShortCut &quot;$SMPROGRAMS\Home\ping_test.lnk&quot; &quot;$INSTDIR\home\ping.exe&quot;
      CreateShortCut &quot;$SMPROGRAMS\Home\Greylink.lnk&quot; &quot;$INSTDIR\greylink\greylink.exe&quot;
     
    	;сайты
    	CreateShortCut &quot;$SMPROGRAMS\Home\Сайт Home-net.lnk&quot; &quot;http://home/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    	CreateShortCut &quot;$SMPROGRAMS\Home\WinMTR.lnk&quot; &quot;$INSTDIR\home\winmtr_0.8\WinMTR.exe&quot;
    	CreateShortCut &quot;$DESKTOP\Сайт Home.lnk&quot; &quot;http://home/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    	CreateShortCut &quot;$SMPROGRAMS\Home\Статистика Интернета.lnk&quot; &quot;https://stat/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    	CreateShortCut &quot;$DESKTOP\Статистика Интернета.lnk&quot; &quot;https://stat/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    	CreateShortCut &quot;$SMPROGRAMS\Homenet\Медиасервер home.lnk&quot; &quot;http://media.home/&quot; &quot;&quot; &quot;$INSTDIR\home\home.ico&quot;
    
      CreateShortCut &quot;$SMPROGRAMS\Home\VNC.lnk&quot; &quot;$INSTDIR\tightvnc\WinVNC.exe&quot;
     
    	CreateShortCut &quot;$SMPROGRAMS\Home\Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot;
     	CreateShortCut &quot;$SMPROGRAMS\Home\IPTV.lnk&quot; &quot;$INSTDIR\IPTVplayer\IpTvPlayer.exe&quot;
    
    SectionEnd
    ;служба DHCP-клиент (DHCP Client)
    Section /o &quot;включить DHCP-клиент&quot; Section3
    	; Set Section properties
    	SetOverwrite on
    	GetVersion::WindowsName
    	Pop $R0
    	
    	StrCmp $R0 &quot;7&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    	StrCmp $R0 &quot;Vista&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot; &quot;Start&quot; &quot;00000002&quot;
    
    	StrCmp $R0 &quot;XP&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    	StrCmp $R0 &quot;XP x64&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    SectionEnd
    ;DNS-клиент (DNS Client)
    Section /o &quot;включить DNS-клиент&quot; Section4
    	; Set Section properties
    	SetOverwrite on
    	GetVersion::WindowsName
    	Pop $R0
    	
    	StrCmp $R0 &quot;7&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    	StrCmp $R0 &quot;Vista&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot; &quot;Start&quot; &quot;00000002&quot;
    
    	StrCmp $R0 &quot;XP&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    	StrCmp $R0 &quot;XP x64&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    SectionEnd
    
    ;IPSEC Services (Службы IPSEC)
    Section /o &quot;Отключить службу IPSEC&quot; Section5
    	; Set Section properties
    	SetOverwrite on
    	GetVersion::WindowsName
    	Pop $R0
    	
    	StrCmp $R0 &quot;7&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot; &quot;Start&quot; &quot;00000004&quot;
    	
    	StrCmp $R0 &quot;Vista&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot; &quot;Start&quot; &quot;00000004&quot;
    
    	StrCmp $R0 &quot;XP&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot; &quot;Start&quot; &quot;00000004&quot;
    	
    	StrCmp $R0 &quot;XP x64&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot; &quot;Start&quot; &quot;00000004&quot;
    	
    SectionEnd
    
    ;автозагрузка ДС+++
    Section /o &quot;автозагрузка DC++&quot; Section6
    	;autostart 
    	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Run&quot; &quot;home&quot; &quot;$INSTDIR\greylink\greylink.exe&quot;
    SectionEnd
    
    Section /o &quot;отключить IP версии 6&quot; Section7
    	;ipv6
    	GetVersion::WindowsName
    	Pop $R0
    	
    	StrCmp $R0 &quot;Vista&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters\&quot; &quot;DisabledComponents&quot; &quot;0xffffffff&quot;
    	
    	StrCmp $R0 &quot;7&quot; 0 +2
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters\&quot; &quot;DisabledComponents&quot; &quot;4294967295&quot;
    
    SectionEnd
    ;службы для создания подключения
    Section /o &quot;службы для создания подключения&quot; Section8
    	; Set Section properties
    	SetOverwrite on
    	;Remote Access Connection Manager (Диспетчер подключений удаленного доступа)
    	;Remote Procedure Call (Локатор удаленного вызова процедур (RPC))
     	;Plug and Play (Plug and Play)
      ;Telephony (Телефония)
    	;TCP/IP NetBIOS Helper Service (Модуль поддержки NetBIOS через TCP/IP)
    	;DCOM Server Process Launcher (Запуск серверных процессов DCOM)
    	;Server (Сервер)
    	GetVersion::WindowsName
    	Pop $R0
    	
    	StrCmp $R0 &quot;7&quot; 0 +8
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RasAuto&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RasMan&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\lmhosts&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\LanmanServer&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    	StrCmp $R0 &quot;Vista&quot; 0 +8
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RasAuto&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RasMan&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\lmhosts&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\LanmanServer&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    
    	StrCmp $R0 &quot;XP&quot; 0 +8
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RasMan&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PlugPlay&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\LmHosts&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\lanmanserver&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    	StrCmp $R0 &quot;XP x64&quot; 0 +8
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RasMan&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RpcLocator&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PlugPlay&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\TapiSrv&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\LmHosts&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\DcomLaunch&quot; &quot;Start&quot; &quot;00000002&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\lanmanserver&quot; &quot;Start&quot; &quot;00000002&quot;
    	
    SectionEnd
    Section /o &quot;отключить Брандмауэр Windows&quot; Section9
    	;ipv6
    	GetVersion::WindowsName
    	Pop $R0
    	;Общий доступ к подключению к Интернету (ICS) (Internet Connection Sharing (ICS))
      ;Брандмауэр Windows (Windows Firewall)
    	;Security Center (Центр обеспечения безопасности)
    	StrCmp $R0 &quot;7&quot; 0 +4
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot; &quot;Start&quot; &quot;00000004&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\MpsSv&quot; &quot;Start&quot; &quot;00000004&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot; &quot;Start&quot; &quot;00000004&quot;
    	
    	StrCmp $R0 &quot;Vista&quot; 0 +4
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot; &quot;Start&quot; &quot;00000004&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\MpsSv&quot; &quot;Start&quot; &quot;00000004&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot; &quot;Start&quot; &quot;00000004&quot;
    	
    	StrCmp $R0 &quot;XP x64&quot; 0 +3
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot; &quot;Start&quot; &quot;00000004&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot; &quot;Start&quot; &quot;00000004&quot;	
    	
    	StrCmp $R0 &quot;XP&quot; 0 +3
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\SharedAccess&quot; &quot;Start&quot; &quot;00000004&quot;
    	WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\wscsvc&quot; &quot;Start&quot; &quot;00000004&quot;
    	
    SectionEnd
    Section /o &quot;Перезаписать список Хабов&quot; Section10
    	SetOverwrite on
    	;		SetOutPath &quot;$INSTDIR\greylink\Settings\&quot;
    	;		File &quot;homenet_tool\Favorites.xml&quot;
    	
    	
    		IfFileExists &quot;$INSTDIR\greylink\Settings\Favorites.xml&quot; 0 true_section10 
    		MessageBox MB_YESNO &quot;Файл с списком Хабов существует - Вы хотите его переписать? Если Вы его перепишете то пароли от хабов потеряются!!!&quot; IDYES true_section10 IDNO false_section10
    		true_section10:	
    			SetOutPath &quot;$INSTDIR\greylink\Settings\&quot;
    			File &quot;settings\homenet\Favorites.xml&quot;
    			MessageBox MB_OK &quot;Текущий список хабов: home: hub.home (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться.&quot;
    		  Goto next_section10
    		false_section10:
    			MessageBox MB_OK &quot;Текущий список хабов: home: hub.home (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться.&quot;
    		next_section10:
    		
    		
    SectionEnd
    
    Function .onSelChange 
     SectionGetFlags ${section1} $1 
     SectionGetFlags ${section2} $2 
    
    StrCmp $1 &quot;1&quot; 0 N1 
     SectionGetFlags ${section2} $0 
     IntOp $0 $0 &amp; ${SECTION_OFF} 
     SectionSetFlags ${section2} $0
     
    
    N1: 
    StrCmp $2 &quot;1&quot; 0 N2 
     SectionGetFlags ${section1} $0 
     IntOp $0 $0 &amp; ${SECTION_OFF} 
     SectionSetFlags ${section1} $0  
     
    N2:
    
    
    FunctionEnd
    
    Section -FinishSection
    
    	WriteRegStr HKLM &quot;Software\${APPNAME}&quot; &quot;&quot; &quot;$INSTDIR&quot;
    	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot; &quot;DisplayName&quot; &quot;${APPNAME}&quot;
    	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninstall.exe&quot;
    	WriteUninstaller &quot;$INSTDIR\uninstall.exe&quot;
    
    	;vnc section
    	;seven
    	GetVersion::WindowsName
    	Pop $R0
    	;DHCP-клиент (DHCP Client)
    	;DNS-клиент (DNS Client)
    	;Агент политики IPsec (IPsec Policy Agent)
    	;Маршрутизация и удаленный доступ (Routing and Remote Access)
    	;StrCmp $R0 &quot;7&quot; 0 +7
    	;WriteRegBin  HKCU &quot;Software\ORL\WinVNC3&quot; &quot;Password&quot; &quot;04a80c01b072856f&quot;
    	;WriteRegBin  HKCU &quot;Software\ORL\WinVNC3&quot; &quot;PasswordViewOnly&quot; &quot;04a80c01b072856f&quot;
    	;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dhcp&quot; &quot;Start&quot; &quot;00000002&quot;
    	;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\Dnscache&quot; &quot;Start&quot; &quot;00000002&quot;
    	;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\PolicyAgent&quot; &quot;Start&quot; &quot;00000003&quot;
    	;WriteRegDWORD HKLM &quot;SYSTEM\CurrentControlSet\Services\RemoteAccess&quot; &quot;Start&quot; &quot;00000004&quot;
    	;GetVersion::WindowsName
    	;Pop $R0
    	;StrCmp $R0 &quot;xp&quot; 0 +3
    	;WriteRegBin  HKCU &quot;S-1-5-21-1801674531-1343024091-789743027-1004\Software\ORL\WinVNC3&quot; &quot;Password&quot; &quot;04a80c01b072856f&quot;
    	;WriteRegBin  HKCU &quot;S-1-5-21-1801674531-1343024091-789743027-1004\Software\ORL\WinVNC3&quot; &quot;PasswordViewOnly&quot; &quot;04a80c01b072856f&quot;
    	
    MessageBox MB_YESNO|MB_ICONQUESTION &quot;Нужно перезегрузиться. Хотите выполнить перезагрузку сейчас?&quot; IDNO +3
    Exec '&quot;$INSTDIR\home\route_f.bat&quot;'
    Reboot
    SectionEnd
    
    ; Modern install component descriptions
    !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section1} &quot;Windows XP,Vista,7 32bit&quot;
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section2} &quot;Widows XP, Vista, 7 64bit&quot;
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section3} &quot;Включить службу DHCP-клиент (DHCP Client)&quot;
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section4} &quot;Включить службу DNS-клиент (DNS Client)&quot;
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section5} &quot;Отключить службу IPSEC&quot;	
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section6} &quot;включить автозагрузку ДС++&quot;	
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section7} &quot;отключить TCP/IP версии 6 Windows Vista, 7 у Нас не используется но является брешью в безопасности&quot;	
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section8} &quot;службы для создания подключения: 	Remote Access Connection Manager (Диспетчер подключений удаленного доступа), Remote Procedure Call (Локатор удаленного вызова процедур (RPC)), Plug and Play (Plug and Play), Telephony (Телефония), TCP/IP NetBIOS Helper Service (Модуль поддержки NetBIOS через TCP/IP), DCOM Server Process Launcher (Запуск серверных процессов DCOM),Server (Сервер)&quot; 
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section9} &quot;Отключить службы: Общий доступ к подключению к Интернету (ICS) (Internet Connection Sharing (ICS)), Брандмауэр Windows (Windows Firewall), Security Center (Центр обеспечения безопасности)&quot;
    	!insertmacro MUI_DESCRIPTION_TEXT ${Section10} &quot;Записывает файл со списком хабов. Однако в этом же файле хранятся и пароли. Будьте внимательны если Вы не хотите потерять пароли!&quot;
    !insertmacro MUI_FUNCTION_DESCRIPTION_END
    
    ;Uninstall section
    Section Uninstall
    
    	;Remove from registry...
    	DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot;
    	DeleteRegValue HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Run&quot; &quot;homenet&quot;
    	DeleteRegKey HKLM &quot;SOFTWARE\${APPNAME}&quot;
    
    	; Delete self
    	Delete &quot;$INSTDIR\uninstall.exe&quot;
    
    	; Delete Shortcuts
    	Delete &quot;$DESKTOP\Greylink.lnk&quot;
    	Delete &quot;$SMPROGRAMS\Home\ping_test.lnk&quot; 
    	Delete &quot;$SMPROGRAMS\Home\Greylink.lnk&quot;
    	Delete &quot;$SMPROGRAMS\Home\Uninstall.lnk&quot;
    	;Delete &quot;$SMPROGRAMS\Home\VNC.lnk&quot;
    	Delete &quot;$SMPROGRAMS\Home\ping_test.lnk&quot; 
    	; RMDir /r &quot;$SMPROGRAMS\Home\&quot;
    	RMDir /r &quot;$INSTDIR\greylink\&quot;
    
    SectionEnd
    
    Function .onGUIEnd
    	NSIS_SkinCrafter_Plugin::destroy
    FunctionEnd
    
    Function un.onInit
        ;User defined skin
        ;SetOutPath $TEMP
        ;File /oname=Stylish.skf &quot;Stylish.skf&quot;
        ;NSIS_SkinCrafter_Plugin::skin /NOUNLOAD $TEMP\Stylish.skf
        ;Delete $TEMP\Stylish.skf
    
        ;Default Skin
        NSIS_SkinCrafter_Plugin::skin /NOUNLOAD
    FunctionEnd
    
    Function un.onGUIEnd
    	NSIS_SkinCrafter_Plugin::destroy
    FunctionEnd
    
    ; On initialization
    Function .onInit
    		;User defined skin
        SetOutPath $TEMP
        File /oname=Gloss.skf &quot;Gloss.skf&quot;
        NSIS_SkinCrafter_Plugin::skin /NOUNLOAD $TEMP\Gloss.skf
        Delete $TEMP\Gloss.skf
    
        ;Default Skin
        ;NSIS_SkinCrafter_Plugin::skin /NOUNLOAD
    		
    	
    	;enable DHCP client by default
    	SectionSetFlags ${section3} 1
    	;enable DNS client by default
    	SectionSetFlags ${section4} 1	
    	;disable IPSEC Services (Службы IPSEC)
    	SectionSetFlags ${section5} 1	
    	;autostart dc++
    	SectionSetFlags ${section6} 1	
    	;ип версии 6
    	SectionSetFlags ${Section7} 1
    	SectionSetFlags ${Section8} 1
    	SectionSetFlags ${Section9} 0
    	;IfFileExists &quot;$INSTDIR\greylink\Settings\Favorites.xml&quot; 0  
    	;SectionSetFlags ${Section10} 0
    	;Goto
    	SectionSetFlags ${Section10} 1
    	
    	;IfFileExists &quot;$INSTDIR\greylink\Settings\Favorites.xml&quot; 0 true_section10 
    	;	MessageBox MB_YESNO &quot;Файл с списком Хабов существует - Вы хотите его переписать? Если Вы его перепишете то пароли от хабов потеряются!!!&quot; IDYES true_section10 IDNO false_section10
    	;	true_section10:	
    	;		SectionSetFlags ${Section10} 1
    	;	  Goto next_section10
    	;	false_section10:
    	;		SectionSetFlags ${Section10} 0
    	;		MessageBox MB_OK &quot;Текущий список хабов: home: hub.homenet (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться.&quot;
    	;	next_section10:
    	;	
    	;if 32 bit set for 32bit
    	GetVersion::WindowsPlatformId
    	Pop $R0
    	SectionSetFlags ${section1} 0
    	SectionSetFlags ${section2} 1
    	;Goto +7
    	StrCmp $R0 &quot;64&quot; 0 +4
    	SectionSetFlags ${section1} 0
    	SectionSetFlags ${section2} 1
    	Goto +3
    	SectionSetFlags ${section1} 1
      SectionSetFlags ${section2} 0
    	;;;;;;;;;;;;;;;;;
    Goto start
    end:
    	Quit
    start:	
    	${nsProcess::FindProcess} &quot;greylink.exe&quot; $R0
    	StrCmp $R0 0 0 +5
    	MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION 'Закрыть &quot;ДС++&quot; для продолжения установки?' IDOK loop IDCANCEL end
    loop:
    	${nsProcess::KillProcess} &quot;greylink.exe&quot; $R0
    	MessageBox MB_OK &quot;Приложение ДС++ было завершено&quot; ;	Errorlevel: [$R0]&quot;
    	${nsProcess::Unload}
    
    	;end:
    	; kill DC++
      ; nsExec::Exec '$INSTDIR\home\wkill.exe -n &quot;greylink.exe&quot;'
    	!insertmacro MUI_LANGDLL_DISPLAY
    
    FunctionEnd
    
    BrandingText &quot;home&quot;
    
    ; eof</p></div>
    ";}
categories:
  - 4isp
tags:
  - nsis

---
в данном посте пойдёт речь О том как провайдеру Интернета распространять программы. Даже не так &#8212; набор программ с помощью Nullsoft Scriptable Install System (NSIS) — система создания инсталляторов для Microsoft Windows с открытыми исходными кодами)))

Дело в том, что обычно появляется необходимость установить IP-TV плейер, DC++ клиент, включить службы в Виндовсе и т.д. и что делать?

Настройщики мучаются-мучаются-мучаются, а еще они не квалифицированные или же у них времени нет или же нет чего-либо&#8230;
  
А пользователь переустановил систему?

Мною было написаны скрипты для <a href="http://nsis.sourceforge.net/Main_Page" rel="nofollow">Nullsoft Scriptable Install System (NSIS) — система создания инсталляторов для Microsoft Windows с открытыми исходными кодами, созданная компанией Nullsoft, основанной создателями Winamp. NSIS создан как альтернатива InstallShield, предназначенного для коммерческих продуктов.</a>

Так же выкладываю <a href="http://depositfiles.com/files/6zcndegap" title="tools.rar" rel="nofollow">А это исходные программы нужные для моей сборки.</a> 

Это последний вариант. Он устанавливал в 32-битную систему &#8212; 32-битные программы, в 64-битную 64-битные (правда надо было доработать этот момент, но не хватило времени )))

Во вторых Я использовал скины &#8212; это круто))) NSIS SkinCrafter Plugin, правда Я под Windows 7 очень долго устанавливал &#8212; он не сразу заработал, вернее Он не работал))).

В общем у Меня есть отдельно: greylink0022-x64 директория С greylink&#8217;ом для х86_64 и greylink0025 С greylink&#8217;ом для х86 для 32-бит.

Я сделал что бы с помощью nsProcess::FindProcess &#8212; искался активный процесс greylink.exe и если он есть предлагалось его грохнуть, иначе ж не запишешь новые данные)))
  
Убивание с помощью nsProcess::KillProcess)))

<a href="http://depositfiles.com/files/6zcndegap" title="tools.rar" rel="nofollow">исходные программы нужные для сборки</a>

<!--more-->

new\_x64\_and\_x86\_4\_kill\_proc\_vnc\_winmtr\_slugbi\_16.nsi:

<pre lang="nsis" line="1">; Script generated with the Venis Install Wizard

; Define your application name
!define APPNAME "Home"
!define PRODUCT_VERSION "0.5"
!define APPNAMEANDVERSION "Home pack ${PRODUCT_VERSION}"

  VIProductVersion         "1.${PRODUCT_VERSION}"
  VIAddVersionKey          "FileVersion"        "${PRODUCT_VERSION}" 
  VIAddVersionKey          "ProductName"           "Home pack"
  VIAddVersionKey          "CompanyName"          "Home"
  VIAddVersionKey          "LegalTrademarks"       "www.home"
  VIAddVersionKey          "LegalCopyright"        "CopyRights 2010© to valeranew@ukr.net" 
	VIAddVersionKey          "FileDescription"       "dc++"
	
; !define SF_SELECTED   1
; !define SF_SUBSEC     2
; !define SF_SUBSECEND  4
; !define SF_BOLD       8
; !define SF_RO         16
; !define SF_EXPAND     32
; !define SECTION_OFF   0xFFFFFFFE
; ExecShell

; Main Install settings
Name "${APPNAMEANDVERSION}"
InstallDir "$PROGRAMFILES\Home"
InstallDirRegKey HKLM "Software\${APPNAME}" ""
;OutFile "home_pack_full.exe"
OutFile "home_pack_full-${PRODUCT_VERSION}.exe"
; Modern interface settings
!include "MUI2.nsh"
;kill
!include "nsProcess.nsh"
!include "Sections.nsh"

  !define MUI_HEADERIMAGE
  !define MUI_HEADERIMAGE_BITMAP "logo.bmp" ; optional
	
;!define MUI_COMPONENTSPAGE_SMALLDESC
!define MUI_INSTFILESPAGE_COLORS "FFFFFF 000000" ;Два цвета


!define MUI_ABORTWARNING
!define MUI_FINISHPAGE_RUN_NOTCHECKED
!define MUI_FINISHPAGE_RUN_TEXT "Выберите что бы запустить DC++"
!define MUI_FINISHPAGE_RUN "$INSTDIR\greylink\greylink.exe"

!insertmacro MUI_PAGE_WELCOME
!insertmacro MUI_PAGE_LICENSE "License.txt"
!insertmacro MUI_PAGE_COMPONENTS
!insertmacro MUI_PAGE_DIRECTORY
!insertmacro MUI_PAGE_INSTFILES
!insertmacro MUI_PAGE_FINISH

!insertmacro MUI_UNPAGE_CONFIRM
!insertmacro MUI_UNPAGE_INSTFILES

; Set languages (first is default language)
;!insertmacro MUI_LANGUAGE "English"
!insertmacro MUI_LANGUAGE "Russian"
!insertmacro MUI_RESERVEFILE_LANGDLL


Section /o  "Windows x86 32bit" Section1
 	
	; Set Section properties
	SetOverwrite on

	; Set Section Files and Shortcuts
	SetOutPath "$INSTDIR\greylink\"
	File /r "greylink0025\greylink\*.*"
	
	SetOutPath "$INSTDIR\homenet\"
	File /r "homenet_tool\*.*"

	SetOutPath "$INSTDIR\tightvnc\"
	File /r "tightvnc\*.*"
	
	CreateShortCut "$DESKTOP\Greylink.lnk" "$INSTDIR\greylink\greylink.exe"
	CreateDirectory "$SMPROGRAMS\Home"
	CreateShortCut "$SMPROGRAMS\Home\ping_test.lnk" "$INSTDIR\homenet\ping.exe"
	
	;сайты
	CreateShortCut "$SMPROGRAMS\Home\Сайт Home.lnk" "http://home/" "" "$INSTDIR\home\home.ico"
	CreateShortCut "$DESKTOP\Сайт Home.lnk" "http://home/" "" "$INSTDIR\home\homenet.ico"
	CreateShortCut "$SMPROGRAMS\Home\WinMTR.lnk" "$INSTDIR\home\winmtr_0.8\WinMTR.exe"
	CreateShortCut "$SMPROGRAMS\Home\Статистика Интернета.lnk" "https://stat/" "" "$INSTDIR\home\home.ico"
	CreateShortCut "$DESKTOP\Статистика Интернета.lnk" "https://stat/" "" "$INSTDIR\home\home.ico"
	CreateShortCut "$SMPROGRAMS\Home\Медиасервер.lnk" "http://media.home/" "" "$INSTDIR\home\mediahome.ico"

	
	CreateShortCut "$SMPROGRAMS\Home\Greylink.lnk" "$INSTDIR\greylink\greylink.exe"
  CreateShortCut "$SMPROGRAMS\Home\VNC.lnk" "$INSTDIR\tightvnc\WinVNC.exe"

	CreateShortCut "$SMPROGRAMS\Home\Uninstall.lnk" "$INSTDIR\uninstall.exe"
		CreateShortCut "$SMPROGRAMS\Home\IPTV.lnk" "$INSTDIR\IPTVplayer\IpTvPlayer.exe"
	
SectionEnd
Section /o "IPTV beta1" Section11
	SetOutPath "$INSTDIR\IPTVplayer"
	
	File /r "IP-TV_Playerb1\*.*"
	
	SectionEnd
Section /o "Windows x64 64bit" Section2

	; Set Section properties
	SetOverwrite on

	; Set Section Files and Shortcuts
	SetOutPath "$INSTDIR\greylink\"
	File /r "greylink0022-x64\greylink\*.*"

	SetOutPath "$INSTDIR\home\"
	File /r "home_tool\*.*"

	SetOutPath "$INSTDIR\tightvnc\"
	File /r "tightvnc\*.*"
	
	CreateShortCut "$DESKTOP\Greylink.lnk" "$INSTDIR\greylink\greylink.exe"
	CreateDirectory "$SMPROGRAMS\Home"

	CreateShortCut "$SMPROGRAMS\Home\ping_test.lnk" "$INSTDIR\home\ping.exe"
  CreateShortCut "$SMPROGRAMS\Home\Greylink.lnk" "$INSTDIR\greylink\greylink.exe"
 
	;сайты
	CreateShortCut "$SMPROGRAMS\Home\Сайт Home-net.lnk" "http://home/" "" "$INSTDIR\home\home.ico"
	CreateShortCut "$SMPROGRAMS\Home\WinMTR.lnk" "$INSTDIR\home\winmtr_0.8\WinMTR.exe"
	CreateShortCut "$DESKTOP\Сайт Home.lnk" "http://home/" "" "$INSTDIR\home\home.ico"
	CreateShortCut "$SMPROGRAMS\Home\Статистика Интернета.lnk" "https://stat/" "" "$INSTDIR\home\home.ico"
	CreateShortCut "$DESKTOP\Статистика Интернета.lnk" "https://stat/" "" "$INSTDIR\home\home.ico"
	CreateShortCut "$SMPROGRAMS\Homenet\Медиасервер home.lnk" "http://media.home/" "" "$INSTDIR\home\home.ico"

  CreateShortCut "$SMPROGRAMS\Home\VNC.lnk" "$INSTDIR\tightvnc\WinVNC.exe"
 
	CreateShortCut "$SMPROGRAMS\Home\Uninstall.lnk" "$INSTDIR\uninstall.exe"
 	CreateShortCut "$SMPROGRAMS\Home\IPTV.lnk" "$INSTDIR\IPTVplayer\IpTvPlayer.exe"

SectionEnd
;служба DHCP-клиент (DHCP Client)
Section /o "включить DHCP-клиент" Section3
	; Set Section properties
	SetOverwrite on
	GetVersion::WindowsName
	Pop $R0
	
	StrCmp $R0 "7" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dhcp" "Start" "00000002"
	
	StrCmp $R0 "Vista" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dhcp" "Start" "00000002"

	StrCmp $R0 "XP" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dhcp" "Start" "00000002"
	
	StrCmp $R0 "XP x64" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dhcp" "Start" "00000002"
	
SectionEnd
;DNS-клиент (DNS Client)
Section /o "включить DNS-клиент" Section4
	; Set Section properties
	SetOverwrite on
	GetVersion::WindowsName
	Pop $R0
	
	StrCmp $R0 "7" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dnscache" "Start" "00000002"
	
	StrCmp $R0 "Vista" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dnscache" "Start" "00000002"

	StrCmp $R0 "XP" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dnscache" "Start" "00000002"
	
	StrCmp $R0 "XP x64" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dnscache" "Start" "00000002"
	
SectionEnd

;IPSEC Services (Службы IPSEC)
Section /o "Отключить службу IPSEC" Section5
	; Set Section properties
	SetOverwrite on
	GetVersion::WindowsName
	Pop $R0
	
	StrCmp $R0 "7" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\PolicyAgent" "Start" "00000004"
	
	StrCmp $R0 "Vista" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\PolicyAgent" "Start" "00000004"

	StrCmp $R0 "XP" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\PolicyAgent" "Start" "00000004"
	
	StrCmp $R0 "XP x64" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\PolicyAgent" "Start" "00000004"
	
SectionEnd

;автозагрузка ДС+++
Section /o "автозагрузка DC++" Section6
	;autostart 
	WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Run" "home" "$INSTDIR\greylink\greylink.exe"
SectionEnd

Section /o "отключить IP версии 6" Section7
	;ipv6
	GetVersion::WindowsName
	Pop $R0
	
	StrCmp $R0 "Vista" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters\" "DisabledComponents" "0xffffffff"
	
	StrCmp $R0 "7" 0 +2
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters\" "DisabledComponents" "4294967295"

SectionEnd
;службы для создания подключения
Section /o "службы для создания подключения" Section8
	; Set Section properties
	SetOverwrite on
	;Remote Access Connection Manager (Диспетчер подключений удаленного доступа)
	;Remote Procedure Call (Локатор удаленного вызова процедур (RPC))
 	;Plug and Play (Plug and Play)
  ;Telephony (Телефония)
	;TCP/IP NetBIOS Helper Service (Модуль поддержки NetBIOS через TCP/IP)
	;DCOM Server Process Launcher (Запуск серверных процессов DCOM)
	;Server (Сервер)
	GetVersion::WindowsName
	Pop $R0
	
	StrCmp $R0 "7" 0 +8
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RasAuto" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RasMan" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RpcLocator" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\TapiSrv" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\lmhosts" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\DcomLaunch" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\LanmanServer" "Start" "00000002"
	
	StrCmp $R0 "Vista" 0 +8
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RasAuto" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RasMan" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RpcLocator" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\TapiSrv" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\lmhosts" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\DcomLaunch" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\LanmanServer" "Start" "00000002"
	

	StrCmp $R0 "XP" 0 +8
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RasMan" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RpcLocator" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\PlugPlay" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\TapiSrv" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\LmHosts" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\DcomLaunch" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\lanmanserver" "Start" "00000002"
	
	StrCmp $R0 "XP x64" 0 +8
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RasMan" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RpcLocator" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\PlugPlay" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\TapiSrv" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\LmHosts" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\DcomLaunch" "Start" "00000002"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\lanmanserver" "Start" "00000002"
	
SectionEnd
Section /o "отключить Брандмауэр Windows" Section9
	;ipv6
	GetVersion::WindowsName
	Pop $R0
	;Общий доступ к подключению к Интернету (ICS) (Internet Connection Sharing (ICS))
  ;Брандмауэр Windows (Windows Firewall)
	;Security Center (Центр обеспечения безопасности)
	StrCmp $R0 "7" 0 +4
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\SharedAccess" "Start" "00000004"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\MpsSv" "Start" "00000004"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\wscsvc" "Start" "00000004"
	
	StrCmp $R0 "Vista" 0 +4
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\SharedAccess" "Start" "00000004"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\MpsSv" "Start" "00000004"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\wscsvc" "Start" "00000004"
	
	StrCmp $R0 "XP x64" 0 +3
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\SharedAccess" "Start" "00000004"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\wscsvc" "Start" "00000004"	
	
	StrCmp $R0 "XP" 0 +3
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\SharedAccess" "Start" "00000004"
	WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\wscsvc" "Start" "00000004"
	
SectionEnd
Section /o "Перезаписать список Хабов" Section10
	SetOverwrite on
	;		SetOutPath "$INSTDIR\greylink\Settings\"
	;		File "homenet_tool\Favorites.xml"
	
	
		IfFileExists "$INSTDIR\greylink\Settings\Favorites.xml" 0 true_section10 
		MessageBox MB_YESNO "Файл с списком Хабов существует - Вы хотите его переписать? Если Вы его перепишете то пароли от хабов потеряются!!!" IDYES true_section10 IDNO false_section10
		true_section10:	
			SetOutPath "$INSTDIR\greylink\Settings\"
			File "settings\homenet\Favorites.xml"
			MessageBox MB_OK "Текущий список хабов: home: hub.home (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться."
		  Goto next_section10
		false_section10:
			MessageBox MB_OK "Текущий список хабов: home: hub.home (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться."
		next_section10:
		
		
SectionEnd

Function .onSelChange 
 SectionGetFlags ${section1} $1 
 SectionGetFlags ${section2} $2 

StrCmp $1 "1" 0 N1 
 SectionGetFlags ${section2} $0 
 IntOp $0 $0 & ${SECTION_OFF} 
 SectionSetFlags ${section2} $0
 

N1: 
StrCmp $2 "1" 0 N2 
 SectionGetFlags ${section1} $0 
 IntOp $0 $0 & ${SECTION_OFF} 
 SectionSetFlags ${section1} $0  
 
N2:


FunctionEnd

Section -FinishSection

	WriteRegStr HKLM "Software\${APPNAME}" "" "$INSTDIR"
	WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}" "DisplayName" "${APPNAME}"
	WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}" "UninstallString" "$INSTDIR\uninstall.exe"
	WriteUninstaller "$INSTDIR\uninstall.exe"

	;vnc section
	;seven
	GetVersion::WindowsName
	Pop $R0
	;DHCP-клиент (DHCP Client)
	;DNS-клиент (DNS Client)
	;Агент политики IPsec (IPsec Policy Agent)
	;Маршрутизация и удаленный доступ (Routing and Remote Access)
	;StrCmp $R0 "7" 0 +7
	;WriteRegBin  HKCU "Software\ORL\WinVNC3" "Password" "04a80c01b072856f"
	;WriteRegBin  HKCU "Software\ORL\WinVNC3" "PasswordViewOnly" "04a80c01b072856f"
	;WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dhcp" "Start" "00000002"
	;WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\Dnscache" "Start" "00000002"
	;WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\PolicyAgent" "Start" "00000003"
	;WriteRegDWORD HKLM "SYSTEM\CurrentControlSet\Services\RemoteAccess" "Start" "00000004"
	;GetVersion::WindowsName
	;Pop $R0
	;StrCmp $R0 "xp" 0 +3
	;WriteRegBin  HKCU "S-1-5-21-1801674531-1343024091-789743027-1004\Software\ORL\WinVNC3" "Password" "04a80c01b072856f"
	;WriteRegBin  HKCU "S-1-5-21-1801674531-1343024091-789743027-1004\Software\ORL\WinVNC3" "PasswordViewOnly" "04a80c01b072856f"
	
MessageBox MB_YESNO|MB_ICONQUESTION "Нужно перезегрузиться. Хотите выполнить перезагрузку сейчас?" IDNO +3
Exec '"$INSTDIR\home\route_f.bat"'
Reboot
SectionEnd

; Modern install component descriptions
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN
	!insertmacro MUI_DESCRIPTION_TEXT ${Section1} "Windows XP,Vista,7 32bit"
	!insertmacro MUI_DESCRIPTION_TEXT ${Section2} "Widows XP, Vista, 7 64bit"
	!insertmacro MUI_DESCRIPTION_TEXT ${Section3} "Включить службу DHCP-клиент (DHCP Client)"
	!insertmacro MUI_DESCRIPTION_TEXT ${Section4} "Включить службу DNS-клиент (DNS Client)"
	!insertmacro MUI_DESCRIPTION_TEXT ${Section5} "Отключить службу IPSEC"	
	!insertmacro MUI_DESCRIPTION_TEXT ${Section6} "включить автозагрузку ДС++"	
	!insertmacro MUI_DESCRIPTION_TEXT ${Section7} "отключить TCP/IP версии 6 Windows Vista, 7 у Нас не используется но является брешью в безопасности"	
	!insertmacro MUI_DESCRIPTION_TEXT ${Section8} "службы для создания подключения: 	Remote Access Connection Manager (Диспетчер подключений удаленного доступа), Remote Procedure Call (Локатор удаленного вызова процедур (RPC)), Plug and Play (Plug and Play), Telephony (Телефония), TCP/IP NetBIOS Helper Service (Модуль поддержки NetBIOS через TCP/IP), DCOM Server Process Launcher (Запуск серверных процессов DCOM),Server (Сервер)" 
	!insertmacro MUI_DESCRIPTION_TEXT ${Section9} "Отключить службы: Общий доступ к подключению к Интернету (ICS) (Internet Connection Sharing (ICS)), Брандмауэр Windows (Windows Firewall), Security Center (Центр обеспечения безопасности)"
	!insertmacro MUI_DESCRIPTION_TEXT ${Section10} "Записывает файл со списком хабов. Однако в этом же файле хранятся и пароли. Будьте внимательны если Вы не хотите потерять пароли!"
!insertmacro MUI_FUNCTION_DESCRIPTION_END

;Uninstall section
Section Uninstall

	;Remove from registry...
	DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}"
	DeleteRegValue HKLM "Software\Microsoft\Windows\CurrentVersion\Run" "homenet"
	DeleteRegKey HKLM "SOFTWARE\${APPNAME}"

	; Delete self
	Delete "$INSTDIR\uninstall.exe"

	; Delete Shortcuts
	Delete "$DESKTOP\Greylink.lnk"
	Delete "$SMPROGRAMS\Home\ping_test.lnk" 
	Delete "$SMPROGRAMS\Home\Greylink.lnk"
	Delete "$SMPROGRAMS\Home\Uninstall.lnk"
	;Delete "$SMPROGRAMS\Home\VNC.lnk"
	Delete "$SMPROGRAMS\Home\ping_test.lnk" 
	; RMDir /r "$SMPROGRAMS\Home\"
	RMDir /r "$INSTDIR\greylink\"

SectionEnd

Function .onGUIEnd
	NSIS_SkinCrafter_Plugin::destroy
FunctionEnd

Function un.onInit
    ;User defined skin
    ;SetOutPath $TEMP
    ;File /oname=Stylish.skf "Stylish.skf"
    ;NSIS_SkinCrafter_Plugin::skin /NOUNLOAD $TEMP\Stylish.skf
    ;Delete $TEMP\Stylish.skf

    ;Default Skin
    NSIS_SkinCrafter_Plugin::skin /NOUNLOAD
FunctionEnd

Function un.onGUIEnd
	NSIS_SkinCrafter_Plugin::destroy
FunctionEnd

; On initialization
Function .onInit
		;User defined skin
    SetOutPath $TEMP
    File /oname=Gloss.skf "Gloss.skf"
    NSIS_SkinCrafter_Plugin::skin /NOUNLOAD $TEMP\Gloss.skf
    Delete $TEMP\Gloss.skf

    ;Default Skin
    ;NSIS_SkinCrafter_Plugin::skin /NOUNLOAD
		
	
	;enable DHCP client by default
	SectionSetFlags ${section3} 1
	;enable DNS client by default
	SectionSetFlags ${section4} 1	
	;disable IPSEC Services (Службы IPSEC)
	SectionSetFlags ${section5} 1	
	;autostart dc++
	SectionSetFlags ${section6} 1	
	;ип версии 6
	SectionSetFlags ${Section7} 1
	SectionSetFlags ${Section8} 1
	SectionSetFlags ${Section9} 0
	;IfFileExists "$INSTDIR\greylink\Settings\Favorites.xml" 0  
	;SectionSetFlags ${Section10} 0
	;Goto
	SectionSetFlags ${Section10} 1
	
	;IfFileExists "$INSTDIR\greylink\Settings\Favorites.xml" 0 true_section10 
	;	MessageBox MB_YESNO "Файл с списком Хабов существует - Вы хотите его переписать? Если Вы его перепишете то пароли от хабов потеряются!!!" IDYES true_section10 IDNO false_section10
	;	true_section10:	
	;		SectionSetFlags ${Section10} 1
	;	  Goto next_section10
	;	false_section10:
	;		SectionSetFlags ${Section10} 0
	;		MessageBox MB_OK "Текущий список хабов: home: hub.homenet (10.1.1.1). Если он у Вас другой - добавьте их. Внимание ИП адресс может меняться."
	;	next_section10:
	;	
	;if 32 bit set for 32bit
	GetVersion::WindowsPlatformId
	Pop $R0
	SectionSetFlags ${section1} 0
	SectionSetFlags ${section2} 1
	;Goto +7
	StrCmp $R0 "64" 0 +4
	SectionSetFlags ${section1} 0
	SectionSetFlags ${section2} 1
	Goto +3
	SectionSetFlags ${section1} 1
  SectionSetFlags ${section2} 0
	;;;;;;;;;;;;;;;;;
Goto start
end:
	Quit
start:	
	${nsProcess::FindProcess} "greylink.exe" $R0
	StrCmp $R0 0 0 +5
	MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION 'Закрыть "ДС++" для продолжения установки?' IDOK loop IDCANCEL end
loop:
	${nsProcess::KillProcess} "greylink.exe" $R0
	MessageBox MB_OK "Приложение ДС++ было завершено" ;	Errorlevel: [$R0]"
	${nsProcess::Unload}

	;end:
	; kill DC++
  ; nsExec::Exec '$INSTDIR\home\wkill.exe -n "greylink.exe"'
	!insertmacro MUI_LANGDLL_DISPLAY

FunctionEnd

BrandingText "home"

; eof

</pre>

<a href="http://depositfiles.com/files/6zcndegap" title="tools.rar" rel="nofollow">исходные программы нужные для сборки</a>