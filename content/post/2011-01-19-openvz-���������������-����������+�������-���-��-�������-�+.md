---
title: Openvz сохранение виртуальных нод на хост машину вариант 1-rsync, tar, 7zip, bzip2 и большая нагрузка
author: wel
type: post
date: 2011-01-19T16:56:41+00:00
url: /virtualization/openvz-сохранение-виртуальных-нод-на-хост-м
short-url:
  - http://bit.ly/fAtuB2
wp-syntax-cache-content:
  - |
    a:6:{i:1;s:463:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="php" style="font-family:monospace;">VE_PRIVATE<span style="color: #339933;">=/</span>vz<span style="color: #339933;">/</span><span style="color: #000000; font-weight: bold;">private</span><span style="color: #339933;">/</span><span style="color: #000088;">$VEID</span></pre></td></tr></table><p class="theCode" style="display:none;">VE_PRIVATE=/vz/private/$VEID</p></div>
    ";i:2;s:33114:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    103
    104
    105
    106
    107
    108
    109
    110
    </pre></td><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/sh</span>
    <span style="color: #666666; font-style: italic;"># Размещено на http://b-comm.ru/?p=119</span>
    <span style="color: #666666; font-style: italic;"># Автор wel: valeranew@ukr.net</span>
    <span style="color: #666666; font-style: italic;"># script номер 1: сохранение нод, но не учитывается то что скрипт может </span>
    <span style="color: #666666; font-style: italic;"># подвесить всю родительскую HN-ноду</span>
    <span style="color: #666666; font-style: italic;"># у Меня виртуальна нода из-за большого LA выключила некоторые сервисы</span>
    <span style="color: #666666; font-style: italic;"># советую вторую реализацию найти или выкинуть bzip / 7zip </span>
    &nbsp;
    <span style="color: #007800;">VZ_ROOT</span>=<span style="color: #ff0000;">&quot;/vz/private&quot;</span>
    <span style="color: #007800;">VZ_DUMP_ROOT</span>=<span style="color: #ff0000;">&quot;/vz/private/dump&quot;</span>
    &nbsp;
    <span style="color: #007800;">VZCTL</span>=<span style="color: #ff0000;">&quot;/usr/sbin/vzctl &quot;</span>
    &nbsp;
    &nbsp;
    &nbsp;
    <span style="color: #007800;">VZ_NotStop</span>=<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #666666; font-style: italic;">#пишем подряд контейнеры, которые будут зависить друг от друга</span>
    &nbsp;
    <span style="color: #7a0874; font-weight: bold;">shopt</span> <span style="color: #660033;">-s</span> extglob
    &nbsp;
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #660033;">-d</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$VZ_ROOT</span>&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
            <span style="color: #c20cb9; font-weight: bold;">mkdir</span> <span style="color: #660033;">-p</span> <span style="color: #007800;">$VZ_ROOT</span>
    <span style="color: #000000; font-weight: bold;">fi</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #660033;">-d</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$VZ_DUMP_ROOT</span>&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
            <span style="color: #c20cb9; font-weight: bold;">mkdir</span> <span style="color: #660033;">-p</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span>
    <span style="color: #000000; font-weight: bold;">fi</span>
    &nbsp;
    <span style="color: #7a0874; font-weight: bold;">cd</span> <span style="color: #007800;">$VZ_ROOT</span>
    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;------------------------------------------------------------------------------------------------------&quot;</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">for</span> DIR <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">*</span>
    <span style="color: #000000; font-weight: bold;">do</span>
            <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span>  <span style="color: #660033;">-d</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$DIR</span>&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$DIR</span>&quot;</span> <span style="color: #000000; font-weight: bold;">!</span>= +<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">0</span>-<span style="color: #000000;">9</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                            <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Не сохраняю <span style="color: #007800;">$DIR</span> так как директория содержит буквы&quot;</span>
                    <span style="color: #000000; font-weight: bold;">else</span>
                            <span style="color: #007800;">NOT_BACKUP</span>=<span style="color: #000000;">0</span>
                            <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">i</span>=<span style="color: #000000;">0</span>; i<span style="color: #000000; font-weight: bold;">&lt;</span><span style="color: #800000;">${#VZ_NotStop[@]}</span>; i++<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>; <span style="color: #000000; font-weight: bold;">do</span>
                                    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">${VZ_NotStop[$i]}</span>&quot;</span> <span style="color: #660033;">-eq</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$DIR</span>&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                                             <span style="color: #007800;">NOT_BACKUP</span>=<span style="color: #000000;">1</span>
                                    <span style="color: #000000; font-weight: bold;">fi</span>
                            <span style="color: #000000; font-weight: bold;">done</span>
    &nbsp;
                            <span style="color: #007800;">RUN_OUT</span>=<span style="color: #000000; font-weight: bold;">`</span>vzlist <span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">awk</span> <span style="color: #ff0000;">'{print $1}'</span><span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #660033;">-v</span> V<span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #ff0000;">&quot;\&lt;<span style="color: #007800;">$DIR</span>\&gt;&quot;</span><span style="color: #000000; font-weight: bold;">`</span>
                            <span style="color: #7a0874; font-weight: bold;">let</span> <span style="color: #ff0000;">&quot; VZ_RUN = RUN_OUT + 0&quot;</span>
                            <span style="color: #666666; font-style: italic;">#Содержит значение текущей OVZ или пустую строку</span>
                            <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$VZ_RUN</span>&quot;</span>  <span style="color: #660033;">-eq</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$DIR</span>&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                                    <span style="color: #007800;">VZ_IS_RUNNING</span>=<span style="color: #000000;">1</span>
                            <span style="color: #000000; font-weight: bold;">else</span>
                                    <span style="color: #007800;">VZ_IS_RUNNING</span>=<span style="color: #000000;">0</span>
                            <span style="color: #000000; font-weight: bold;">fi</span>
    &nbsp;
                             <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$NOT_BACKUP</span>&quot;</span> <span style="color: #660033;">-eq</span> <span style="color: #ff0000;">&quot;1&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$DIR</span> не будет сохранено&quot;</span>
                             <span style="color: #000000; font-weight: bold;">else</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Сохраняю <span style="color: #007800;">$DIR</span>&quot;</span>
                                    <span style="color: #007800;">a</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #000000; font-weight: bold;">if</span>  <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$VZ_IS_RUNNING</span>&quot;</span>  <span style="color: #660033;">-eq</span> <span style="color: #ff0000;">&quot;1&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                                    <span style="color: #007800;">$VZCTL</span> stop <span style="color: #007800;">$DIR</span>  <span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #000000; font-weight: bold;">fi</span>
                                    <span style="color: #c20cb9; font-weight: bold;">nice</span> <span style="color: #660033;">-n</span> <span style="color: #660033;">-19</span> ionice <span style="color: #660033;">-c1</span> rsync <span style="color: #660033;">-acr</span> <span style="color: #660033;">--numeric-ids</span> <span style="color: #660033;">--force</span> <span style="color: #660033;">--delete-excluded</span> <span style="color: #660033;">--delete-after</span>  <span style="color: #660033;">--max-delete</span>=<span style="color: #000000;">200</span>  <span style="color: #007800;">$VZ_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$DIR</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span>  <span style="color: #666666; font-style: italic;">#&gt;/dev/null 2&gt;&amp;1</span>
                                    <span style="color: #000000; font-weight: bold;">if</span>  <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$VZ_IS_RUNNING</span>&quot;</span>  <span style="color: #660033;">-eq</span> <span style="color: #ff0000;">&quot;1&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                                            <span style="color: #007800;">$VZCTL</span> start <span style="color: #007800;">$DIR</span> <span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #000000; font-weight: bold;">fi</span>
                                    <span style="color: #007800;">b</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #7a0874; font-weight: bold;">let</span> <span style="color: #ff0000;">&quot;e = b -a&quot;</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Сохранение <span style="color: #007800;">$DIR</span> заняло <span style="color: #007800;">$e</span> sec&quot;</span>
    &nbsp;
                                 <span style="color: #000000; font-weight: bold;">if</span>  <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$VZ_IS_RUNNING</span>&quot;</span>  <span style="color: #660033;">-eq</span> <span style="color: #ff0000;">&quot;1&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Архивирование начато&quot;</span>
                                    <span style="color: #007800;">a</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #007800;">NAME</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>Y-<span style="color: #000000; font-weight: bold;">%</span>m-<span style="color: #000000; font-weight: bold;">%</span>d--<span style="color: #000000; font-weight: bold;">%</span>H-<span style="color: #000000; font-weight: bold;">%</span>M-<span style="color: #000000; font-weight: bold;">%</span>S<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #007800;">TAR_NAME</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$DIR</span>.<span style="color: #007800;">$NAME</span>.tar&quot;</span>
                                    <span style="color: #007800;">TAR_NAME_FOR_7z</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$DIR</span>.<span style="color: #007800;">$NAME</span>.7.tar&quot;</span>
                                    <span style="color: #007800;">P7ZIP_DUMP</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$VZ_DUMP_ROOT</span>/<span style="color: #007800;">$TAR_NAME_FOR_7z</span>&quot;</span>
                                    <span style="color: #c20cb9; font-weight: bold;">nice</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">19</span> ionice <span style="color: #660033;">-c3</span> <span style="color: #c20cb9; font-weight: bold;">tar</span> <span style="color: #660033;">--ignore-failed-read</span> <span style="color: #660033;">-cf</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$TAR_NAME</span> <span style="color: #007800;">$DIR</span><span style="color: #000000; font-weight: bold;">/</span>  <span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #007800;">c</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #7a0874; font-weight: bold;">let</span> <span style="color: #ff0000;">&quot;d = c -a&quot;</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Время работы tar <span style="color: #007800;">$d</span> sec&quot;</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Начинаю архивировать <span style="color: #007800;">$TAR_NAME_FOR_7z</span>.7z&quot;</span>
                                    <span style="color: #007800;">g</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
    &nbsp;
                                    <span style="color: #666666; font-style: italic;">#нужно для 7zip#</span>
                                    <span style="color: #c20cb9; font-weight: bold;">nice</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">19</span> ionice <span style="color: #660033;">-c3</span> <span style="color: #c20cb9; font-weight: bold;">cp</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$TAR_NAME</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$TAR_NAME_FOR_7z</span>
    &nbsp;
                                    <span style="color: #c20cb9; font-weight: bold;">nice</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">19</span> ionice <span style="color: #660033;">-c3</span> 7z a <span style="color: #660033;">-t7z</span> <span style="color: #660033;">-mx9</span>   <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$TAR_NAME_FOR_7z</span>.7z  <span style="color: #007800;">$P7ZIP_DUMP</span>  <span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #007800;">c</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #7a0874; font-weight: bold;">let</span> <span style="color: #ff0000;">&quot;PKZIP = g -c&quot;</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Время архивирования <span style="color: #007800;">$TAR_NAME_FOR_7z</span>.7z <span style="color: #007800;">$PKZIP</span> sec&quot;</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Архивирую <span style="color: #007800;">$TAR_NAME</span>.bz2&quot;</span>
                                    <span style="color: #007800;">u</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #c20cb9; font-weight: bold;">nice</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">19</span> ionice <span style="color: #660033;">-c3</span> <span style="color: #c20cb9; font-weight: bold;">bzip2</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$TAR_NAME</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #007800;">i</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #7a0874; font-weight: bold;">let</span> <span style="color: #ff0000;">&quot;BZIP = i -u&quot;</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Время архивирования <span style="color: #007800;">$TAR_NAME</span> <span style="color: #007800;">$BZIP</span> sec&quot;</span>
                                    <span style="color: #007800;">b</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #000000; font-weight: bold;">%</span>s<span style="color: #000000; font-weight: bold;">`</span>
                                    <span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$TAR_NAME</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #007800;">$P7ZIP_DUMP</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$DIR</span>.latest.tar.bz2  <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #c20cb9; font-weight: bold;">cp</span> <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$TAR_NAME</span>.bz2 <span style="color: #007800;">$VZ_DUMP_ROOT</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$DIR</span>.latest.tar.bz2  <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span>
                                    <span style="color: #7a0874; font-weight: bold;">let</span> <span style="color: #ff0000;">&quot;e = b -a&quot;</span>
                                    <span style="color: #666666; font-style: italic;">#echo &quot;Архивирование занало  $e sec  из них ==  BZIP: $BZIP sec&quot;</span>
                                    <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;Архивирование занало  <span style="color: #007800;">$e</span> sec из них == PKZIP: <span style="color: #007800;">$PKZIP</span> sec BZIP: <span style="color: #007800;">$BZIP</span> sec&quot;</span>
                                 <span style="color: #000000; font-weight: bold;">fi</span>
    &nbsp;
                             <span style="color: #000000; font-weight: bold;">fi</span>
                    <span style="color: #000000; font-weight: bold;">fi</span>
            <span style="color: #000000; font-weight: bold;">fi</span>
    <span style="color: #000000; font-weight: bold;">done</span>
    <span style="color: #666666; font-style: italic;">#Внимательнее тут - Я перезапустил все виртуальные машины!!!</span>
    <span style="color: #000000; font-weight: bold;">/</span>etc<span style="color: #000000; font-weight: bold;">/</span>init.d<span style="color: #000000; font-weight: bold;">/</span>vz restart</pre></td></tr></table><p class="theCode" style="display:none;">#!/bin/sh
    # Размещено на http://b-comm.ru/?p=119
    # Автор wel: valeranew@ukr.net
    # script номер 1: сохранение нод, но не учитывается то что скрипт может 
    # подвесить всю родительскую HN-ноду
    # у Меня виртуальна нода из-за большого LA выключила некоторые сервисы
    # советую вторую реализацию найти или выкинуть bzip / 7zip 
    
    VZ_ROOT=&quot;/vz/private&quot;
    VZ_DUMP_ROOT=&quot;/vz/private/dump&quot;
    
    VZCTL=&quot;/usr/sbin/vzctl &quot;
    
    
    
    VZ_NotStop=() #пишем подряд контейнеры, которые будут зависить друг от друга
    
    shopt -s extglob
    
    if [ ! -d &quot;$VZ_ROOT&quot; ]; then
            mkdir -p $VZ_ROOT
    fi
    if [ ! -d &quot;$VZ_DUMP_ROOT&quot; ]; then
            mkdir -p $VZ_DUMP_ROOT
    fi
    
    cd $VZ_ROOT
    echo &quot;------------------------------------------------------------------------------------------------------&quot;
    
    for DIR in *
    do
            if [  -d &quot;$DIR&quot; ]; then
                    if [[ &quot;$DIR&quot; != +([0-9]) ]]; then
                            echo &quot;Не сохраняю $DIR так как директория содержит буквы&quot;
                    else
                            NOT_BACKUP=0
                            for ((i=0; i&lt;${#VZ_NotStop[@]}; i++)); do
                                    if [ &quot;${VZ_NotStop[$i]}&quot; -eq &quot;$DIR&quot; ]; then
                                             NOT_BACKUP=1
                                    fi
                            done
    
                            RUN_OUT=`vzlist |awk '{print $1}'|grep -v V|grep &quot;\&lt;$DIR\&gt;&quot;`
                            let &quot; VZ_RUN = RUN_OUT + 0&quot;
                            #Содержит значение текущей OVZ или пустую строку
                            if [ &quot;$VZ_RUN&quot;  -eq &quot;$DIR&quot; ]; then
                                    VZ_IS_RUNNING=1
                            else
                                    VZ_IS_RUNNING=0
                            fi
    
                             if [ &quot;$NOT_BACKUP&quot; -eq &quot;1&quot; ]; then
                                    echo &quot;$DIR не будет сохранено&quot;
                             else
                                    echo &quot;Сохраняю $DIR&quot;
                                    a=`date +%s`
                                    if  [ &quot;$VZ_IS_RUNNING&quot;  -eq &quot;1&quot; ]; then
                                    $VZCTL stop $DIR  &gt;/dev/null 2&gt;&amp;1
                                    fi
                                    nice -n -19 ionice -c1 rsync -acr --numeric-ids --force --delete-excluded --delete-after  --max-delete=200  $VZ_ROOT/$DIR $VZ_DUMP_ROOT  #&gt;/dev/null 2&gt;&amp;1
                                    if  [ &quot;$VZ_IS_RUNNING&quot;  -eq &quot;1&quot; ]; then
                                            $VZCTL start $DIR &gt;/dev/null 2&gt;&amp;1
                                    fi
                                    b=`date +%s`
                                    let &quot;e = b -a&quot;
                                    echo &quot;Сохранение $DIR заняло $e sec&quot;
    
                                 if  [ &quot;$VZ_IS_RUNNING&quot;  -eq &quot;1&quot; ]; then
                                    echo &quot;Архивирование начато&quot;
                                    a=`date +%s`
                                    NAME=`date +%Y-%m-%d--%H-%M-%S`
                                    TAR_NAME=&quot;$DIR.$NAME.tar&quot;
                                    TAR_NAME_FOR_7z=&quot;$DIR.$NAME.7.tar&quot;
                                    P7ZIP_DUMP=&quot;$VZ_DUMP_ROOT/$TAR_NAME_FOR_7z&quot;
                                    nice -n 19 ionice -c3 tar --ignore-failed-read -cf $VZ_DUMP_ROOT/$TAR_NAME $DIR/  &gt;/dev/null 2&gt;&amp;1
                                    c=`date +%s`
                                    let &quot;d = c -a&quot;
                                    echo &quot;Время работы tar $d sec&quot;
                                    echo &quot;Начинаю архивировать $TAR_NAME_FOR_7z.7z&quot;
                                    g=`date +%s`
    
                                    #нужно для 7zip#
                                    nice -n 19 ionice -c3 cp $VZ_DUMP_ROOT/$TAR_NAME $VZ_DUMP_ROOT/$TAR_NAME_FOR_7z
    
                                    nice -n 19 ionice -c3 7z a -t7z -mx9   $VZ_DUMP_ROOT/$TAR_NAME_FOR_7z.7z  $P7ZIP_DUMP  &gt;/dev/null 2&gt;&amp;1
                                    c=`date +%s`
                                    let &quot;PKZIP = g -c&quot;
                                    echo &quot;Время архивирования $TAR_NAME_FOR_7z.7z $PKZIP sec&quot;
                                    echo &quot;Архивирую $TAR_NAME.bz2&quot;
                                    u=`date +%s`
                                    nice -n 19 ionice -c3 bzip2 $VZ_DUMP_ROOT/$TAR_NAME &gt; /dev/null 2&gt;&amp;1
                                    i=`date +%s`
                                    let &quot;BZIP = i -u&quot;
                                    echo &quot;Время архивирования $TAR_NAME $BZIP sec&quot;
                                    b=`date +%s`
                                    rm $VZ_DUMP_ROOT/$TAR_NAME &gt; /dev/null 2&gt;&amp;1
                                    rm $P7ZIP_DUMP &gt; /dev/null 2&gt;&amp;1
                                    rm $VZ_DUMP_ROOT/$DIR.latest.tar.bz2  &gt; /dev/null 2&gt;&amp;1
                                    cp $VZ_DUMP_ROOT/$TAR_NAME.bz2 $VZ_DUMP_ROOT/$DIR.latest.tar.bz2  &gt; /dev/null 2&gt;&amp;1
                                    let &quot;e = b -a&quot;
                                    #echo &quot;Архивирование занало  $e sec  из них ==  BZIP: $BZIP sec&quot;
                                    echo &quot;Архивирование занало  $e sec из них == PKZIP: $PKZIP sec BZIP: $BZIP sec&quot;
                                 fi
    
                             fi
                    fi
            fi
    done
    #Внимательнее тут - Я перезапустил все виртуальные машины!!!
    /etc/init.d/vz restart</p></div>
    ";i:3;s:31173:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #339933;">-------------------------------------------------------------------------------------------------------</span>
    Сохраняю <span style="color: #cc66cc;">186</span>
    Сохранение <span style="color: #cc66cc;">186</span> заняло <span style="color: #cc66cc;">3296</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">2883</span> sec
    Начинаю архивировать <span style="color:#800080;">186.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #208080;">07</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">42</span><span style="color: #339933;">-</span><span style="color:#800080;">56.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">186.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #208080;">07</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">42</span><span style="color: #339933;">-</span><span style="color:#800080;">56.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">3982</span> sec
    Архивирую <span style="color:#800080;">186.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #208080;">07</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">42</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">56</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">186.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #208080;">07</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">42</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">56</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">1325</span> sec
    Архивирование занало  <span style="color: #cc66cc;">8190</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">3982</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">1325</span> sec
    Сохраняю <span style="color: #cc66cc;">201</span>
    Сохранение <span style="color: #cc66cc;">201</span> заняло <span style="color: #cc66cc;">535</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">325</span> sec
    Начинаю архивировать <span style="color:#800080;">201.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">-</span><span style="color:#800080;">09</span><span style="color: #339933;">-</span><span style="color:#800080;">00.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">201.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">-</span><span style="color:#800080;">09</span><span style="color: #339933;">-</span><span style="color:#800080;">00.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">5251</span> sec
    Архивирую <span style="color:#800080;">201.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">-</span><span style="color:#800080;">09</span><span style="color: #339933;">-</span><span style="color: #208080;">00</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">201.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">-</span><span style="color:#800080;">09</span><span style="color: #339933;">-</span><span style="color: #208080;">00</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">1868</span> sec
    Архивирование занало  <span style="color: #cc66cc;">7444</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">5251</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">1868</span> sec
    Сохраняю <span style="color: #cc66cc;">203</span>
    Сохранение <span style="color: #cc66cc;">203</span> заняло <span style="color: #cc66cc;">90</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">8</span> sec
    Начинаю архивировать <span style="color:#800080;">203.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">-</span><span style="color:#800080;">34.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">203.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">-</span><span style="color:#800080;">34.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">387</span> sec
    Архивирую <span style="color:#800080;">203.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">34</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">203.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">34</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">92</span> sec
    Архивирование занало  <span style="color: #cc66cc;">487</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">387</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">92</span> sec
    Сохраняю <span style="color: #cc66cc;">205</span>
    Сохранение <span style="color: #cc66cc;">205</span> заняло <span style="color: #cc66cc;">83</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">6</span> sec
    Начинаю архивировать <span style="color:#800080;">205.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">26</span><span style="color: #339933;">-</span><span style="color:#800080;">05.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">205.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">26</span><span style="color: #339933;">-</span><span style="color:#800080;">05.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">488</span> sec
    Архивирую <span style="color:#800080;">205.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">26</span><span style="color: #339933;">-</span><span style="color: #208080;">05</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">205.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">26</span><span style="color: #339933;">-</span><span style="color: #208080;">05</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">115</span> sec
    Архивирование занало  <span style="color: #cc66cc;">609</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">488</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">115</span> sec
    Сохраняю <span style="color: #cc66cc;">206</span>
    Сохранение <span style="color: #cc66cc;">206</span> заняло <span style="color: #cc66cc;">64</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">8</span> sec
    Начинаю архивировать <span style="color:#800080;">206.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">37</span><span style="color: #339933;">-</span><span style="color:#800080;">19.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">206.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">37</span><span style="color: #339933;">-</span><span style="color:#800080;">19.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">452</span> sec
    Архивирую <span style="color:#800080;">206.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">37</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">206.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">37</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">112</span> sec
    Архивирование занало  <span style="color: #cc66cc;">572</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">452</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">112</span> sec
    Сохраняю <span style="color: #cc66cc;">207</span>
    Сохранение <span style="color: #cc66cc;">207</span> заняло <span style="color: #cc66cc;">106</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">27</span> sec
    Начинаю архивировать <span style="color:#800080;">207.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">-</span><span style="color:#800080;">39.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">207.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">-</span><span style="color:#800080;">39.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">880</span> sec
    Архивирую <span style="color:#800080;">207.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">39</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">207.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">39</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">252</span> sec
    Архивирование занало  <span style="color: #cc66cc;">1159</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">880</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">252</span> sec
    Сохраняю <span style="color: #cc66cc;">209</span>
    Сохранение <span style="color: #cc66cc;">209</span> заняло <span style="color: #cc66cc;">350</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">195</span> sec
    Начинаю архивировать <span style="color:#800080;">209.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color:#800080;">51.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">209.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color:#800080;">51.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">2040</span> sec
    Архивирую <span style="color:#800080;">209.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">51</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">209.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">51</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">747</span> sec
    Архивирование занало  <span style="color: #cc66cc;">2982</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">2040</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">747</span> sec
    Сохраняю <span style="color: #cc66cc;">223</span>
    Сохранение <span style="color: #cc66cc;">223</span> заняло <span style="color: #cc66cc;">192</span> sec
    Архивирование начато
    Время работы tar <span style="color: #cc66cc;">38</span> sec
    Начинаю архивировать <span style="color:#800080;">223.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">14</span><span style="color: #339933;">-</span><span style="color: #208080;">06</span><span style="color: #339933;">-</span><span style="color:#800080;">57.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z
    Время архивирования <span style="color:#800080;">223.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">14</span><span style="color: #339933;">-</span><span style="color: #208080;">06</span><span style="color: #339933;">-</span><span style="color:#800080;">57.7</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>7z <span style="color: #339933;">-</span><span style="color: #cc66cc;">1351</span> sec
    Архивирую <span style="color:#800080;">223.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">14</span><span style="color: #339933;">-</span><span style="color: #208080;">06</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">57</span><span style="color: #339933;">.</span>tar<span style="color: #339933;">.</span>bz2
    Время архивирования <span style="color:#800080;">223.2011</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">19</span><span style="color: #339933;">--</span><span style="color: #cc66cc;">14</span><span style="color: #339933;">-</span><span style="color: #208080;">06</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">57</span><span style="color: #339933;">.</span>tar <span style="color: #cc66cc;">302</span> sec
    Архивирование занало  <span style="color: #cc66cc;">1691</span> sec из них <span style="color: #339933;">==</span> PKZIP<span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1351</span> sec BZIP<span style="color: #339933;">:</span> <span style="color: #cc66cc;">302</span> sec
    Не сохраняю backup так как директория содержит буквы
    Не сохраняю dump так как директория содержит буквы
    Shutting down VE <span style="color: #cc66cc;">223</span>
    Shutting down VE <span style="color: #cc66cc;">209</span>
    Shutting down VE <span style="color: #cc66cc;">207</span>
    Shutting down VE <span style="color: #cc66cc;">206</span>
    Shutting down VE <span style="color: #cc66cc;">205</span>
    Shutting down VE <span style="color: #cc66cc;">203</span>
    Shutting down VE <span style="color: #cc66cc;">201</span>
    Shutting down VE <span style="color: #cc66cc;">186</span>
    Bringing down <span style="color: #000000; font-weight: bold;">interface</span> venet0<span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Stopping OpenVZ<span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting OpenVZ<span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Bringing up <span style="color: #000000; font-weight: bold;">interface</span> venet0<span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Configuring <span style="color: #000000; font-weight: bold;">interface</span> venet0<span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">186</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">201</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">203</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">205</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">206</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">207</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">209</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done
    Starting VE <span style="color: #cc66cc;">223</span><span style="color: #339933;">:</span> <span style="color: #339933;">..</span>done</pre></td></tr></table><p class="theCode" style="display:none;">-------------------------------------------------------------------------------------------------------
    Сохраняю 186
    Сохранение 186 заняло 3296 sec
    Архивирование начато
    Время работы tar 2883 sec
    Начинаю архивировать 186.2011-01-19--07-42-56.7.tar.7z
    Время архивирования 186.2011-01-19--07-42-56.7.tar.7z -3982 sec
    Архивирую 186.2011-01-19--07-42-56.tar.bz2
    Время архивирования 186.2011-01-19--07-42-56.tar 1325 sec
    Архивирование занало  8190 sec из них == PKZIP: -3982 sec BZIP: 1325 sec
    Сохраняю 201
    Сохранение 201 заняло 535 sec
    Архивирование начато
    Время работы tar 325 sec
    Начинаю архивировать 201.2011-01-19--10-09-00.7.tar.7z
    Время архивирования 201.2011-01-19--10-09-00.7.tar.7z -5251 sec
    Архивирую 201.2011-01-19--10-09-00.tar.bz2
    Время архивирования 201.2011-01-19--10-09-00.tar 1868 sec
    Архивирование занало  7444 sec из них == PKZIP: -5251 sec BZIP: 1868 sec
    Сохраняю 203
    Сохранение 203 заняло 90 sec
    Архивирование начато
    Время работы tar 8 sec
    Начинаю архивировать 203.2011-01-19--12-16-34.7.tar.7z
    Время архивирования 203.2011-01-19--12-16-34.7.tar.7z -387 sec
    Архивирую 203.2011-01-19--12-16-34.tar.bz2
    Время архивирования 203.2011-01-19--12-16-34.tar 92 sec
    Архивирование занало  487 sec из них == PKZIP: -387 sec BZIP: 92 sec
    Сохраняю 205
    Сохранение 205 заняло 83 sec
    Архивирование начато
    Время работы tar 6 sec
    Начинаю архивировать 205.2011-01-19--12-26-05.7.tar.7z
    Время архивирования 205.2011-01-19--12-26-05.7.tar.7z -488 sec
    Архивирую 205.2011-01-19--12-26-05.tar.bz2
    Время архивирования 205.2011-01-19--12-26-05.tar 115 sec
    Архивирование занало  609 sec из них == PKZIP: -488 sec BZIP: 115 sec
    Сохраняю 206
    Сохранение 206 заняло 64 sec
    Архивирование начато
    Время работы tar 8 sec
    Начинаю архивировать 206.2011-01-19--12-37-19.7.tar.7z
    Время архивирования 206.2011-01-19--12-37-19.7.tar.7z -452 sec
    Архивирую 206.2011-01-19--12-37-19.tar.bz2
    Время архивирования 206.2011-01-19--12-37-19.tar 112 sec
    Архивирование занало  572 sec из них == PKZIP: -452 sec BZIP: 112 sec
    Сохраняю 207
    Сохранение 207 заняло 106 sec
    Архивирование начато
    Время работы tar 27 sec
    Начинаю архивировать 207.2011-01-19--12-48-39.7.tar.7z
    Время архивирования 207.2011-01-19--12-48-39.7.tar.7z -880 sec
    Архивирую 207.2011-01-19--12-48-39.tar.bz2
    Время архивирования 207.2011-01-19--12-48-39.tar 252 sec
    Архивирование занало  1159 sec из них == PKZIP: -880 sec BZIP: 252 sec
    Сохраняю 209
    Сохранение 209 заняло 350 sec
    Архивирование начато
    Время работы tar 195 sec
    Начинаю архивировать 209.2011-01-19--13-13-51.7.tar.7z
    Время архивирования 209.2011-01-19--13-13-51.7.tar.7z -2040 sec
    Архивирую 209.2011-01-19--13-13-51.tar.bz2
    Время архивирования 209.2011-01-19--13-13-51.tar 747 sec
    Архивирование занало  2982 sec из них == PKZIP: -2040 sec BZIP: 747 sec
    Сохраняю 223
    Сохранение 223 заняло 192 sec
    Архивирование начато
    Время работы tar 38 sec
    Начинаю архивировать 223.2011-01-19--14-06-57.7.tar.7z
    Время архивирования 223.2011-01-19--14-06-57.7.tar.7z -1351 sec
    Архивирую 223.2011-01-19--14-06-57.tar.bz2
    Время архивирования 223.2011-01-19--14-06-57.tar 302 sec
    Архивирование занало  1691 sec из них == PKZIP: -1351 sec BZIP: 302 sec
    Не сохраняю backup так как директория содержит буквы
    Не сохраняю dump так как директория содержит буквы
    Shutting down VE 223
    Shutting down VE 209
    Shutting down VE 207
    Shutting down VE 206
    Shutting down VE 205
    Shutting down VE 203
    Shutting down VE 201
    Shutting down VE 186
    Bringing down interface venet0: ..done
    Stopping OpenVZ: ..done
    Starting OpenVZ: ..done
    Bringing up interface venet0: ..done
    Configuring interface venet0: ..done
    Starting VE 186: ..done
    Starting VE 201: ..done
    Starting VE 203: ..done
    Starting VE 205: ..done
    Starting VE 206: ..done
    Starting VE 207: ..done
    Starting VE 209: ..done
    Starting VE 223: ..done</p></div>
    ";i:4;s:1085:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    </pre></td><td class="code"><pre class="bash" style="font-family:monospace;"> vzlist  <span style="color: #660033;">-a</span><span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">awk</span> <span style="color: #ff0000;">'{print$1,$5}'</span>
    VEID HOSTNAME
    <span style="color: #000000;">186</span> mail-server
    <span style="color: #000000;">201</span> web-server1
    <span style="color: #000000;">203</span> ns1
    <span style="color: #000000;">205</span> ns2
    <span style="color: #000000;">206</span> xbt-tracker
    <span style="color: #000000;">207</span> verlihub-server
    <span style="color: #000000;">209</span> web-server2
    <span style="color: #000000;">223</span> database-server</pre></td></tr></table><p class="theCode" style="display:none;"> vzlist  -a|awk '{print$1,$5}'
    VEID HOSTNAME
    186 mail-server
    201 web-server1
    203 ns1
    205 ns2
    206 xbt-tracker
    207 verlihub-server
    209 web-server2
    223 database-server</p></div>
    ";i:5;s:12389:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    </pre></td><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">/</span>vz<span style="color: #000000; font-weight: bold;">/</span>private<span style="color: #666666; font-style: italic;"># ls -la dump/|grep -v latest</span>
    итого <span style="color: #000000;">14521388</span>
    drwxr-xr-x <span style="color: #000000;">10</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">35</span> .
    drwx------ <span style="color: #000000;">12</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">33</span> ..
    drwxrwxrwx <span style="color: #000000;">21</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">43</span> <span style="color: #000000;">186</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root  <span style="color: #000000;">733662921</span> Янв <span style="color: #000000;">19</span> 09:<span style="color: #000000;">37</span> <span style="color: #000000;">186.2011</span>-01-<span style="color: #000000;">19</span>--07-<span style="color: #000000;">42</span>-<span style="color: #000000;">56.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root <span style="color: #000000;">1173570629</span> Янв <span style="color: #000000;">19</span> 08:<span style="color: #000000;">30</span> <span style="color: #000000;">186.2011</span>-01-<span style="color: #000000;">19</span>--07-<span style="color: #000000;">42</span>-<span style="color: #000000;">56</span>.tar.bz2
    drwxr-xr-x <span style="color: #000000;">21</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">35</span> <span style="color: #000000;">201</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root <span style="color: #000000;">2743271248</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">11</span>:<span style="color: #000000;">41</span> <span style="color: #000000;">201.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">10</span>-09-<span style="color: #000000;">00.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root <span style="color: #000000;">2863944236</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">10</span>:<span style="color: #000000;">14</span> <span style="color: #000000;">201.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">10</span>-09-00.tar.bz2
    drwxr-xr-x <span style="color: #000000;">21</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">35</span> <span style="color: #000000;">203</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root   <span style="color: #000000;">55583004</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">12</span>:<span style="color: #000000;">23</span> <span style="color: #000000;">203.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">16</span>-<span style="color: #000000;">34.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root   <span style="color: #000000;">86636067</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">12</span>:<span style="color: #000000;">16</span> <span style="color: #000000;">203.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">16</span>-<span style="color: #000000;">34</span>.tar.bz2
    drwxr-xr-x <span style="color: #000000;">21</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">36</span> <span style="color: #000000;">205</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root   <span style="color: #000000;">61589401</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">12</span>:<span style="color: #000000;">34</span> <span style="color: #000000;">205.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">26</span>-<span style="color: #000000;">05.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root   <span style="color: #000000;">96632242</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">12</span>:<span style="color: #000000;">26</span> <span style="color: #000000;">205.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">26</span>-05.tar.bz2
    drwxr-xr-x <span style="color: #000000;">20</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">35</span> <span style="color: #000000;">206</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root   <span style="color: #000000;">53580264</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">12</span>:<span style="color: #000000;">44</span> <span style="color: #000000;">206.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">37</span>-<span style="color: #000000;">19.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root   <span style="color: #000000;">90946031</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">12</span>:<span style="color: #000000;">37</span> <span style="color: #000000;">206.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">37</span>-<span style="color: #000000;">19</span>.tar.bz2
    drwxr-xr-x <span style="color: #000000;">20</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">36</span> <span style="color: #000000;">207</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root  <span style="color: #000000;">112456884</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">13</span>:03 <span style="color: #000000;">207.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">48</span>-<span style="color: #000000;">39.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root  <span style="color: #000000;">205655557</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">12</span>:<span style="color: #000000;">49</span> <span style="color: #000000;">207.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">12</span>-<span style="color: #000000;">48</span>-<span style="color: #000000;">39</span>.tar.bz2
    drwxr-xr-x <span style="color: #000000;">20</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">36</span> <span style="color: #000000;">209</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root  <span style="color: #000000;">443173145</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">13</span>:<span style="color: #000000;">51</span> <span style="color: #000000;">209.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">13</span>-<span style="color: #000000;">13</span>-<span style="color: #000000;">51.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root  <span style="color: #000000;">604901452</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">13</span>:<span style="color: #000000;">17</span> <span style="color: #000000;">209.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">13</span>-<span style="color: #000000;">13</span>-<span style="color: #000000;">51</span>.tar.bz2
    drwxr-xr-x <span style="color: #000000;">21</span> root root       <span style="color: #000000;">4096</span> Янв <span style="color: #000000;">19</span> 06:<span style="color: #000000;">36</span> <span style="color: #000000;">223</span>
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root   <span style="color: #000000;">91173753</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">30</span> <span style="color: #000000;">223.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">14</span>-06-<span style="color: #000000;">57.7</span>.tar.7z
    <span style="color: #660033;">-rw-r--r--</span>  <span style="color: #000000;">1</span> root root  <span style="color: #000000;">158046225</span> Янв <span style="color: #000000;">19</span> <span style="color: #000000;">14</span>:07 <span style="color: #000000;">223.2011</span>-01-<span style="color: #000000;">19</span>--<span style="color: #000000;">14</span>-06-<span style="color: #000000;">57</span>.tar.bz2</pre></td></tr></table><p class="theCode" style="display:none;">/vz/private# ls -la dump/|grep -v latest
    итого 14521388
    drwxr-xr-x 10 root root       4096 Янв 19 14:35 .
    drwx------ 12 root root       4096 Янв 19 15:33 ..
    drwxrwxrwx 21 root root       4096 Янв 19 06:43 186
    -rw-r--r--  1 root root  733662921 Янв 19 09:37 186.2011-01-19--07-42-56.7.tar.7z
    -rw-r--r--  1 root root 1173570629 Янв 19 08:30 186.2011-01-19--07-42-56.tar.bz2
    drwxr-xr-x 21 root root       4096 Янв 19 06:35 201
    -rw-r--r--  1 root root 2743271248 Янв 19 11:41 201.2011-01-19--10-09-00.7.tar.7z
    -rw-r--r--  1 root root 2863944236 Янв 19 10:14 201.2011-01-19--10-09-00.tar.bz2
    drwxr-xr-x 21 root root       4096 Янв 19 06:35 203
    -rw-r--r--  1 root root   55583004 Янв 19 12:23 203.2011-01-19--12-16-34.7.tar.7z
    -rw-r--r--  1 root root   86636067 Янв 19 12:16 203.2011-01-19--12-16-34.tar.bz2
    drwxr-xr-x 21 root root       4096 Янв 19 06:36 205
    -rw-r--r--  1 root root   61589401 Янв 19 12:34 205.2011-01-19--12-26-05.7.tar.7z
    -rw-r--r--  1 root root   96632242 Янв 19 12:26 205.2011-01-19--12-26-05.tar.bz2
    drwxr-xr-x 20 root root       4096 Янв 19 06:35 206
    -rw-r--r--  1 root root   53580264 Янв 19 12:44 206.2011-01-19--12-37-19.7.tar.7z
    -rw-r--r--  1 root root   90946031 Янв 19 12:37 206.2011-01-19--12-37-19.tar.bz2
    drwxr-xr-x 20 root root       4096 Янв 19 06:36 207
    -rw-r--r--  1 root root  112456884 Янв 19 13:03 207.2011-01-19--12-48-39.7.tar.7z
    -rw-r--r--  1 root root  205655557 Янв 19 12:49 207.2011-01-19--12-48-39.tar.bz2
    drwxr-xr-x 20 root root       4096 Янв 19 06:36 209
    -rw-r--r--  1 root root  443173145 Янв 19 13:51 209.2011-01-19--13-13-51.7.tar.7z
    -rw-r--r--  1 root root  604901452 Янв 19 13:17 209.2011-01-19--13-13-51.tar.bz2
    drwxr-xr-x 21 root root       4096 Янв 19 06:36 223
    -rw-r--r--  1 root root   91173753 Янв 19 14:30 223.2011-01-19--14-06-57.7.tar.7z
    -rw-r--r--  1 root root  158046225 Янв 19 14:07 223.2011-01-19--14-06-57.tar.bz2</p></div>
    ";i:6;s:4729:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">Tasks: <span style="color: #000000;">128</span> total,   <span style="color: #000000;">3</span> running, <span style="color: #000000;">125</span> sleeping,   <span style="color: #000000;">0</span> stopped,   <span style="color: #000000;">0</span> zombie
    Cpu<span style="color: #7a0874; font-weight: bold;">&#40;</span>s<span style="color: #7a0874; font-weight: bold;">&#41;</span>:  <span style="color: #000000;">0.7</span><span style="color: #000000; font-weight: bold;">%</span>us,  <span style="color: #000000;">0.3</span><span style="color: #000000; font-weight: bold;">%</span>sy, <span style="color: #000000;">98.7</span><span style="color: #000000; font-weight: bold;">%</span>ni,  <span style="color: #000000;">0.0</span><span style="color: #000000; font-weight: bold;">%</span><span style="color: #c20cb9; font-weight: bold;">id</span>,  <span style="color: #000000;">0.0</span><span style="color: #000000; font-weight: bold;">%</span>wa,  <span style="color: #000000;">0.0</span><span style="color: #000000; font-weight: bold;">%</span>hi,  <span style="color: #000000;">0.3</span><span style="color: #000000; font-weight: bold;">%</span>si,  <span style="color: #000000;">0.0</span><span style="color: #000000; font-weight: bold;">%</span>st
    Mem:   3105112k total,  2936252k used,   168860k <span style="color: #c20cb9; font-weight: bold;">free</span>,    36568k buffers
    Swap:  4096532k total,     1160k used,  4095372k <span style="color: #c20cb9; font-weight: bold;">free</span>,  1913184k cached
    &nbsp;
      PID USER      PR  NI  VIRT  RES  SHR S <span style="color: #000000; font-weight: bold;">%</span>CPU <span style="color: #000000; font-weight: bold;">%</span>MEM    TIME+  COMMAND
    <span style="color: #000000;">29584</span> root      <span style="color: #000000;">39</span>  <span style="color: #000000;">19</span>  678m 674m <span style="color: #000000;">1724</span> R <span style="color: #000000;">98.4</span> <span style="color: #000000;">22.3</span>  <span style="color: #000000;">17</span>:<span style="color: #000000;">04.09</span> 7z
    <span style="color: #000000;">14365</span> Debian-e  <span style="color: #000000;">20</span>   <span style="color: #000000;">0</span> <span style="color: #000000;">27708</span> <span style="color: #000000;">4816</span> <span style="color: #000000;">1620</span> S  <span style="color: #000000;">0.7</span>  <span style="color: #000000;">0.2</span>   <span style="color: #000000;">0</span>:<span style="color: #000000;">04.44</span> pdns_recursor
    <span style="color: #000000;">31387</span> root      <span style="color: #000000;">20</span>   <span style="color: #000000;">0</span>  <span style="color: #000000;">2388</span> <span style="color: #000000;">1144</span>  <span style="color: #000000;">872</span> R  <span style="color: #000000;">0.7</span>  <span style="color: #000000;">0.0</span>   <span style="color: #000000;">0</span>:<span style="color: #000000;">00.04</span> top
        <span style="color: #000000;">1</span> root      <span style="color: #000000;">20</span>   <span style="color: #000000;">0</span>  <span style="color: #000000;">2100</span>  <span style="color: #000000;">696</span>  <span style="color: #000000;">592</span> S  <span style="color: #000000;">0.0</span>  <span style="color: #000000;">0.0</span>   <span style="color: #000000;">0</span>:<span style="color: #000000;">03.84</span> init
        <span style="color: #000000;">2</span> root      <span style="color: #000000;">15</span>  <span style="color: #660033;">-5</span>     <span style="color: #000000;">0</span>    <span style="color: #000000;">0</span>    <span style="color: #000000;">0</span> S  <span style="color: #000000;">0.0</span>  <span style="color: #000000;">0.0</span>   <span style="color: #000000;">0</span>:<span style="color: #000000;">00.00</span> kthreadd</pre></td></tr></table><p class="theCode" style="display:none;">Tasks: 128 total,   3 running, 125 sleeping,   0 stopped,   0 zombie
    Cpu(s):  0.7%us,  0.3%sy, 98.7%ni,  0.0%id,  0.0%wa,  0.0%hi,  0.3%si,  0.0%st
    Mem:   3105112k total,  2936252k used,   168860k free,    36568k buffers
    Swap:  4096532k total,     1160k used,  4095372k free,  1913184k cached
    
      PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
    29584 root      39  19  678m 674m 1724 R 98.4 22.3  17:04.09 7z
    14365 Debian-e  20   0 27708 4816 1620 S  0.7  0.2   0:04.44 pdns_recursor
    31387 root      20   0  2388 1144  872 R  0.7  0.0   0:00.04 top
        1 root      20   0  2100  696  592 S  0.0  0.0   0:03.84 init
        2 root      15  -5     0    0    0 S  0.0  0.0   0:00.00 kthreadd</p></div>
    ";}
categories:
  - virtualization
tags:
  - 7zip
  - bzip2
  - downtime
  - HN-нода
  - OpenVZ
  - rsync
  - tar
  - локально
  - нагрузка
  - нода
  - скрипт

---
## Ставим Цель

Нам нужно держать в некой папке на этом же сервере актуальные копии нод. При этом в добавок складировать архивы с этими нодами.
  
Для проделывания этих действий Я написал скрипт. Так же не учитывается реальное состояние ноды &#8212; были ли реальные изменения или нет? Изменения /var/log &#8212; не очень актуально (разве, что bin-logs nfv от mysql храняться) и их бекапить можно &#171;наживо&#187; тем же rsync&#8217;ом)))

У Меня есть несколько нод, и конечно хотелось бы определиться с тем, что лучше использовать для архивирования?



### OpenVZ сохранение виртуальных нод на хост машину #1: rsync, tar, 7zip, bzip2 и большая нагрузка



### Логика работы скрипта

Логика скрипта состоит в том, что OpenVZ ноды Мы называем в виде цифр, а буквенное значение не присваиваем (давно было, что OpenVZ не умел в отличии от Virtuozz&#8217;ы этого делать, как сейчас дела обстоят &#8212; не знаю).
  
Дальше у Нас есть место на диске, где хранятся наши ноды &#8212;
  
В /etc/vz/vz.conf это будет /vz/private/:

<pre lang="php">VE_PRIVATE=/vz/private/$VEID</pre>

А у Меня в скрипте VZ_ROOT=&#187;/vz/private&#187;. 

VZ\_DUMP\_ROOT=&#187;/vz/private/dump&#187; &#8212; то куда Я сохраняю ноды.

**Внимание!!! Логика скрипта состоит в том, что бы синхронизировать с помощью rsync ноду из $VZ\_ROOT с $VZ\_DUMP_ROOT, и не удалять это содержимое из бекапной папки**!!!

Так можно получить наименьший downtime, но и под каждую ноду будет в 2-а раза больше места забираться!!!

**TODO:** Я еще добавил такую функцию в скрипт, что бы для не запущенных нод он просто делал rsync, не создавая бекапы, хотя надо было бы по другому сделать: **если rsync нашёл различающиеся файлы &#8212; делать бекап )))**

**TODO:** Так же чистку нод Я не делал, а надо было бы почистить: /var/log &#8212; может rsync не нужен

**backup-openvz.sh**
  
<!--more-->

<pre lang="bash" line="1">#!/bin/sh
# Размещено на http://b-comm.ru/?p=119
# Автор wel: valeranew@ukr.net
# script номер 1: сохранение нод, но не учитывается то что скрипт может 
# подвесить всю родительскую HN-ноду
# у Меня виртуальна нода из-за большого LA выключила некоторые сервисы
# советую вторую реализацию найти или выкинуть bzip / 7zip 

VZ_ROOT="/vz/private"
VZ_DUMP_ROOT="/vz/private/dump"

VZCTL="/usr/sbin/vzctl "



VZ_NotStop=() #пишем подряд контейнеры, которые будут зависить друг от друга

shopt -s extglob

if [ ! -d "$VZ_ROOT" ]; then
        mkdir -p $VZ_ROOT
fi
if [ ! -d "$VZ_DUMP_ROOT" ]; then
        mkdir -p $VZ_DUMP_ROOT
fi

cd $VZ_ROOT
echo "------------------------------------------------------------------------------------------------------"

for DIR in *
do
        if [  -d "$DIR" ]; then
                if [[ "$DIR" != +([0-9]) ]]; then
                        echo "Не сохраняю $DIR так как директория содержит буквы"
                else
                        NOT_BACKUP=0
                        for ((i=0; i&lt;${#VZ_NotStop[@]}; i++)); do
                                if [ "${VZ_NotStop[$i]}" -eq "$DIR" ]; then
                                         NOT_BACKUP=1
                                fi
                        done

                        RUN_OUT=`vzlist |awk '{print $1}'|grep -v V|grep "\&lt;$DIR\>"`
                        let " VZ_RUN = RUN_OUT + 0"
                        #Содержит значение текущей OVZ или пустую строку
                        if [ "$VZ_RUN"  -eq "$DIR" ]; then
                                VZ_IS_RUNNING=1
                        else
                                VZ_IS_RUNNING=0
                        fi

                         if [ "$NOT_BACKUP" -eq "1" ]; then
                                echo "$DIR не будет сохранено"
                         else
                                echo "Сохраняю $DIR"
                                a=`date +%s`
                                if  [ "$VZ_IS_RUNNING"  -eq "1" ]; then
                                $VZCTL stop $DIR  >/dev/null 2>&1
                                fi
                                nice -n -19 ionice -c1 rsync -acr --numeric-ids --force --delete-excluded --delete-after  --max-delete=200  $VZ_ROOT/$DIR $VZ_DUMP_ROOT  #>/dev/null 2>&1
                                if  [ "$VZ_IS_RUNNING"  -eq "1" ]; then
                                        $VZCTL start $DIR >/dev/null 2>&1
                                fi
                                b=`date +%s`
                                let "e = b -a"
                                echo "Сохранение $DIR заняло $e sec"

                             if  [ "$VZ_IS_RUNNING"  -eq "1" ]; then
                                echo "Архивирование начато"
                                a=`date +%s`
                                NAME=`date +%Y-%m-%d--%H-%M-%S`
                                TAR_NAME="$DIR.$NAME.tar"
                                TAR_NAME_FOR_7z="$DIR.$NAME.7.tar"
                                P7ZIP_DUMP="$VZ_DUMP_ROOT/$TAR_NAME_FOR_7z"
                                nice -n 19 ionice -c3 tar --ignore-failed-read -cf $VZ_DUMP_ROOT/$TAR_NAME $DIR/  >/dev/null 2>&1
                                c=`date +%s`
                                let "d = c -a"
                                echo "Время работы tar $d sec"
                                echo "Начинаю архивировать $TAR_NAME_FOR_7z.7z"
                                g=`date +%s`

                                #нужно для 7zip#
                                nice -n 19 ionice -c3 cp $VZ_DUMP_ROOT/$TAR_NAME $VZ_DUMP_ROOT/$TAR_NAME_FOR_7z

                                nice -n 19 ionice -c3 7z a -t7z -mx9   $VZ_DUMP_ROOT/$TAR_NAME_FOR_7z.7z  $P7ZIP_DUMP  >/dev/null 2>&1
                                c=`date +%s`
                                let "PKZIP = g -c"
                                echo "Время архивирования $TAR_NAME_FOR_7z.7z $PKZIP sec"
                                echo "Архивирую $TAR_NAME.bz2"
                                u=`date +%s`
                                nice -n 19 ionice -c3 bzip2 $VZ_DUMP_ROOT/$TAR_NAME > /dev/null 2>&1
                                i=`date +%s`
                                let "BZIP = i -u"
                                echo "Время архивирования $TAR_NAME $BZIP sec"
                                b=`date +%s`
                                rm $VZ_DUMP_ROOT/$TAR_NAME > /dev/null 2>&1
                                rm $P7ZIP_DUMP > /dev/null 2>&1
                                rm $VZ_DUMP_ROOT/$DIR.latest.tar.bz2  > /dev/null 2>&1
                                cp $VZ_DUMP_ROOT/$TAR_NAME.bz2 $VZ_DUMP_ROOT/$DIR.latest.tar.bz2  > /dev/null 2>&1
                                let "e = b -a"
                                #echo "Архивирование занало  $e sec  из них ==  BZIP: $BZIP sec"
                                echo "Архивирование занало  $e sec из них == PKZIP: $PKZIP sec BZIP: $BZIP sec"
                             fi

                         fi
                fi
        fi
done
#Внимательнее тут - Я перезапустил все виртуальные машины!!!
/etc/init.d/vz restart

</pre>

**log выполнения**

<pre lang="php" >-------------------------------------------------------------------------------------------------------
Сохраняю 186
Сохранение 186 заняло 3296 sec
Архивирование начато
Время работы tar 2883 sec
Начинаю архивировать 186.2011-01-19--07-42-56.7.tar.7z
Время архивирования 186.2011-01-19--07-42-56.7.tar.7z -3982 sec
Архивирую 186.2011-01-19--07-42-56.tar.bz2
Время архивирования 186.2011-01-19--07-42-56.tar 1325 sec
Архивирование занало  8190 sec из них == PKZIP: -3982 sec BZIP: 1325 sec
Сохраняю 201
Сохранение 201 заняло 535 sec
Архивирование начато
Время работы tar 325 sec
Начинаю архивировать 201.2011-01-19--10-09-00.7.tar.7z
Время архивирования 201.2011-01-19--10-09-00.7.tar.7z -5251 sec
Архивирую 201.2011-01-19--10-09-00.tar.bz2
Время архивирования 201.2011-01-19--10-09-00.tar 1868 sec
Архивирование занало  7444 sec из них == PKZIP: -5251 sec BZIP: 1868 sec
Сохраняю 203
Сохранение 203 заняло 90 sec
Архивирование начато
Время работы tar 8 sec
Начинаю архивировать 203.2011-01-19--12-16-34.7.tar.7z
Время архивирования 203.2011-01-19--12-16-34.7.tar.7z -387 sec
Архивирую 203.2011-01-19--12-16-34.tar.bz2
Время архивирования 203.2011-01-19--12-16-34.tar 92 sec
Архивирование занало  487 sec из них == PKZIP: -387 sec BZIP: 92 sec
Сохраняю 205
Сохранение 205 заняло 83 sec
Архивирование начато
Время работы tar 6 sec
Начинаю архивировать 205.2011-01-19--12-26-05.7.tar.7z
Время архивирования 205.2011-01-19--12-26-05.7.tar.7z -488 sec
Архивирую 205.2011-01-19--12-26-05.tar.bz2
Время архивирования 205.2011-01-19--12-26-05.tar 115 sec
Архивирование занало  609 sec из них == PKZIP: -488 sec BZIP: 115 sec
Сохраняю 206
Сохранение 206 заняло 64 sec
Архивирование начато
Время работы tar 8 sec
Начинаю архивировать 206.2011-01-19--12-37-19.7.tar.7z
Время архивирования 206.2011-01-19--12-37-19.7.tar.7z -452 sec
Архивирую 206.2011-01-19--12-37-19.tar.bz2
Время архивирования 206.2011-01-19--12-37-19.tar 112 sec
Архивирование занало  572 sec из них == PKZIP: -452 sec BZIP: 112 sec
Сохраняю 207
Сохранение 207 заняло 106 sec
Архивирование начато
Время работы tar 27 sec
Начинаю архивировать 207.2011-01-19--12-48-39.7.tar.7z
Время архивирования 207.2011-01-19--12-48-39.7.tar.7z -880 sec
Архивирую 207.2011-01-19--12-48-39.tar.bz2
Время архивирования 207.2011-01-19--12-48-39.tar 252 sec
Архивирование занало  1159 sec из них == PKZIP: -880 sec BZIP: 252 sec
Сохраняю 209
Сохранение 209 заняло 350 sec
Архивирование начато
Время работы tar 195 sec
Начинаю архивировать 209.2011-01-19--13-13-51.7.tar.7z
Время архивирования 209.2011-01-19--13-13-51.7.tar.7z -2040 sec
Архивирую 209.2011-01-19--13-13-51.tar.bz2
Время архивирования 209.2011-01-19--13-13-51.tar 747 sec
Архивирование занало  2982 sec из них == PKZIP: -2040 sec BZIP: 747 sec
Сохраняю 223
Сохранение 223 заняло 192 sec
Архивирование начато
Время работы tar 38 sec
Начинаю архивировать 223.2011-01-19--14-06-57.7.tar.7z
Время архивирования 223.2011-01-19--14-06-57.7.tar.7z -1351 sec
Архивирую 223.2011-01-19--14-06-57.tar.bz2
Время архивирования 223.2011-01-19--14-06-57.tar 302 sec
Архивирование занало  1691 sec из них == PKZIP: -1351 sec BZIP: 302 sec
Не сохраняю backup так как директория содержит буквы
Не сохраняю dump так как директория содержит буквы
Shutting down VE 223
Shutting down VE 209
Shutting down VE 207
Shutting down VE 206
Shutting down VE 205
Shutting down VE 203
Shutting down VE 201
Shutting down VE 186
Bringing down interface venet0: ..done
Stopping OpenVZ: ..done
Starting OpenVZ: ..done
Bringing up interface venet0: ..done
Configuring interface venet0: ..done
Starting VE 186: ..done
Starting VE 201: ..done
Starting VE 203: ..done
Starting VE 205: ..done
Starting VE 206: ..done
Starting VE 207: ..done
Starting VE 209: ..done
Starting VE 223: ..done
</pre>

<pre lang="bash" line="1">vzlist  -a|awk '{print$1,$5}'
VEID HOSTNAME
186 mail-server
201 web-server1
203 ns1
205 ns2
206 xbt-tracker
207 verlihub-server
209 web-server2
223 database-server
</pre>

<pre lang="bash" line="1">/vz/private# ls -la dump/|grep -v latest
итого 14521388
drwxr-xr-x 10 root root       4096 Янв 19 14:35 .
drwx------ 12 root root       4096 Янв 19 15:33 ..
drwxrwxrwx 21 root root       4096 Янв 19 06:43 186
-rw-r--r--  1 root root  733662921 Янв 19 09:37 186.2011-01-19--07-42-56.7.tar.7z
-rw-r--r--  1 root root 1173570629 Янв 19 08:30 186.2011-01-19--07-42-56.tar.bz2
drwxr-xr-x 21 root root       4096 Янв 19 06:35 201
-rw-r--r--  1 root root 2743271248 Янв 19 11:41 201.2011-01-19--10-09-00.7.tar.7z
-rw-r--r--  1 root root 2863944236 Янв 19 10:14 201.2011-01-19--10-09-00.tar.bz2
drwxr-xr-x 21 root root       4096 Янв 19 06:35 203
-rw-r--r--  1 root root   55583004 Янв 19 12:23 203.2011-01-19--12-16-34.7.tar.7z
-rw-r--r--  1 root root   86636067 Янв 19 12:16 203.2011-01-19--12-16-34.tar.bz2
drwxr-xr-x 21 root root       4096 Янв 19 06:36 205
-rw-r--r--  1 root root   61589401 Янв 19 12:34 205.2011-01-19--12-26-05.7.tar.7z
-rw-r--r--  1 root root   96632242 Янв 19 12:26 205.2011-01-19--12-26-05.tar.bz2
drwxr-xr-x 20 root root       4096 Янв 19 06:35 206
-rw-r--r--  1 root root   53580264 Янв 19 12:44 206.2011-01-19--12-37-19.7.tar.7z
-rw-r--r--  1 root root   90946031 Янв 19 12:37 206.2011-01-19--12-37-19.tar.bz2
drwxr-xr-x 20 root root       4096 Янв 19 06:36 207
-rw-r--r--  1 root root  112456884 Янв 19 13:03 207.2011-01-19--12-48-39.7.tar.7z
-rw-r--r--  1 root root  205655557 Янв 19 12:49 207.2011-01-19--12-48-39.tar.bz2
drwxr-xr-x 20 root root       4096 Янв 19 06:36 209
-rw-r--r--  1 root root  443173145 Янв 19 13:51 209.2011-01-19--13-13-51.7.tar.7z
-rw-r--r--  1 root root  604901452 Янв 19 13:17 209.2011-01-19--13-13-51.tar.bz2
drwxr-xr-x 21 root root       4096 Янв 19 06:36 223
-rw-r--r--  1 root root   91173753 Янв 19 14:30 223.2011-01-19--14-06-57.7.tar.7z
-rw-r--r--  1 root root  158046225 Янв 19 14:07 223.2011-01-19--14-06-57.tar.bz2
</pre>

На время выполнения скрипта:

<pre lang="bash">Tasks: 128 total,   3 running, 125 sleeping,   0 stopped,   0 zombie
Cpu(s):  0.7%us,  0.3%sy, 98.7%ni,  0.0%id,  0.0%wa,  0.0%hi,  0.3%si,  0.0%st
Mem:   3105112k total,  2936252k used,   168860k free,    36568k buffers
Swap:  4096532k total,     1160k used,  4095372k free,  1913184k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
29584 root      39  19  678m 674m 1724 R 98.4 22.3  17:04.09 7z
14365 Debian-e  20   0 27708 4816 1620 S  0.7  0.2   0:04.44 pdns_recursor
31387 root      20   0  2388 1144  872 R  0.7  0.0   0:00.04 top
    1 root      20   0  2100  696  592 S  0.0  0.0   0:03.84 init
    2 root      15  -5     0    0    0 S  0.0  0.0   0:00.00 kthreadd
</pre>

### Вывод:

Во первых надо определить &#8212; надо ли полностью архивировать ноду если изменений не было?
  
Во вторых надо определиться с тем, что использовать для архивирования &#8212; bzip2 или 7zip или в tar?