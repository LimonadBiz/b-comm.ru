---
title: Мои скрипты мониторинга свичей по snmp
author: wel
type: post
date: 2011-02-19T21:01:34+00:00
url: /billing/мои-скрипты-мониторинга-свичей-по-snmp
short-url:
  - http://bit.ly/eDptKP
wp-syntax-cache-content:
  - |
    a:14:{i:1;s:1856:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #339933;">*/</span><span style="color: #cc66cc;">30</span> <span style="color: #339933;">*</span>  <span style="color: #339933;">*</span> <span style="color: #339933;">*</span> <span style="color: #339933;">*</span>   root   rm <span style="color: #339933;">/</span><span style="color: #000000; font-weight: bold;">var</span><span style="color: #339933;">/</span>www<span style="color: #339933;">/</span>skmsw<span style="color: #339933;">/</span>pid<span style="color: #666666; font-style: italic;">/*
    */</span><span style="color: #cc66cc;">5</span> <span style="color: #339933;">*</span>  <span style="color: #339933;">*</span> <span style="color: #339933;">*</span> <span style="color: #339933;">*</span>   root    <span style="color: #339933;">/</span>usr<span style="color: #339933;">/</span>bin<span style="color: #339933;">/</span>php <span style="color: #339933;">-</span>q <span style="color: #339933;">/</span><span style="color: #000000; font-weight: bold;">var</span><span style="color: #339933;">/</span>www<span style="color: #339933;">/</span>skmsw<span style="color: #339933;">/</span>cron<span style="color: #339933;">.</span>php  <span style="color: #339933;">&gt;/</span>dev<span style="color: #339933;">/</span><span style="color: #009900; font-weight: bold;">null</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">&amp;</span></pre></td></tr></table><p class="theCode" style="display:none;">*/30 *  * * *   root   rm /var/www/skmsw/pid/*
    */5 *  * * *   root    /usr/bin/php -q /var/www/skmsw/cron.php  &gt;/dev/null 2&gt;1&amp;</p></div>
    ";i:2;s:27464:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    </pre></td><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">-- phpMyAdmin SQL Dump</span>
    <span style="color: #808080; font-style: italic;">-- version 3.3.9.2</span>
    &nbsp;
    <span style="color: #808080; font-style: italic;">-- Время создания: Фев 21 2011 г., 00:24</span>
    <span style="color: #808080; font-style: italic;">-- Версия сервера: 5.5.9</span>
    <span style="color: #808080; font-style: italic;">-- Версия PHP: 5.3.5</span>
    &nbsp;
    <span style="color: #993333; font-weight: bold;">SET</span> SQL_MODE<span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;NO_AUTO_VALUE_ON_ZERO&quot;</span>;
    &nbsp;
    <span style="color: #808080; font-style: italic;">--</span>
    <span style="color: #808080; font-style: italic;">-- База данных: `skmsw`</span>
    <span style="color: #808080; font-style: italic;">--</span>
    &nbsp;
    <span style="color: #808080; font-style: italic;">-- --------------------------------------------------------</span>
    &nbsp;
    <span style="color: #808080; font-style: italic;">--</span>
    <span style="color: #808080; font-style: italic;">-- Структура таблицы `freenibs`</span>
    <span style="color: #808080; font-style: italic;">--</span>
    &nbsp;
    <span style="color: #993333; font-weight: bold;">DROP</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`freenibs`</span>;
    <span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`freenibs`</span> <span style="color: #66cc66;">&#40;</span>
      <span style="color: #ff0000;">`id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`mac`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`user`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`uid`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`deposit`</span> <span style="color: #993333; font-weight: bold;">DOUBLE</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">16</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">3</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`en`</span> tinyint<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'0'</span><span style="color: #66cc66;">,</span>
      <span style="color: #993333; font-weight: bold;">PRIMARY</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span>
      <span style="color: #993333; font-weight: bold;">UNIQUE</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #ff0000;">`mac`</span> <span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">`mac`</span><span style="color: #66cc66;">&#41;</span>
    <span style="color: #66cc66;">&#41;</span> ENGINE<span style="color: #66cc66;">=</span>MyISAM  <span style="color: #993333; font-weight: bold;">DEFAULT</span> CHARSET<span style="color: #66cc66;">=</span>utf8 <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">10869793</span> ;
    &nbsp;
    <span style="color: #808080; font-style: italic;">-- --------------------------------------------------------</span>
    &nbsp;
    <span style="color: #808080; font-style: italic;">--</span>
    <span style="color: #808080; font-style: italic;">-- Структура таблицы `mac`</span>
    <span style="color: #808080; font-style: italic;">--</span>
    &nbsp;
    <span style="color: #993333; font-weight: bold;">DROP</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`mac`</span>;
    <span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`mac`</span> <span style="color: #66cc66;">&#40;</span>
      <span style="color: #ff0000;">`id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`port`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`mac`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`sw_id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`date`</span> <span style="color: #993333; font-weight: bold;">TIMESTAMP</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">CURRENT_TIMESTAMP</span><span style="color: #66cc66;">,</span>
      <span style="color: #993333; font-weight: bold;">PRIMARY</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span>
      <span style="color: #993333; font-weight: bold;">UNIQUE</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #ff0000;">`port`</span> <span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">`port`</span><span style="color: #66cc66;">,</span><span style="color: #ff0000;">`mac`</span><span style="color: #66cc66;">,</span><span style="color: #ff0000;">`sw_id`</span><span style="color: #66cc66;">&#41;</span>
    <span style="color: #66cc66;">&#41;</span> ENGINE<span style="color: #66cc66;">=</span>MyISAM  <span style="color: #993333; font-weight: bold;">DEFAULT</span> CHARSET<span style="color: #66cc66;">=</span>utf8 <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">5293</span> ;
    &nbsp;
    <span style="color: #808080; font-style: italic;">-- --------------------------------------------------------</span>
    &nbsp;
    <span style="color: #808080; font-style: italic;">--</span>
    <span style="color: #808080; font-style: italic;">-- Структура таблицы `packets`</span>
    <span style="color: #808080; font-style: italic;">--</span>
    &nbsp;
    <span style="color: #993333; font-weight: bold;">DROP</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`packets`</span>;
    <span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`packets`</span> <span style="color: #66cc66;">&#40;</span>
      <span style="color: #ff0000;">`gid`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`name`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`credit`</span> <span style="color: #993333; font-weight: bold;">FLOAT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">16</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">4</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`activated`</span> <span style="color: #993333; font-weight: bold;">SMALLINT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'1'</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`month_traffic_limit`</span> <span style="color: #993333; font-weight: bold;">FLOAT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">25</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`framed_ip`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`     framed_mask`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">40</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span>
    <span style="color: #66cc66;">&#41;</span> ENGINE<span style="color: #66cc66;">=</span>MyISAM <span style="color: #993333; font-weight: bold;">DEFAULT</span> CHARSET<span style="color: #66cc66;">=</span>utf8;
    &nbsp;
    <span style="color: #808080; font-style: italic;">-- --------------------------------------------------------</span>
    &nbsp;
    <span style="color: #808080; font-style: italic;">--</span>
    <span style="color: #808080; font-style: italic;">-- Структура таблицы `stat`</span>
    <span style="color: #808080; font-style: italic;">--</span>
    &nbsp;
    <span style="color: #993333; font-weight: bold;">DROP</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`stat`</span>;
    <span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`stat`</span> <span style="color: #66cc66;">&#40;</span>
      <span style="color: #ff0000;">`mac_n`</span> <span style="color: #993333; font-weight: bold;">BIGINT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`login_n`</span> <span style="color: #993333; font-weight: bold;">BIGINT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`sw_n`</span> <span style="color: #993333; font-weight: bold;">BIGINT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`all_traf`</span> <span style="color: #993333; font-weight: bold;">FLOAT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">30</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">3</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span>
    <span style="color: #66cc66;">&#41;</span> ENGINE<span style="color: #66cc66;">=</span>MyISAM <span style="color: #993333; font-weight: bold;">DEFAULT</span> CHARSET<span style="color: #66cc66;">=</span>utf8;
    &nbsp;
    <span style="color: #808080; font-style: italic;">-- --------------------------------------------------------</span>
    &nbsp;
    <span style="color: #808080; font-style: italic;">--</span>
    <span style="color: #808080; font-style: italic;">-- Структура таблицы `sw`</span>
    <span style="color: #808080; font-style: italic;">--</span>
    &nbsp;
    <span style="color: #993333; font-weight: bold;">DROP</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`sw`</span>;
    <span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`sw`</span> <span style="color: #66cc66;">&#40;</span>
      <span style="color: #ff0000;">`id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`name`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'sw'</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`type_res`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">25</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'switch'</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`ip`</span> <span style="color: #993333; font-weight: bold;">BIGINT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`parent_sw_id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`snmppass`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'public'</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`snmpversion`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">5</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'1'</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`snmpuser`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`type`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`model`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`ports`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`addr`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #ff0000;">`disallow_ports`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
      <span style="color: #993333; font-weight: bold;">PRIMARY</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">&#41;</span>
    <span style="color: #66cc66;">&#41;</span> ENGINE<span style="color: #66cc66;">=</span>MyISAM  <span style="color: #993333; font-weight: bold;">DEFAULT</span> CHARSET<span style="color: #66cc66;">=</span>utf8 <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">256</span> ;</pre></td></tr></table><p class="theCode" style="display:none;">-- phpMyAdmin SQL Dump
    -- version 3.3.9.2
    
    -- Время создания: Фев 21 2011 г., 00:24
    -- Версия сервера: 5.5.9
    -- Версия PHP: 5.3.5
    
    SET SQL_MODE=&quot;NO_AUTO_VALUE_ON_ZERO&quot;;
    
    --
    -- База данных: `skmsw`
    --
    
    -- --------------------------------------------------------
    
    --
    -- Структура таблицы `freenibs`
    --
    
    DROP TABLE IF EXISTS `freenibs`;
    CREATE TABLE IF NOT EXISTS `freenibs` (
      `id` int(11) NOT NULL AUTO_INCREMENT,
      `mac` varchar(100) NOT NULL,
      `user` varchar(255) NOT NULL,
      `uid` int(11) NOT NULL,
      `deposit` double(16,3) NOT NULL,
      `en` tinyint(4) NOT NULL DEFAULT '0',
      PRIMARY KEY (`id`),
      UNIQUE KEY `mac` (`mac`)
    ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=10869793 ;
    
    -- --------------------------------------------------------
    
    --
    -- Структура таблицы `mac`
    --
    
    DROP TABLE IF EXISTS `mac`;
    CREATE TABLE IF NOT EXISTS `mac` (
      `id` int(11) NOT NULL AUTO_INCREMENT,
      `port` int(11) NOT NULL,
      `mac` varchar(255) NOT NULL,
      `sw_id` int(11) NOT NULL,
      `date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
      PRIMARY KEY (`id`),
      UNIQUE KEY `port` (`port`,`mac`,`sw_id`)
    ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=5293 ;
    
    -- --------------------------------------------------------
    
    --
    -- Структура таблицы `packets`
    --
    
    DROP TABLE IF EXISTS `packets`;
    CREATE TABLE IF NOT EXISTS `packets` (
      `gid` int(11) NOT NULL,
      `name` varchar(255) NOT NULL,
      `credit` float(16,4) NOT NULL,
      `activated` smallint(6) NOT NULL DEFAULT '1',
      `month_traffic_limit` float(25,6) NOT NULL,
      `framed_ip` varchar(255) NOT NULL,
      `     framed_mask` varchar(40) NOT NULL
    ) ENGINE=MyISAM DEFAULT CHARSET=utf8;
    
    -- --------------------------------------------------------
    
    --
    -- Структура таблицы `stat`
    --
    
    DROP TABLE IF EXISTS `stat`;
    CREATE TABLE IF NOT EXISTS `stat` (
      `mac_n` bigint(255) NOT NULL,
      `login_n` bigint(255) NOT NULL,
      `sw_n` bigint(255) NOT NULL,
      `all_traf` float(30,3) NOT NULL
    ) ENGINE=MyISAM DEFAULT CHARSET=utf8;
    
    -- --------------------------------------------------------
    
    --
    -- Структура таблицы `sw`
    --
    
    DROP TABLE IF EXISTS `sw`;
    CREATE TABLE IF NOT EXISTS `sw` (
      `id` int(11) NOT NULL AUTO_INCREMENT,
      `name` varchar(255) NOT NULL DEFAULT 'sw',
      `type_res` varchar(25) NOT NULL DEFAULT 'switch',
      `ip` bigint(255) NOT NULL,
      `parent_sw_id` int(11) NOT NULL,
      `snmppass` varchar(100) NOT NULL DEFAULT 'public',
      `snmpversion` varchar(5) NOT NULL DEFAULT '1',
      `snmpuser` varchar(100) NOT NULL,
      `type` varchar(100) NOT NULL,
      `model` varchar(255) NOT NULL,
      `ports` int(11) NOT NULL,
      `addr` varchar(255) NOT NULL,
      `disallow_ports` varchar(255) NOT NULL,
      PRIMARY KEY (`id`)
    ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=256 ;</p></div>
    ";i:3;s:3543:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    </pre></td><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #993333; font-weight: bold;">INTO</span> <span style="color: #ff0000;">`freenibs`</span> <span style="color: #993333; font-weight: bold;">VALUES</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">373</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'00:e0:4c:75:00:48'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'olya18'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">415</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">7.690</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #993333; font-weight: bold;">INTO</span> <span style="color: #ff0000;">`freenibs`</span> <span style="color: #993333; font-weight: bold;">VALUES</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">7855579</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'40:61:86:2c:89:d8'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'192.168.1.100'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">,</span> <span style="color: #66cc66;">-</span><span style="color: #cc66cc;">2048.000</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">&#41;</span>;
    <span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #993333; font-weight: bold;">INTO</span> <span style="color: #ff0000;">`sw`</span> <span style="color: #993333; font-weight: bold;">VALUES</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'sw'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'switch'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">2886730242</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'public'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'1'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">''</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'dlink'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">' D-Link DES-3028 Fast Ethernet Switch'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">24</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">''</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'25,26,27,28'</span><span style="color: #66cc66;">&#41;</span>;</pre></td></tr></table><p class="theCode" style="display:none;">INSERT INTO `freenibs` VALUES(373, '00:e0:4c:75:00:48', 'olya18', 415, 7.690, 0);
    INSERT INTO `freenibs` VALUES(7855579, '40:61:86:2c:89:d8', '192.168.1.100', 0, -2048.000, 0);
    INSERT INTO `sw` VALUES(1, 'sw', 'switch', 2886730242, 0, 'public', '1', '', 'dlink', ' D-Link DES-3028 Fast Ethernet Switch', 24, '', '25,26,27,28');</p></div>
    ";i:4;s:7163:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
     <span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;engine.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #000088;">$db</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> db_mysql<span style="color: #009900;">&#40;</span>HOST<span style="color: #339933;">,</span>USER<span style="color: #339933;">,</span>DB_PASS<span style="color: #339933;">,</span>DB<span style="color: #339933;">,</span>DEBUG_DB<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'$db obj is ok'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;br&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
     <span style="color: #666666; font-style: italic;">//$db-&gt;SET_NAMES(&quot;cp1251&quot;);</span>
     <span style="color: #666666; font-style: italic;">//$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);</span>
     <span style="color: #000088;">$db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SET_COLLATE</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;cp1251_general_ci&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
     <span style="color: #000088;">$db_nibs</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> db_mysql<span style="color: #009900;">&#40;</span>HOST_NIBS<span style="color: #339933;">,</span>USER_NIBS<span style="color: #339933;">,</span>DB_NIBS_PASS<span style="color: #339933;">,</span>DB_NIBS<span style="color: #339933;">,</span>DEBUG_DB<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'$db_nibs obj is ok'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;br&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
     <span style="color: #666666; font-style: italic;">//$db_nibs-&gt;SET_NAMES(&quot;cp1251&quot;);</span>
     <span style="color: #666666; font-style: italic;">//$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);</span>
     <span style="color: #000088;">$db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SET_COLLATE</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;cp1251_general_ci&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
     <span style="color: #000088;">$page</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> page<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$db</span><span style="color: #339933;">,&amp;</span><span style="color: #000088;">$db_nibs</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'$page obj is ok'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;br&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
     <span style="color: #b1b100;">switch</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'page'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
     	<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;sw&quot;</span><span style="color: #339933;">:</span>
     		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
     	<span style="color: #b1b100;">default</span><span style="color: #339933;">:</span>
     		<span style="color: #000088;">$page</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">top</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     		<span style="color: #000088;">$page</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">show_all_sw</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     		<span style="color: #000088;">$page</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">bottom</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
     <span style="color: #009900;">&#125;</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php
     include_once(&quot;engine.php&quot;);
     $db=new db_mysql(HOST,USER,DB_PASS,DB,DEBUG_DB);
     if(DEBUG_DB==&quot;true&quot;) echo '$db obj is ok'.&quot;&lt;br&gt;\n&quot;;
     //$db-&gt;SET_NAMES(&quot;cp1251&quot;);
     //$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);
     $db-&gt;SET_COLLATE(&quot;cp1251_general_ci&quot;);
     
     $db_nibs=new db_mysql(HOST_NIBS,USER_NIBS,DB_NIBS_PASS,DB_NIBS,DEBUG_DB);
      if(DEBUG_DB==&quot;true&quot;) echo '$db_nibs obj is ok'.&quot;&lt;br&gt;\n&quot;;
     //$db_nibs-&gt;SET_NAMES(&quot;cp1251&quot;);
     //$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);
     $db_nibs-&gt;SET_COLLATE(&quot;cp1251_general_ci&quot;);
     
     $page=new page(&amp;$db,&amp;$db_nibs);
     if(DEBUG_DB==&quot;true&quot;) echo '$page obj is ok'.&quot;&lt;br&gt;\n&quot;;
     switch($_GET['page']){
     	case &quot;sw&quot;:
     		break;
     	default:
     		$page-&gt;top();
     		$page-&gt;show_all_sw();
     		$page-&gt;bottom();
     		break;
     }
     
    ?&gt;</p></div>
    ";i:5;s:28012:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    103
    104
    105
    106
    107
    108
    109
    110
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
    <span style="color: #339933;">@</span><span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;define.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PHPTelnet.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;telnet.class.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;db.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;page.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #339933;">@</span><span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;db.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #339933;">@</span><span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;page.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    <span style="color: #009900;">&#125;</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">function</span> quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">// если magic_quotes_gpc включена - используем stripslashes</span>
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">get_magic_quotes_gpc</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000088;">$value</span> <span style="color: #339933;">=</span> <span style="color: #990000;">stripslashes</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #666666; font-style: italic;">// Если переменная - число, то экранировать её не нужно</span>
        <span style="color: #666666; font-style: italic;">// если нет - то окружем её кавычками, и экранируем</span>
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #990000;">is_numeric</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000088;">$value</span> <span style="color: #339933;">=</span> <span style="color: #990000;">mysql_real_escape_string</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$value</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
    <span style="color: #000000; font-weight: bold;">function</span> crypt_password<span style="color: #009900;">&#40;</span><span style="color: #000088;">$clear</span><span style="color: #339933;">,</span><span style="color: #000088;">$cryptscheme</span><span style="color: #339933;">,</span> <span style="color: #000088;">$salt</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span>
        <span style="color: #009900;">&#123;</span>
    &nbsp;
    &nbsp;
            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$cryptscheme</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'sha'</span><span style="color: #009900;">&#41;</span>
            <span style="color: #009900;">&#123;</span>
                <span style="color: #000088;">$hash</span> <span style="color: #339933;">=</span> <span style="color: #990000;">sha1</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$clear</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #000088;">$cryptedpass</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'{SHA}'</span> <span style="color: #339933;">.</span> <span style="color: #990000;">base64_encode</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">pack</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'H*'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$hash</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
            <span style="color: #b1b100;">else</span>
            <span style="color: #009900;">&#123;</span>
                <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$salt</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span>
                <span style="color: #009900;">&#123;</span>
                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$cryptscheme</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'des'</span><span style="color: #009900;">&#41;</span>
                    <span style="color: #009900;">&#123;</span>
                        <span style="color: #000088;">$salt</span> <span style="color: #339933;">=</span> <span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$salt</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #009900;">&#125;</span>
                    <span style="color: #b1b100;">else</span>
                    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$cryptscheme</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">'md5'</span><span style="color: #009900;">&#41;</span>
                    <span style="color: #009900;">&#123;</span>
                        <span style="color: #000088;">$salt</span> <span style="color: #339933;">=</span> <span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$salt</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #009900;">&#125;</span>
                    <span style="color: #b1b100;">else</span>
                    <span style="color: #009900;">&#123;</span>
                        <span style="color: #000088;">$salt</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
                    <span style="color: #009900;">&#125;</span>
                <span style="color: #009900;">&#125;</span>
                <span style="color: #000088;">$cryptedpass</span> <span style="color: #339933;">=</span> <span style="color: #990000;">crypt</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$clear</span><span style="color: #339933;">,</span> <span style="color: #000088;">$salt</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
    &nbsp;
            <span style="color: #b1b100;">return</span> <span style="color: #000088;">$cryptedpass</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">function</span> dec_hex<span style="color: #009900;">&#40;</span><span style="color: #000088;">$int</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	    <span style="color: #000088;">$res</span><span style="color: #339933;">=</span><span style="color: #990000;">dechex</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$int</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$res</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #000088;">$res</span><span style="color: #339933;">=</span><span style="color: #0000ff;">'0'</span><span style="color: #339933;">.</span><span style="color: #000088;">$res</span><span style="color: #339933;">;</span>
    	    <span style="color: #000088;">$res</span><span style="color: #339933;">=</span><span style="color: #990000;">strtoupper</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$res</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	    <span style="color: #b1b100;">return</span> <span style="color: #000088;">$res</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">function</span> snmptable<span style="color: #009900;">&#40;</span><span style="color: #000088;">$host</span><span style="color: #339933;">,</span> <span style="color: #000088;">$community</span><span style="color: #339933;">,</span> <span style="color: #000088;">$oid</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">// TODO: get original state and restore at bottom</span>
        snmp_set_oid_numeric_print<span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">snmp_set_quick_print</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        snmp_set_enum_print<span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
        <span style="color: #000088;">$retval</span> <span style="color: #339933;">=</span> <span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000088;">$raw</span> <span style="color: #339933;">=</span> <span style="color: #990000;">snmprealwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$host</span><span style="color: #339933;">,</span> <span style="color: #000088;">$community</span><span style="color: #339933;">,</span> <span style="color: #000088;">$oid</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$raw</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// no data</span>
    &nbsp;
        <span style="color: #000088;">$prefix_length</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
        <span style="color: #000088;">$largest</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
        <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$raw</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$value</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$prefix_length</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                <span style="color: #666666; font-style: italic;">// don't just use $oid's length since it may be non-numeric</span>
                <span style="color: #000088;">$prefix_elements</span> <span style="color: #339933;">=</span> <span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'.'</span><span style="color: #339933;">,</span><span style="color: #000088;">$oid</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #000088;">$tmp</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'.'</span> <span style="color: #339933;">.</span> <span style="color: #990000;">strtok</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$prefix_elements</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                    <span style="color: #000088;">$tmp</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'.'</span> <span style="color: #339933;">.</span> <span style="color: #990000;">strtok</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000088;">$prefix_elements</span><span style="color: #339933;">--;</span>
                <span style="color: #009900;">&#125;</span>
                <span style="color: #000088;">$tmp</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">'.'</span><span style="color: #339933;">;</span>
                <span style="color: #000088;">$prefix_length</span> <span style="color: #339933;">=</span> <span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$tmp</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
            <span style="color: #000088;">$key</span> <span style="color: #339933;">=</span> <span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$prefix_length</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #000088;">$index</span> <span style="color: #339933;">=</span> <span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'.'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$index</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> or <span style="color: #000088;">$retval</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$index</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$largest</span> <span style="color: #339933;">&lt;</span> <span style="color: #000088;">$index</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #000088;">$largest</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$index</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
            <span style="color: #000088;">$retval</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$index</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$index</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$value</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
    &nbsp;
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// no data</span>
    &nbsp;
        <span style="color: #666666; font-style: italic;">// fill in holes and blanks the agent may &quot;give&quot; you</span>
        <span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$k</span> <span style="color: #339933;">=&gt;</span> <span style="color: #000088;">$x</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span> <span style="color: #339933;">&lt;=</span> <span style="color: #000088;">$largest</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                    <span style="color: #000088;">$retval</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
                <span style="color: #009900;">&#125;</span>
            <span style="color: #009900;">&#125;</span>
            <span style="color: #990000;">ksort</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$k</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #b1b100;">return</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$retval</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php
    @include_once(&quot;define.php&quot;);
    include_once(&quot;PHPTelnet.php&quot;);
    include_once(&quot;telnet.class.php&quot;);
    if(DEBUG_DB==true){
    	include_once(&quot;db.php&quot;);
    	include_once(&quot;page.php&quot;);	
    }
    else{
    	@include_once(&quot;db.php&quot;);
    	@include_once(&quot;page.php&quot;);	
    }
    
    function quote_smart($value)
    {
        // если magic_quotes_gpc включена - используем stripslashes
        if (get_magic_quotes_gpc()) {
            $value = stripslashes($value);
        }
        // Если переменная - число, то экранировать её не нужно
        // если нет - то окружем её кавычками, и экранируем
        if (!is_numeric($value)) {
            $value = mysql_real_escape_string($value);
        }
        return $value;
    }
    function crypt_password($clear,$cryptscheme, $salt = '')
        {
            
    
            if ($cryptscheme == 'sha')
            {
                $hash = sha1($clear);
                $cryptedpass = '{SHA}' . base64_encode(pack('H*', $hash));
            }
            else
            {
                if ($salt != '')
                {
                    if ($cryptscheme == 'des')
                    {
                        $salt = substr($salt, 0, 2);
                    }
                    else
                    if ($cryptscheme == 'md5')
                    {
                        $salt = substr($salt, 0, 12);
                    }
                    else
                    {
                        $salt = '';
                    }
                }
                $cryptedpass = crypt($clear, $salt);
            }
    
            return $cryptedpass;
        }
    	function dec_hex($int){
    	    $res=dechex($int);
    	    if (strlen($res)==1) $res='0'.$res;
    	    $res=strtoupper($res);
    	    return $res;
    	}
        function snmptable($host, $community, $oid) {
        // TODO: get original state and restore at bottom
        snmp_set_oid_numeric_print(TRUE);
        snmp_set_quick_print(TRUE);
        snmp_set_enum_print(TRUE);
    
        $retval = array();
        $raw = snmprealwalk($host, $community, $oid);
        if (count($raw) == 0) return ($retval); // no data
       
        $prefix_length = 0;
        $largest = 0;
        foreach ($raw as $key =&gt; $value) {
            if ($prefix_length == 0) {
                // don't just use $oid's length since it may be non-numeric
                $prefix_elements = count(explode('.',$oid));
                $tmp = '.' . strtok($key, '.');
                while ($prefix_elements &gt; 1) {
                    $tmp .= '.' . strtok('.');
                    $prefix_elements--;
                }
                $tmp .= '.';
                $prefix_length = strlen($tmp);
            }
            $key = substr($key, $prefix_length);
            $index = explode('.', $key, 2);
            isset($retval[$index[1]]) or $retval[$index[1]] = array();
            if ($largest &lt; $index[0]) $largest = $index[0];
            $retval[$index[1]][$index[0]] = $value;
        }
    
        if (count($retval) == 0) return ($retval); // no data
    
        // fill in holes and blanks the agent may &quot;give&quot; you
        foreach($retval as $k =&gt; $x) {
            for ($i = 1; $i &lt;= $largest; $i++) {
            if (! isset($retval[$k][$i])) {
                    $retval[$k][$i] = '';
                }
            }
            ksort($retval[$k]);
        }
        return($retval);
    }
    
    ?&gt;</p></div>
    ";i:6;s:12976:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
    	<span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;DEBUG_DB&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;false&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ADMIN_MAIL&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;valeranew@ukr.net&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;DB&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;skmsw&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;USER&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;skmsw&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;HOST&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;localhost&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;DB_PASS&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;password&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;DB_NIBS&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;freenibs&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;USER_NIBS&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;freenibs&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;HOST_NIBS&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;localhost&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;DB_NIBS_PASS&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;password&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;COMUNITY_READ&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;public&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;COMUNITY_READ2&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;public_snmp&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;COMUNITY_DEF_DLINK_READ&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;public&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #666666; font-style: italic;">/* OID  нормально работает, но приколы вывода:
         * smc: SMC Networks SMC8624T 1
         * dlink : D-Link DES-3026 Fast Ethernet Switch  (D-Link DES-3016 Fast Ethernet Switch)
         * dell :  Ethernet Stackable Switching System  
              PowerConnect 3348 
              			юзать=&gt;&quot;OID_DELL_sysDescr&quot; 
         * extreem : Summit200-48 - Version 7.3e.2 (Build 4) by Release_Master 02/24/05 19:20:09 
         * */</span>
       <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_sysDescr&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.1.1&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
       <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_DELL_sysDescr&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.1.5.0&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
       <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_DELL_enterprises&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.4.1.674&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    &nbsp;
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_standart_ports&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.2.1.0&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_dell_ports&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.2.2.1.7&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">/* Включают и вланы IF-MIB::ifAdminStatus.46 = INTEGER: up(1) */</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_dell_ports_descr&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.2.2.1.2&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  	
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_dell_ports_speed&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.2.2.1.5&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    &nbsp;
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_mac_on_ports&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.17.7.1.2.2.1.2&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_cisco_mac_on_ports&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.17.4.3.1.1&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;OID_ports_updown&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;.1.3.6.1.2.1.2.2.1.8&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    &nbsp;
    &nbsp;
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PAGE_MES_1&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Данные не доступны&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PAGE_MES_2&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Данные o свиче&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PAGE_MES_3&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Тип&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PAGE_MES_4&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Версия&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #990000;">define</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PAGE_MES_5&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Количество портов&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php
    	define(&quot;DEBUG_DB&quot;,&quot;false&quot;);
    	
        define(&quot;ADMIN_MAIL&quot;,&quot;valeranew@ukr.net&quot;);
        define(&quot;DB&quot;,&quot;skmsw&quot;);
        define(&quot;USER&quot;,&quot;skmsw&quot;);
        define(&quot;HOST&quot;,&quot;localhost&quot;);
        define(&quot;DB_PASS&quot;,&quot;password&quot;);
        
        define(&quot;DB_NIBS&quot;,&quot;freenibs&quot;);
        define(&quot;USER_NIBS&quot;,&quot;freenibs&quot;);
        define(&quot;HOST_NIBS&quot;,&quot;localhost&quot;);
        define(&quot;DB_NIBS_PASS&quot;,&quot;password&quot;);
      
        define(&quot;COMUNITY_READ&quot;,&quot;public&quot;);
        define(&quot;COMUNITY_READ2&quot;,&quot;public_snmp&quot;);
        define(&quot;COMUNITY_DEF_DLINK_READ&quot;,&quot;public&quot;);
        /* OID  нормально работает, но приколы вывода:
         * smc: SMC Networks SMC8624T 1
         * dlink : D-Link DES-3026 Fast Ethernet Switch  (D-Link DES-3016 Fast Ethernet Switch)
         * dell :  Ethernet Stackable Switching System  
              PowerConnect 3348 
              			юзать=&gt;&quot;OID_DELL_sysDescr&quot; 
         * extreem : Summit200-48 - Version 7.3e.2 (Build 4) by Release_Master 02/24/05 19:20:09 
         * */
       define(&quot;OID_sysDescr&quot;,&quot;.1.3.6.1.2.1.1.1&quot;); 
       define(&quot;OID_DELL_sysDescr&quot;,&quot;.1.3.6.1.2.1.1.5.0&quot;);
       define(&quot;OID_DELL_enterprises&quot;,&quot;.1.3.6.1.4.1.674&quot;);
    
      	
      define(&quot;OID_standart_ports&quot;,&quot;.1.3.6.1.2.1.2.1.0&quot;);
      define(&quot;OID_dell_ports&quot;,&quot;.1.3.6.1.2.1.2.2.1.7&quot;); /* Включают и вланы IF-MIB::ifAdminStatus.46 = INTEGER: up(1) */
      define(&quot;OID_dell_ports_descr&quot;,&quot;.1.3.6.1.2.1.2.2.1.2&quot;);  	
      define(&quot;OID_dell_ports_speed&quot;,&quot;.1.3.6.1.2.1.2.2.1.5&quot;);
    
      
      define(&quot;OID_mac_on_ports&quot;,&quot;.1.3.6.1.2.1.17.7.1.2.2.1.2&quot;);
      define(&quot;OID_cisco_mac_on_ports&quot;,&quot;.1.3.6.1.2.1.17.4.3.1.1&quot;);
      define(&quot;OID_ports_updown&quot;,&quot;.1.3.6.1.2.1.2.2.1.8&quot;);
      
      
      
      define(&quot;PAGE_MES_1&quot;,&quot;Данные не доступны&quot;);
      define(&quot;PAGE_MES_2&quot;,&quot;Данные o свиче&quot;);
      define(&quot;PAGE_MES_3&quot;,&quot;Тип&quot;);
      define(&quot;PAGE_MES_4&quot;,&quot;Версия&quot;);
      define(&quot;PAGE_MES_5&quot;,&quot;Количество портов&quot;);
    ?&gt;</p></div>
    ";i:7;s:52016:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    103
    104
    105
    106
    107
    108
    109
    110
    111
    112
    113
    114
    115
    116
    117
    118
    119
    120
    121
    122
    123
    124
    125
    126
    127
    128
    129
    130
    131
    132
    133
    134
    135
    136
    137
    138
    139
    140
    141
    142
    143
    144
    145
    146
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
    <span style="color: #666666; font-style: italic;">/*
    PHPTelnet 1.1.1
    by Antone Roundy
    adapted from code found on the PHP website
    public domain
    */</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">class</span> PHPTelnet <span style="color: #009900;">&#123;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$show_connect_error</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$use_usleep</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>	<span style="color: #666666; font-style: italic;">// change to 1 for faster execution</span>
    		<span style="color: #666666; font-style: italic;">// don't change to 1 on Windows servers unless you have PHP 5</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$sleeptime</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">125000</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$loginsleeptime</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1000000</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$fp</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$loginprompt</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$conn1</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$conn2</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">/*
    	0 = success
    	1 = couldn't open network connection
    	2 = unknown host
    	3 = login failed
    	4 = PHP version too low
    	*/</span>
    	<span style="color: #000000; font-weight: bold;">function</span> Connect<span style="color: #009900;">&#40;</span><span style="color: #000088;">$server</span><span style="color: #339933;">,</span><span style="color: #000088;">$user</span><span style="color: #339933;">,</span><span style="color: #000088;">$pass</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$rv</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$vers</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'.'</span><span style="color: #339933;">,</span><span style="color: #009900; font-weight: bold;">PHP_VERSION</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$needvers</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$j</span><span style="color: #339933;">=</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$vers</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$k</span><span style="color: #339933;">=</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$needvers</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$j</span><span style="color: #009900;">&#41;</span> <span style="color: #000088;">$j</span><span style="color: #339933;">=</span><span style="color: #000088;">$k</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$j</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$vers</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #000088;">$needvers</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$vers</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$needvers</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">ConnectError</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">return</span> <span style="color: #cc66cc;">4</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">Disconnect</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$server</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'/[^0-9.]/'</span><span style="color: #339933;">,</span><span style="color: #000088;">$server</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #990000;">gethostbyname</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$server</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">==</span><span style="color: #000088;">$server</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$rv</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #000088;">$server</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #0000ff;">'127.0.0.1'</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">=</span><span style="color: #990000;">fsockopen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">23</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #990000;">fputs</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">conn1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">Sleep</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #990000;">fputs</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">conn2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">Sleep</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">GetResponse</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$r</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loginprompt</span><span style="color: #339933;">=</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#91;</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #990000;">fputs</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$user</span><span style="color: #000099; font-weight: bold;">\r</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">Sleep</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #990000;">fputs</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$pass</span><span style="color: #000099; font-weight: bold;">\r</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_usleep</span><span style="color: #009900;">&#41;</span> <span style="color: #990000;">usleep</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loginsleeptime</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">else</span> <span style="color: #990000;">sleep</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">GetResponse</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$r</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#91;</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">==</span><span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">||</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">loginprompt</span><span style="color: #339933;">==</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#91;</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$rv</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">Disconnect</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #000088;">$rv</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$rv</span><span style="color: #009900;">&#41;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">ConnectError</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rv</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$rv</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">function</span> Disconnect<span style="color: #009900;">&#40;</span><span style="color: #000088;">$exit</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$exit</span><span style="color: #009900;">&#41;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'exit'</span><span style="color: #339933;">,</span><span style="color: #000088;">$junk</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #990000;">fclose</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">function</span> DoCommand<span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span><span style="color: #339933;">,&amp;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #990000;">fputs</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$c</span><span style="color: #000099; font-weight: bold;">\r</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">Sleep</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">GetResponse</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$r</span><span style="color: #339933;">=</span><span style="color: #990000;">preg_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/^.*?<span style="color: #000099; font-weight: bold;">\n</span>(.*)<span style="color: #000099; font-weight: bold;">\n</span>[^<span style="color: #000099; font-weight: bold;">\n</span>]*$/&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$1</span>&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span>?<span style="color: #cc66cc;">1</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">function</span> GetResponse<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$r</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$r</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">do</span> <span style="color: #009900;">&#123;</span> 
    			<span style="color: #000088;">$r</span><span style="color: #339933;">.=</span><span style="color: #990000;">fread</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1000</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$s</span><span style="color: #339933;">=</span><span style="color: #990000;">socket_get_status</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fp</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$s</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'unread_bytes'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">function</span> <span style="color: #990000;">Sleep</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">use_usleep</span><span style="color: #009900;">&#41;</span> <span style="color: #990000;">usleep</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">sleeptime</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">else</span> <span style="color: #990000;">sleep</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">function</span> PHPTelnet<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">conn1</span><span style="color: #339933;">=</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFB</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x1F</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFB</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x20</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFB</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x18</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFB</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x27</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFD</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x01</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFB</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x03</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFD</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x03</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFC</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x23</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFC</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x24</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFA</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x1F</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x00</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x50</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x00</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x18</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xF0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFA</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x20</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x00</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x33</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x38</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x34</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x30</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x30</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x2C</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x33</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x38</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x34</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x30</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x30</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xF0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFA</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x27</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x00</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xF0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFA</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x18</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x00</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x58</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x54</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x45</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x52</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x4D</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xF0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">conn2</span><span style="color: #339933;">=</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFC</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x01</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFC</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>
    			<span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x22</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFE</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x05</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFF</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0xFC</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #208080;">0x21</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">function</span> ConnectError<span style="color: #009900;">&#40;</span><span style="color: #000088;">$num</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">show_connect_error</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$num</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">:</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/fsockopen.php&quot;&gt;Connect failed: Unable to open network connection&lt;/a&gt;&lt;br /&gt;'</span><span style="color: #339933;">;</span> <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">:</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/unknown-host.php&quot;&gt;Connect failed: Unknown host&lt;/a&gt;&lt;br /&gt;'</span><span style="color: #339933;">;</span> <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">3</span><span style="color: #339933;">:</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/login.php&quot;&gt;Connect failed: Login failed&lt;/a&gt;&lt;br /&gt;'</span><span style="color: #339933;">;</span> <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">4</span><span style="color: #339933;">:</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/php-version.php&quot;&gt;Connect failed: Your server\'s PHP version is too low for PHP Telnet&lt;/a&gt;&lt;br /&gt;'</span><span style="color: #339933;">;</span> <span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
    &nbsp;
    <span style="color: #b1b100;">return</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php
    /*
    PHPTelnet 1.1.1
    by Antone Roundy
    adapted from code found on the PHP website
    public domain
    */
    
    class PHPTelnet {
    	var $show_connect_error=1;
    
    	var $use_usleep=0;	// change to 1 for faster execution
    		// don't change to 1 on Windows servers unless you have PHP 5
    	var $sleeptime=125000;
    	var $loginsleeptime=1000000;
    
    	var $fp=NULL;
    	var $loginprompt;
    
    	var $conn1;
    	var $conn2;
    	
    	/*
    	0 = success
    	1 = couldn't open network connection
    	2 = unknown host
    	3 = login failed
    	4 = PHP version too low
    	*/
    	function Connect($server,$user,$pass) {
    		$rv=0;
    		$vers=explode('.',PHP_VERSION);
    		$needvers=array(4,3,0);
    		$j=count($vers);
    		$k=count($needvers);
    		if ($k&lt;$j) $j=$k;
    		for ($i=0;$i&lt;$j;$i++) {
    			if (($vers[$i]+0)&gt;$needvers[$i]) break;
    			if (($vers[$i]+0)&lt;$needvers[$i]) {
    				$this-&gt;ConnectError(4);
    				return 4;
    			}
    		}
    		
    		$this-&gt;Disconnect();
    		
    		if (strlen($server)) {
    			if (preg_match('/[^0-9.]/',$server)) {
    				$ip=gethostbyname($server);
    				if ($ip==$server) {
    					$ip='';
    					$rv=2;
    				}
    			} else $ip=$server;
    		} else $ip='127.0.0.1';
    		
    		if (strlen($ip)) {
    			if ($this-&gt;fp=fsockopen($ip,23)) {
    				fputs($this-&gt;fp,$this-&gt;conn1);
    				$this-&gt;Sleep();
    				
    				fputs($this-&gt;fp,$this-&gt;conn2);
    				$this-&gt;Sleep();
    				$this-&gt;GetResponse($r);
    				$r=explode(&quot;\n&quot;,$r);
    				$this-&gt;loginprompt=$r[count($r)-1];
    
    				fputs($this-&gt;fp,&quot;$user\r&quot;);
    				$this-&gt;Sleep();
    
    				fputs($this-&gt;fp,&quot;$pass\r&quot;);
    				if ($this-&gt;use_usleep) usleep($this-&gt;loginsleeptime);
    				else sleep(1);
    				$this-&gt;GetResponse($r);
    				$r=explode(&quot;\n&quot;,$r);
    				if (($r[count($r)-1]=='')||($this-&gt;loginprompt==$r[count($r)-1])) {
    					$rv=3;
    					$this-&gt;Disconnect();
    				}
    			} else $rv=1;
    		}
    		
    		if ($rv) $this-&gt;ConnectError($rv);
    		return $rv;
    	}
    	
    	function Disconnect($exit=1) {
    		if ($this-&gt;fp) {
    			if ($exit) $this-&gt;DoCommand('exit',$junk);
    			fclose($this-&gt;fp);
    			$this-&gt;fp=NULL;
    		}
    	}
    
    	function DoCommand($c,&amp;$r) {
    		if ($this-&gt;fp) {
    			fputs($this-&gt;fp,&quot;$c\r&quot;);
    			$this-&gt;Sleep();
    			$this-&gt;GetResponse($r);
    			$r=preg_replace(&quot;/^.*?\n(.*)\n[^\n]*$/&quot;,&quot;$1&quot;,$r);
    		}
    		return $this-&gt;fp?1:0;
    	}
    	
    	function GetResponse(&amp;$r) {
    		$r='';
    		do { 
    			$r.=fread($this-&gt;fp,1000);
    			$s=socket_get_status($this-&gt;fp);
    		} while ($s['unread_bytes']);
    	}
    	
    	function Sleep() {
    		if ($this-&gt;use_usleep) usleep($this-&gt;sleeptime);
    		else sleep(1);
    	}
    	
    	function PHPTelnet() {
    		$this-&gt;conn1=chr(0xFF).chr(0xFB).chr(0x1F).chr(0xFF).chr(0xFB).
    			chr(0x20).chr(0xFF).chr(0xFB).chr(0x18).chr(0xFF).chr(0xFB).
    			chr(0x27).chr(0xFF).chr(0xFD).chr(0x01).chr(0xFF).chr(0xFB).
    			chr(0x03).chr(0xFF).chr(0xFD).chr(0x03).chr(0xFF).chr(0xFC).
    			chr(0x23).chr(0xFF).chr(0xFC).chr(0x24).chr(0xFF).chr(0xFA).
    			chr(0x1F).chr(0x00).chr(0x50).chr(0x00).chr(0x18).chr(0xFF).
    			chr(0xF0).chr(0xFF).chr(0xFA).chr(0x20).chr(0x00).chr(0x33).
    			chr(0x38).chr(0x34).chr(0x30).chr(0x30).chr(0x2C).chr(0x33).
    			chr(0x38).chr(0x34).chr(0x30).chr(0x30).chr(0xFF).chr(0xF0).
    			chr(0xFF).chr(0xFA).chr(0x27).chr(0x00).chr(0xFF).chr(0xF0).
    			chr(0xFF).chr(0xFA).chr(0x18).chr(0x00).chr(0x58).chr(0x54).
    			chr(0x45).chr(0x52).chr(0x4D).chr(0xFF).chr(0xF0);
    		$this-&gt;conn2=chr(0xFF).chr(0xFC).chr(0x01).chr(0xFF).chr(0xFC).
    			chr(0x22).chr(0xFF).chr(0xFE).chr(0x05).chr(0xFF).chr(0xFC).chr(0x21);
    	}
    	
    	function ConnectError($num) {
    		if ($this-&gt;show_connect_error) switch ($num) {
    		case 1: echo '&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/fsockopen.php&quot;&gt;Connect failed: Unable to open network connection&lt;/a&gt;&lt;br /&gt;'; break;
    		case 2: echo '&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/unknown-host.php&quot;&gt;Connect failed: Unknown host&lt;/a&gt;&lt;br /&gt;'; break;
    		case 3: echo '&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/login.php&quot;&gt;Connect failed: Login failed&lt;/a&gt;&lt;br /&gt;'; break;
    		case 4: echo '&lt;br /&gt;[PHP Telnet] &lt;a href=&quot;http://www.geckotribe.com/php-telnet/errors/php-version.php&quot;&gt;Connect failed: Your server\'s PHP version is too low for PHP Telnet&lt;/a&gt;&lt;br /&gt;'; break;
    		}
    	}
    }
    
    return;
    ?&gt;</p></div>
    ";i:8;s:80824:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    103
    104
    105
    106
    107
    108
    109
    110
    111
    112
    113
    114
    115
    116
    117
    118
    119
    120
    121
    122
    123
    124
    125
    126
    127
    128
    129
    130
    131
    132
    133
    134
    135
    136
    137
    138
    139
    140
    141
    142
    143
    144
    145
    146
    147
    148
    149
    150
    151
    152
    153
    154
    155
    156
    157
    158
    159
    160
    161
    162
    163
    164
    165
    166
    167
    168
    169
    170
    171
    172
    173
    174
    175
    176
    177
    178
    179
    180
    181
    182
    183
    184
    185
    186
    187
    188
    189
    190
    191
    192
    193
    194
    195
    196
    197
    198
    199
    200
    201
    202
    203
    204
    205
    206
    207
    208
    209
    210
    211
    212
    213
    214
    215
    216
    217
    218
    219
    220
    221
    222
    223
    224
    225
    226
    227
    228
    229
    230
    231
    232
    233
    234
    235
    236
    237
    238
    239
    240
    241
    242
    243
    244
    245
    246
    247
    248
    249
    250
    251
    252
    253
    254
    255
    256
    257
    258
    259
    260
    261
    262
    263
    264
    265
    266
    267
    268
    269
    270
    271
    272
    273
    274
    275
    276
    277
    278
    279
    280
    281
    282
    283
    284
    285
    286
    287
    288
    289
    290
    291
    292
    293
    294
    295
    296
    297
    298
    299
    300
    301
    302
    303
    304
    305
    306
    307
    308
    309
    310
    311
    312
    313
    314
    315
    316
    317
    318
    319
    320
    321
    322
    323
    324
    325
    326
    327
    328
    329
    330
    331
    332
    333
    334
    335
    336
    337
    338
    339
    340
    341
    342
    343
    344
    345
    346
    347
    348
    349
    350
    351
    352
    353
    354
    355
    356
    357
    358
    359
    360
    361
    362
    363
    364
    365
    366
    367
    368
    369
    370
    371
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
    <span style="color: #666666; font-style: italic;">/*
    $Id: telnet.class.php,v 1.2 2004/03/22 10:01:35 mb Exp $
    &nbsp;
    Originally written by Marc Ennaji (in french),
    modified by Matthias Blaser &lt;mb@adfinis.ch&gt;
    &nbsp;
    - translated most function- and variable names from french to english
    - added get_buffer-method to get results of the last command
      sent to server
    - added hack to get socket_strerror working on old systems
    &nbsp;
    You can find the original class which this translation is based on
    on this url: http://px.sklar.com/code.html?id=634
    &nbsp;
    The original class includes a small documentation about using it
    in your own applications, but be aware, all functions are in french there, this
    one is partly translated.
    */</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">// hack to get socket_strerror working on old systems</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #990000;">function_exists</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;socket_strerror&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #000000; font-weight: bold;">function</span> <span style="color: #990000;">socket_strerror</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sh</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">function_exists</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;strerror&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">return</span> strerror<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sh</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
    &nbsp;
    <span style="color: #666666; font-style: italic;">// telnet class</span>
    <span style="color: #990000;">define</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;TELNET_ERROR&quot;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #990000;">define</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;TELNET_OK&quot;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #990000;">define</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;TELNET_ASK_CONFIRMATION&quot;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #990000;">define</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;LIBELLE_CONFIRMATION&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;[confirm]&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">class</span> telnet <span style="color: #009900;">&#123;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$socket</span>  <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$host</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$port</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;23&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$codeError</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$prompt</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\$</span> &quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$log</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// file handle</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$repertoireLog</span><span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$nomFichierLog</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$test</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">var</span> <span style="color: #000088;">$buffer</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> connect<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span> <span style="color: #339933;">=</span> <span style="color: #990000;">fsockopen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">port</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;unable to open a telnet connection: &quot;</span> <span style="color: #339933;">.</span> <span style="color: #990000;">socket_strerror</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #990000;">socket_set_timeout</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> read_to<span style="color: #009900;">&#40;</span><span style="color: #000088;">$chaine</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$NULL</span> <span style="color: #339933;">=</span> <span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$IAC</span> <span style="color: #339933;">=</span> <span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$buf</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;telnet socket is not open&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getc</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			 <span style="color: #666666; font-style: italic;">// plus de caracteres a lire sur la socket</span>
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">contientErreur</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot; Couldn't find the requested : '&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$chaine</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;', it was not in the data returned from server : '&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$buf</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;'&quot;</span> <span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$NULL</span> <span style="color: #339933;">||</span> <span style="color: #000088;">$c</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">&quot;<span style="color: #660099; font-weight: bold;">\021</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$IAC</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #666666; font-style: italic;">// Interpreted As Command</span>
    				<span style="color: #000088;">$c</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getc</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$IAC</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #666666; font-style: italic;">// car le 'vrai' caractere 255 est doublé pour le differencier du IAC</span>
    					<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">negocierOptionTelnet</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    					<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    						<span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
    					<span style="color: #009900;">&#125;</span>
    				<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #000088;">$buf</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #666666; font-style: italic;">// append current char to global buffer</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">buffer</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$c</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #666666; font-style: italic;">// indiquer à l'utilisateur de la classe qu'il a une demande de confirmation</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #339933;">,</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span>LIBELLE_CONFIRMATION<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> LIBELLE_CONFIRMATION<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getDernieresLignes</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">return</span> TELNET_ASK_CONFIRMATION<span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #339933;">,</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$chaine</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$chaine</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #666666; font-style: italic;">// on a trouve la chaine attendue</span>
    &nbsp;
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getDernieresLignes</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">contientErreur</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> getc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #990000;">fgetc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> get_buffer<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$buf</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">buffer</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #666666; font-style: italic;">// cut last line (is always prompt)</span>
    		<span style="color: #000088;">$buf</span> <span style="color: #339933;">=</span> <span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #990000;">unset</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#91;</span><span style="color: #990000;">count</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$buf</span> <span style="color: #339933;">=</span> <span style="color: #990000;">join</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #990000;">trim</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> negocierOptionTelnet<span style="color: #009900;">&#40;</span><span style="color: #000088;">$commande</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #666666; font-style: italic;">// on negocie des options minimales</span>
    &nbsp;
    		<span style="color: #000088;">$IAC</span> <span style="color: #339933;">=</span> <span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">255</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$DONT</span> <span style="color: #339933;">=</span> <span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">254</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$DO</span> <span style="color: #339933;">=</span> <span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">253</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$WONT</span> <span style="color: #339933;">=</span> <span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">252</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$WILL</span> <span style="color: #339933;">=</span> <span style="color: #990000;">chr</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">251</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$commande</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$DO</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$commande</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$DONT</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$opt</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getc</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #666666; font-style: italic;">//echo &quot;wont &quot;.ord($opt).&quot;\n&quot;;</span>
    			<span style="color: #990000;">fwrite</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #339933;">,</span><span style="color: #000088;">$IAC</span><span style="color: #339933;">.</span><span style="color: #000088;">$WONT</span><span style="color: #339933;">.</span><span style="color: #000088;">$opt</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$commande</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$WILL</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$commande</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$WONT</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$opt</span> <span style="color: #339933;">=</span> <span style="color: #990000;">fgetc</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #666666; font-style: italic;">//echo &quot;dont &quot;.ord($opt).&quot;\n&quot;;</span>
    			<span style="color: #990000;">fwrite</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #339933;">,</span><span style="color: #000088;">$IAC</span><span style="color: #339933;">.</span><span style="color: #000088;">$DONT</span><span style="color: #339933;">.</span><span style="color: #000088;">$opt</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Error : unknown command &quot;</span><span style="color: #339933;">.</span><span style="color: #990000;">ord</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$commande</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> write<span style="color: #009900;">&#40;</span><span style="color: #000088;">$buffer</span><span style="color: #339933;">,</span> <span style="color: #000088;">$valeurLoggee</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$ajouterfinLigne</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    		<span style="color: #666666; font-style: italic;">// clear buffer from last command</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">buffer</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;telnet socket is not open&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$ajouterfinLigne</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$buffer</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">fwrite</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #339933;">,</span><span style="color: #000088;">$buffer</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;error writing to socket&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$valeurLoggee</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #666666; font-style: italic;">// cacher les valeurs confidentielles dans la log (mots de passe...)</span>
    			<span style="color: #000088;">$buffer</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$valeurLoggee</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span> <span style="color: #000088;">$ajouterfinLigne</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #666666; font-style: italic;">// dans la log (mais pas sur la socket), rajouter tout de meme le caractere de fin de ligne</span>
    			<span style="color: #000088;">$buffer</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&gt; &quot;</span> <span style="color: #339933;">.</span><span style="color: #000088;">$buffer</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> disconnect<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span> <span style="color: #990000;">fclose</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;error while closing telnet socket&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">socket</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setLog</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> contientErreur<span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$messagesErreurs</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;nvalid&quot;</span><span style="color: #339933;">;</span>       <span style="color: #666666; font-style: italic;">// Invalid input, ...</span>
    		<span style="color: #000088;">$messagesErreurs</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;o specified&quot;</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// No specified atm, ...</span>
    		<span style="color: #000088;">$messagesErreurs</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;nknown&quot;</span><span style="color: #339933;">;</span>       <span style="color: #666666; font-style: italic;">// Unknown profile, ...</span>
    		<span style="color: #000088;">$messagesErreurs</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;o such file or directory&quot;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// sauvegarde dans un repertoire inexistant</span>
    		<span style="color: #000088;">$messagesErreurs</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;llegal&quot;</span><span style="color: #339933;">;</span>       <span style="color: #666666; font-style: italic;">// illegal file name, ...</span>
    &nbsp;
    		<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$messagesErreurs</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$erreur</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">strpos</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #339933;">,</span> <span style="color: #000088;">$erreur</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span>
    				<span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #666666; font-style: italic;">// une erreur est détectée</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span>  <span style="color: #0000ff;">&quot;Un message d'erreur a été détecté dans la réponse de l'hôte distant : &quot;</span> <span style="color: #339933;">.</span>
    					<span style="color: #0000ff;">&quot;&lt;BR&gt;&lt;BR&gt;&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getDernieresLignes</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$buf</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&lt;BR&gt;&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;&lt;BR&gt;&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> wait_prompt<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">read_to</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">prompt</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> set_prompt<span style="color: #009900;">&#40;</span><span style="color: #000088;">$s</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">prompt</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$s</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> set_host<span style="color: #009900;">&#40;</span><span style="color: #000088;">$s</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$s</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> set_port<span style="color: #009900;">&#40;</span><span style="color: #000088;">$s</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">port</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$s</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> get_last_error<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> setLog<span style="color: #009900;">&#40;</span><span style="color: #000088;">$activerLog</span><span style="color: #339933;">,</span> <span style="color: #000088;">$traitement</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$activerLog</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$activerLog</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">repertoireLog</span> <span style="color: #339933;">=</span>  <span style="color: #0000ff;">&quot;/log/&quot;</span> <span style="color: #339933;">.</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;m&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #666666; font-style: italic;">// repertoire mensuel inexistant ?</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span> <span style="color: #990000;">file_exists</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">repertoireLog</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">mkdir</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">repertoireLog</span><span style="color: #339933;">,</span> <span style="color: #208080;">0700</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">===</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Impossible de créer le repertoire de log &quot;</span> <span style="color: #339933;">.</span>  <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">repertoireLog</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$HTTP_SERVER_VARS</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">nomFichierLog</span> <span style="color: #339933;">=</span> 	<span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;d&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;_&quot;</span> <span style="color: #339933;">.</span>
    				<span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;H:i:s&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;_&quot;</span> <span style="color: #339933;">.</span>
    &nbsp;
    			<span style="color: #000088;">$traitement</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;_&quot;</span> <span style="color: #339933;">.</span>
    				<span style="color: #000088;">$HTTP_SERVER_VARS</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;PHP_AUTH_USER&quot;</span><span style="color: #009900;">&#93;</span>
    				<span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;.log&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span> <span style="color: #339933;">=</span> <span style="color: #990000;">fopen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">repertoireLog</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;/&quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">nomFichierLog</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;a&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">empty</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Impossible de créer le fichier de log &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">nomFichierLog</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;----------------------------------------------<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Début de la log de l'utilisateur &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$HTTP_SERVER_VARS</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;PHP_AUTH_USER&quot;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span>
    				<span style="color: #0000ff;">&quot;, adresse IP &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$HTTP_SERVER_VARS</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;REMOTE_ADDR&quot;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Connexion telnet sur &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;, port &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">port</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Date : &quot;</span> <span style="color: #339933;">.</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;d-m-Y&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>  <span style="color: #0000ff;">&quot;  à &quot;</span> <span style="color: #339933;">.</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;H:i:s&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Type de traitement effectué : &quot;</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$traitement</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;----------------------------------------------<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;----------------------------------------------<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">logger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Fin de la log<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #990000;">fflush</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span> <span style="color: #990000;">fclose</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">error</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;erreur a la fermeture du fichier de log&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">return</span> TELNET_ERROR<span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #b1b100;">return</span> TELNET_OK<span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> logger<span style="color: #009900;">&#40;</span><span style="color: #000088;">$s</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #990000;">fwrite</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">log</span><span style="color: #339933;">,</span> <span style="color: #000088;">$s</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    	<span style="color: #000000; font-weight: bold;">function</span> getDernieresLignes<span style="color: #009900;">&#40;</span><span style="color: #000088;">$s</span><span style="color: #339933;">,</span> <span style="color: #000088;">$separateur</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #666666; font-style: italic;">// une reponse telnet contient (en principe) en premiere ligne l'echo de la commande utilisateur.</span>
    		<span style="color: #666666; font-style: italic;">// cette methode renvoie tout sauf la premiere ligne, afin de ne pas polluer les logs telnet</span>
    &nbsp;
    		<span style="color: #000088;">$lignes</span> <span style="color: #339933;">=</span> <span style="color: #990000;">split</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$s</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$resultat</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$premiereLigne</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">while</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">list</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$key</span><span style="color: #339933;">,</span> <span style="color: #000088;">$data</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #990000;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$lignes</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$premiereLigne</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$premiereLigne</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$data</span> <span style="color: #339933;">!=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$resultat</span> <span style="color: #339933;">.=</span> <span style="color: #000088;">$data</span> <span style="color: #339933;">.</span> <span style="color: #000088;">$separateur</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000088;">$resultat</span> <span style="color: #339933;">==</span> <span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$resultat</span><span style="color: #339933;">,</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$resultat</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// enlever le dernier caractere de fin de ligne</span>
    &nbsp;
    		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$resultat</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">//------------------------------------------------------------------------</span>
    <span style="color: #009900;">&#125;</span>   <span style="color: #666666; font-style: italic;">//    Fin de la classe</span>
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php
    /*
    $Id: telnet.class.php,v 1.2 2004/03/22 10:01:35 mb Exp $
    
    Originally written by Marc Ennaji (in french),
    modified by Matthias Blaser &lt;mb@adfinis.ch&gt;
    
    - translated most function- and variable names from french to english
    - added get_buffer-method to get results of the last command
      sent to server
    - added hack to get socket_strerror working on old systems
    
    You can find the original class which this translation is based on
    on this url: http://px.sklar.com/code.html?id=634
    
    The original class includes a small documentation about using it
    in your own applications, but be aware, all functions are in french there, this
    one is partly translated.
    */
    
    // hack to get socket_strerror working on old systems
    if(!function_exists(&quot;socket_strerror&quot;)){
    	function socket_strerror($sh){
    		if(function_exists(&quot;strerror&quot;)){
    			return strerror($sh);
    		} else {
    			return false;
    		}
    	}
    }
    
    // telnet class
    define (&quot;TELNET_ERROR&quot;, 0);
    define (&quot;TELNET_OK&quot;, 1);
    define (&quot;TELNET_ASK_CONFIRMATION&quot;, 2);
    define (&quot;LIBELLE_CONFIRMATION&quot;, &quot;[confirm]&quot;);
    
    class telnet {
    
    	var $socket  = NULL;
    	var $host = &quot;&quot;;
    	var $port = &quot;23&quot;;
    	var $error = &quot;&quot;;
    	var $codeError = &quot;&quot;;
    	var $prompt = &quot;\$ &quot;;
    	var $log = NULL;  // file handle
    	var $repertoireLog= &quot;&quot;;
    	var $nomFichierLog = &quot;&quot;;
    	var $test;
    
    	var $buffer = &quot;&quot;;
    
    	//------------------------------------------------------------------------
    	function connect(){
    		$this-&gt;socket = fsockopen($this-&gt;host,$this-&gt;port);
    
    		if (!$this-&gt;socket){
    			$this-&gt;error = &quot;unable to open a telnet connection: &quot; . socket_strerror($this-&gt;socket) . &quot;\n&quot;;
    			return TELNET_ERROR;
    		}
    
    		socket_set_timeout($this-&gt;socket,1,0);
    		return TELNET_OK;
    	}
    
    	//------------------------------------------------------------------------
    	function read_to($chaine){
    		$NULL = chr(0);
    		$IAC = chr(255);
    		$buf = '';
    
    		if (!$this-&gt;socket){
    			$this-&gt;error = &quot;telnet socket is not open&quot;;
    			return TELNET_ERROR;
    		}
    
    		while (1){
    			$c = $this-&gt;getc();
    
    			if ($c === false){
    			 // plus de caracteres a lire sur la socket
    				if ($this-&gt;contientErreur($buf)){
    					return TELNET_ERROR;
    				}
    
    				$this-&gt;error = &quot; Couldn't find the requested : '&quot; . $chaine . &quot;', it was not in the data returned from server : '&quot; . $buf . &quot;'&quot; ;
    				$this-&gt;logger($this-&gt;error);
    				return TELNET_ERROR;
    			}
    
    			if ($c == $NULL || $c == &quot;\021&quot;){
    				continue;
    			}
    
    			if ($c == $IAC){
    				// Interpreted As Command
    				$c = $this-&gt;getc();
    
    				if ($c != $IAC){
    					// car le 'vrai' caractere 255 est doublé pour le differencier du IAC
    					if (! $this-&gt;negocierOptionTelnet($c)){
    						return TELNET_ERROR;
    					} else {
    						continue;
    					}
    				}
    
    			}
    
    			$buf .= $c;
    
    			// append current char to global buffer
    			$this-&gt;buffer .= $c;
    
    			// indiquer à l'utilisateur de la classe qu'il a une demande de confirmation
    			if (substr($buf,strlen($buf)-strlen(LIBELLE_CONFIRMATION)) == LIBELLE_CONFIRMATION){
    				$this-&gt;logger($this-&gt;getDernieresLignes($buf));
    				return TELNET_ASK_CONFIRMATION;
    			}
    
    			if ((substr($buf,strlen($buf)-strlen($chaine))) == $chaine){
    				// on a trouve la chaine attendue
    
    				$this-&gt;logger($this-&gt;getDernieresLignes($buf));
    
    				if ($this-&gt;contientErreur($buf)){
    					return TELNET_ERROR;
    				} else {
    					return TELNET_OK;
    				}
    			}
    		}
    	}
    
    	//------------------------------------------------------------------------
    	function getc(){
    		return fgetc($this-&gt;socket);
    	}
    
    	//------------------------------------------------------------------------
    	function get_buffer(){
    		$buf = $this-&gt;buffer;
    
    		// cut last line (is always prompt)
    		$buf = explode(&quot;\n&quot;, $buf);
    		unset($buf[count($buf)-1]);
    		$buf = join(&quot;\n&quot;,$buf);
    		return trim($buf);
    	}
    
    	//------------------------------------------------------------------------
    	function negocierOptionTelnet($commande){
    		// on negocie des options minimales
    
    		$IAC = chr(255);
    		$DONT = chr(254);
    		$DO = chr(253);
    		$WONT = chr(252);
    		$WILL = chr(251);
    
    		if (($commande == $DO) || ($commande == $DONT)){
    			$opt = $this-&gt;getc();
    			//echo &quot;wont &quot;.ord($opt).&quot;\n&quot;;
    			fwrite($this-&gt;socket,$IAC.$WONT.$opt);
    		} else if (($commande == $WILL) || ($commande == $WONT)) {
    			$opt = fgetc($this-&gt;socket);
    			//echo &quot;dont &quot;.ord($opt).&quot;\n&quot;;
    			fwrite($this-&gt;socket,$IAC.$DONT.$opt);
    		} else {
    			$this-&gt;error = &quot;Error : unknown command &quot;.ord($commande).&quot;\n&quot;;
    			return false;
    		}
    
    		return true;
    	}
    
    	//------------------------------------------------------------------------
    	function write($buffer, $valeurLoggee = &quot;&quot;, $ajouterfinLigne = true){
    
    		// clear buffer from last command
    		$this-&gt;buffer = &quot;&quot;;
    
    		if (! $this-&gt;socket){
    			$this-&gt;error = &quot;telnet socket is not open&quot;;
    			return TELNET_ERROR;
    		}
    
    		if ($ajouterfinLigne){
    			$buffer .= &quot;\n&quot;;
    		}
    
    		if (fwrite($this-&gt;socket,$buffer) &lt; 0){
    			$this-&gt;error = &quot;error writing to socket&quot;;
    			return TELNET_ERROR;
    		}
    
    		if ($valeurLoggee != &quot;&quot;){
    			// cacher les valeurs confidentielles dans la log (mots de passe...)
    			$buffer = $valeurLoggee . &quot;\n&quot;;
    		}
    
    		if (! $ajouterfinLigne){
    			// dans la log (mais pas sur la socket), rajouter tout de meme le caractere de fin de ligne
    			$buffer .= &quot;\n&quot;;
    		}
    
    		$this-&gt;logger(&quot;&gt; &quot; .$buffer);
    
    		return TELNET_OK;
    	}
    
    	//------------------------------------------------------------------------
    	function disconnect(){
    		if ($this-&gt;socket){
    			if (! fclose($this-&gt;socket)){
    				$this-&gt;error = &quot;error while closing telnet socket&quot;;
    				return TELNET_ERROR;
    			}
    
    			$this-&gt;socket = NULL;
    		}
    
    		$this-&gt;setLog(false,&quot;&quot;);
    		return TELNET_OK;
    	}
    
    	//------------------------------------------------------------------------
    	function contientErreur($buf){
    		$messagesErreurs[] = &quot;nvalid&quot;;       // Invalid input, ...
    		$messagesErreurs[] = &quot;o specified&quot;;  // No specified atm, ...
    		$messagesErreurs[] = &quot;nknown&quot;;       // Unknown profile, ...
    		$messagesErreurs[] = &quot;o such file or directory&quot;; // sauvegarde dans un repertoire inexistant
    		$messagesErreurs[] = &quot;llegal&quot;;       // illegal file name, ...
    
    		foreach ($messagesErreurs as $erreur){
    			if (strpos ($buf, $erreur) === false)
    				continue;
    
    				// une erreur est détectée
    				$this-&gt;error =  &quot;Un message d'erreur a été détecté dans la réponse de l'hôte distant : &quot; .
    					&quot;&lt;BR&gt;&lt;BR&gt;&quot; . $this-&gt;getDernieresLignes($buf,&quot;&lt;BR&gt;&quot;) . &quot;&lt;BR&gt;&quot;;
    
    				return true;
    			}
    
    		return false;
    	}
    
    	//------------------------------------------------------------------------
    	function wait_prompt(){
    		return $this-&gt;read_to($this-&gt;prompt);
    	}
    
    	//------------------------------------------------------------------------
    	function set_prompt($s){
    		$this-&gt;prompt = $s;
    		return TELNET_OK;
    	}
    
    	//------------------------------------------------------------------------
    	function set_host($s){
    		$this-&gt;host = $s;
    	}
    
    	//------------------------------------------------------------------------
    	function set_port($s){
    		$this-&gt;port = $s;
    	}
    
    	//------------------------------------------------------------------------
    	function get_last_error(){
    		return $this-&gt;error;
    	}
    
    	//------------------------------------------------------------------------
    	function setLog($activerLog, $traitement){
    
    		if ($this-&gt;log &amp;&amp; $activerLog){
    			return TELNET_OK;
    		}
    
    		if ($activerLog){
    			$this-&gt;repertoireLog =  &quot;/log/&quot; . date(&quot;m&quot;);
    
    			// repertoire mensuel inexistant ?
    			if (! file_exists($this-&gt;repertoireLog)){
    				if (mkdir($this-&gt;repertoireLog, 0700) === false){
    					$this-&gt;error = &quot;Impossible de créer le repertoire de log &quot; .  $this-&gt;repertoireLog;
    					return TELNET_ERROR;
    				}
    			}
    
    			global $HTTP_SERVER_VARS;
    
    			$this-&gt;nomFichierLog = 	date(&quot;d&quot;) . &quot;_&quot; .
    				date(&quot;H:i:s&quot;) . &quot;_&quot; .
    
    			$traitement . &quot;_&quot; .
    				$HTTP_SERVER_VARS[&quot;PHP_AUTH_USER&quot;]
    				. &quot;.log&quot;;
    
    			$this-&gt;log = fopen($this-&gt;repertoireLog . &quot;/&quot; . $this-&gt;nomFichierLog,&quot;a&quot;);
    
    			if (empty($this-&gt;log)){
    				$this-&gt;error = &quot;Impossible de créer le fichier de log &quot; . $this-&gt;nomFichierLog;
    				return TELNET_ERROR;
    			}
    
    			$this-&gt;logger(&quot;----------------------------------------------\r\n&quot;);
    			$this-&gt;logger(&quot;Début de la log de l'utilisateur &quot; . $HTTP_SERVER_VARS[&quot;PHP_AUTH_USER&quot;] .
    				&quot;, adresse IP &quot; . $HTTP_SERVER_VARS[&quot;REMOTE_ADDR&quot;] . &quot;\r\n&quot;);
    
    			$this-&gt;logger(&quot;Connexion telnet sur &quot; . $this-&gt;host . &quot;, port &quot; . $this-&gt;port . &quot;\r\n&quot;);
    			$this-&gt;logger(&quot;Date : &quot; . date(&quot;d-m-Y&quot;).  &quot;  à &quot; . date(&quot;H:i:s&quot;) . &quot;\r\n&quot;);
    			$this-&gt;logger(&quot;Type de traitement effectué : &quot; . $traitement . &quot;\r\n&quot;);
    			$this-&gt;logger(&quot;----------------------------------------------\r\n&quot;);
    			return TELNET_OK;
    
    		} else {
    			if ($this-&gt;log){
    				$this-&gt;logger(&quot;----------------------------------------------\r\n&quot;);
    				$this-&gt;logger(&quot;Fin de la log\r\n&quot;);
    
    				fflush($this-&gt;log);
    
    				if (! fclose($this-&gt;log)){
    					$this-&gt;error = &quot;erreur a la fermeture du fichier de log&quot;;
    					return TELNET_ERROR;
    				}
    
    				$this-&gt;log = NULL;
    			}
    
    			return TELNET_OK;
    		}
    	}
    
    	//------------------------------------------------------------------------
    	function logger($s){
    		if ($this-&gt;log){
    			fwrite($this-&gt;log, $s);
    		}
    	}
    
    	//------------------------------------------------------------------------
    	function getDernieresLignes($s, $separateur=&quot;\n&quot;){
    		// une reponse telnet contient (en principe) en premiere ligne l'echo de la commande utilisateur.
    		// cette methode renvoie tout sauf la premiere ligne, afin de ne pas polluer les logs telnet
    
    		$lignes = split(&quot;\n&quot;,$s);
    		$resultat = &quot;&quot;;
    		$premiereLigne = true;
    
    		while(list($key, $data) = each($lignes)){
    			if ($premiereLigne){
    				$premiereLigne = false;
    			} else {
    				if ($data != &quot;&quot;){
    					$resultat .= $data . $separateur;
    				}
    			}
    		}
    
    		$resultat == substr($resultat,strlen($resultat)-1); // enlever le dernier caractere de fin de ligne
    
    		return $resultat;
    	}
    
    	//------------------------------------------------------------------------
    }   //    Fin de la classe
    ?&gt;</p></div>
    ";i:9;s:50075:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    103
    104
    105
    106
    107
    108
    109
    110
    111
    112
    113
    114
    115
    116
    117
    118
    119
    120
    121
    122
    123
    124
    125
    126
    127
    128
    129
    130
    131
    132
    133
    134
    135
    136
    137
    138
    139
    140
    141
    142
    143
    144
    145
    146
    147
    148
    149
    150
    151
    152
    153
    154
    155
    156
    157
    158
    159
    160
    161
    162
    163
    164
    165
    166
    167
    168
    169
    170
    171
    172
    173
    174
    175
    176
    177
    178
    179
    180
    181
    182
    183
    184
    185
    186
    187
    188
    189
    190
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">class</span> db_mysql<span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$query</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$res</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000088;">$num</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$link</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$debug</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$collation</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$collate</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$host</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$user</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$passw</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$db</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$set_force_featch</span><span style="color: #339933;">;</span>
    &nbsp;
        <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span>  __construct <span style="color: #009900;">&#40;</span><span style="color: #000088;">$HOST</span><span style="color: #339933;">,</span><span style="color: #000088;">$USER</span><span style="color: #339933;">,</span><span style="color: #000088;">$PASSW</span><span style="color: #339933;">,</span><span style="color: #000088;">$DB</span><span style="color: #009900;">&#41;</span>
            <span style="color: #009900;">&#123;</span>
                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">set_debug</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">set_force_featch</span><span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">init</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$HOST</span><span style="color: #339933;">,</span><span style="color: #000088;">$USER</span><span style="color: #339933;">,</span><span style="color: #000088;">$PASSW</span><span style="color: #339933;">,</span><span style="color: #000088;">$DB</span><span style="color: #339933;">,</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000000; font-weight: bold;">function</span> __destruct<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    		<span style="color: #009900;">&#123;</span>
    					<span style="color: #339933;">@</span><span style="color: #990000;">mysql_close</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//	    @self::close_db();	    </span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> set_debug<span style="color: #009900;">&#40;</span><span style="color: #000088;">$d</span><span style="color: #009900;">&#41;</span>	<span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">is_bool</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$d</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">=</span><span style="color: #000088;">$d</span><span style="color: #339933;">;</span>
    					<span style="color: #009900;">&#125;</span>
    					<span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    					<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> set_force_featch<span style="color: #009900;">&#40;</span><span style="color: #000088;">$d</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">is_bool</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$d</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>	<span style="color: #009900;">&#123;</span>
    						<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_force_featch</span><span style="color: #339933;">=</span><span style="color: #000088;">$d</span><span style="color: #339933;">;</span>	
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">else</span>	<span style="color: #009900;">&#123;</span>
    						<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_force_featch</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> SET_NAMES<span style="color: #009900;">&#40;</span><span style="color: #000088;">$names</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;utf8&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">collation</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SET NAMES &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$names</span><span style="color: #339933;">;</span>
    			<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">collation</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> SET_COLLATE<span style="color: #009900;">&#40;</span><span style="color: #000088;">$names</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;utf8_general_ci&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">collate</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SET COLLATE &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$names</span><span style="color: #339933;">;</span>
    			<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">collation</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span>  init<span style="color: #009900;">&#40;</span><span style="color: #000088;">$HOST</span><span style="color: #339933;">,</span><span style="color: #000088;">$USER</span><span style="color: #339933;">,</span><span style="color: #000088;">$PASSW</span><span style="color: #339933;">,</span><span style="color: #000088;">$DB</span><span style="color: #339933;">,</span><span style="color: #000088;">$init_collation_setup</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	        	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #990000;">is_bool</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$init_collation_setup</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>	<span style="color: #009900;">&#123;</span>
    						<span style="color: #000088;">$init_collation_setup</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>	
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">set_host</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$HOST</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">set_user</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$USER</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">set_passw</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$PASSW</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">set_db</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$DB</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_connect</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">user</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">passw</span><span style="color: #009900;">&#41;</span>or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    		<span style="color: #339933;">@</span><span style="color: #990000;">mysql_select_db</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #009900;">&#125;</span>
                    <span style="color: #b1b100;">else</span>
                    <span style="color: #009900;">&#123;</span>
                    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_connect</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">user</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">passw</span><span style="color: #009900;">&#41;</span>or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    	<span style="color: #990000;">mysql_select_db</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$init_collation_setup</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">collation</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
            <span style="color: #009900;">&#125;</span>
    &nbsp;
            <span style="color: #000000; font-weight: bold;">function</span> connect<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">NULL</span><span style="color: #339933;">;</span>
                    <span style="color: #666666; font-style: italic;">//$this-&gt;ar=array();</span>
    &nbsp;
                    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_connect</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">user</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">passw</span><span style="color: #009900;">&#41;</span>or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    		<span style="color: #339933;">@</span><span style="color: #990000;">mysql_select_db</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #009900;">&#125;</span>
                    <span style="color: #b1b100;">else</span>
                    <span style="color: #009900;">&#123;</span>
                    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #339933;">=</span><span style="color: #990000;">mysql_connect</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">user</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">passw</span><span style="color: #009900;">&#41;</span>or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    	<span style="color: #990000;">mysql_select_db</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #009900;">&#125;</span>
    &nbsp;
            <span style="color: #009900;">&#125;</span>
    &nbsp;
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> set_host<span style="color: #009900;">&#40;</span><span style="color: #000088;">$host</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">host</span><span style="color: #339933;">=</span><span style="color: #000088;">$host</span><span style="color: #339933;">;</span>	<span style="color: #009900;">&#125;</span>
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> set_user<span style="color: #009900;">&#40;</span><span style="color: #000088;">$user</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">user</span><span style="color: #339933;">=</span><span style="color: #000088;">$user</span><span style="color: #339933;">;</span>	<span style="color: #009900;">&#125;</span>
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> set_passw<span style="color: #009900;">&#40;</span><span style="color: #000088;">$passw</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">passw</span><span style="color: #339933;">=</span><span style="color: #000088;">$passw</span><span style="color: #339933;">;</span>	<span style="color: #009900;">&#125;</span>
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> set_db<span style="color: #009900;">&#40;</span><span style="color: #000088;">$db</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">=</span><span style="color: #000088;">$db</span><span style="color: #339933;">;</span>	<span style="color: #009900;">&#125;</span>
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span>  query<span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_force_featch</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span>
            	<span style="color: #009900;">&#123;</span>
            		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_db_query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$q</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            	<span style="color: #009900;">&#125;</span>
            	<span style="color: #b1b100;">else</span>
            	<span style="color: #009900;">&#123;</span>
    	        		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		        				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_db_query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$q</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    	        		<span style="color: #009900;">&#125;</span>
    	        		<span style="color: #b1b100;">else</span>
    	        		<span style="color: #009900;">&#123;</span>
    		        			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #339933;">=</span><span style="color: #990000;">mysql_db_query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$q</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	        		<span style="color: #009900;">&#125;</span>
            	<span style="color: #009900;">&#125;</span>
    &nbsp;
            <span style="color: #009900;">&#125;</span>
    &nbsp;
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> num_rows<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                 	   <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num</span><span style="color: #339933;">=</span><span style="color: #990000;">mysql_num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    	<span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span>  fetch_row<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		        <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_force_featch</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span>
    		        	<span style="color: #009900;">&#123;</span>
    		        		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_fetch_row</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		        	<span style="color: #009900;">&#125;</span>
    		        	<span style="color: #b1b100;">else</span>
    		        	<span style="color: #009900;">&#123;</span>
    			        		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				        				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_fetch_row</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR4<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    			        		<span style="color: #009900;">&#125;</span>
    			        		<span style="color: #b1b100;">else</span>
    			        		<span style="color: #009900;">&#123;</span>
    				        			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">=</span><span style="color: #990000;">mysql_fetch_row</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			        		<span style="color: #009900;">&#125;</span>
    		        	<span style="color: #009900;">&#125;</span>
                    <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span>  fetch_array<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    &nbsp;
            		   <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">set_force_featch</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span>
    		        	<span style="color: #009900;">&#123;</span>
    		        		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">=</span><span style="color: #990000;">mysql_fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		        	<span style="color: #009900;">&#125;</span>
    		        	<span style="color: #b1b100;">else</span>
    		        	<span style="color: #009900;">&#123;</span>
    			        		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">=@</span><span style="color: #990000;">mysql_fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR5<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    			        		<span style="color: #009900;">&#125;</span>
    			        		<span style="color: #b1b100;">else</span>
    			        		<span style="color: #009900;">&#123;</span>
    				        			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">=</span><span style="color: #990000;">mysql_fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			        		<span style="color: #009900;">&#125;</span>
    		        	<span style="color: #009900;">&#125;</span>
                    <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
    &nbsp;
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> db_select<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
            <span style="color: #009900;">&#123;</span>
                        		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #339933;">@</span><span style="color: #990000;">mysql_select_db</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    			        		<span style="color: #009900;">&#125;</span>
    			        		<span style="color: #b1b100;">else</span>
    			        		<span style="color: #009900;">&#123;</span>
    				        			<span style="color: #990000;">mysql_select_db</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span> or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			        		<span style="color: #009900;">&#125;</span>
            <span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> free_result<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    	<span style="color: #009900;">&#123;</span>
    		<span style="color: #990000;">mysql_free_result</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">res</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> <span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> close_db<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    	<span style="color: #009900;">&#123;</span>
            <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #339933;">@</span><span style="color: #990000;">mysql_close</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span>or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span>ERR6<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">else</span>
    		<span style="color: #009900;">&#123;</span>
    					<span style="color: #990000;">mysql_close</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">link</span><span style="color: #009900;">&#41;</span>or <span style="color: #990000;">die</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    <span style="color: #009900;">&#125;</span>
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php
    
    class db_mysql{
        protected $query;
    	protected $res;
        public $num;
        protected $link;
        protected $debug;
        protected $collation;
        protected $collate;
        protected $host;
        protected $user;
        protected $passw;
        protected $db;
        protected $set_force_featch;
            
        public function  __construct ($HOST,$USER,$PASSW,$DB)
            {
                    $this-&gt;query=NULL;
                    self::set_debug(false);
                    self::set_force_featch(true);
                    self::init($HOST,$USER,$PASSW,$DB,false);
            }
    
    		function __destruct()
    		{
    					@mysql_close($this-&gt;link); //	    @self::close_db();	    
    		}
    		
    		public function set_debug($d)	{
    					if(is_bool($d)){
    						$this-&gt;debug=$d;
    					}
    					else{
    						$this-&gt;debug=false;
    					}
    		}
    				
    		public function set_force_featch($d){
    				if(is_bool($d))	{
    						$this-&gt;set_force_featch=$d;	
    				}
    				else	{
    						$this-&gt;set_force_featch=true;
    				}
    		}
    						
    		public function SET_NAMES($names=&quot;utf8&quot;){
    			$this-&gt;collation=&quot;SET NAMES &quot;.$names;
    			self::query($this-&gt;collation);
    		}
    
    		public function SET_COLLATE($names=&quot;utf8_general_ci&quot;){
    			$this-&gt;collate=&quot;SET COLLATE &quot;.$names;
    			self::query($this-&gt;collation);
    		}
            public function  init($HOST,$USER,$PASSW,$DB,$init_collation_setup=false){
    	        	if(!is_bool($init_collation_setup))	{
    						$init_collation_setup=false;	
    				}
    				self::set_host($HOST);
                    self::set_user($USER);
                    self::set_passw($PASSW);
                    self::set_db($DB);
                    $this-&gt;query=NULL;
                    if($this-&gt;debug==false){
                    		$this-&gt;link=@mysql_connect($this-&gt;host,$this-&gt;user, $this-&gt;passw)or die(ERR1);
                    		@mysql_select_db($this-&gt;db,$this-&gt;link) or die(ERR2);
                    }
                    else
                    {
                    	$this-&gt;link=@mysql_connect($this-&gt;host,$this-&gt;user, $this-&gt;passw)or die(mysql_error());
                    	mysql_select_db($this-&gt;db,$this-&gt;link) or die(mysql_error());
                    }
                    
    				if($init_collation_setup==true){
    						self::query($this-&gt;collation);
    				}
            }
    
            function connect(){
                    $this-&gt;query=NULL;
                    //$this-&gt;ar=array();
                                    
                    if($this-&gt;debug==false){
                    		$this-&gt;link=@mysql_connect($this-&gt;host,$this-&gt;user, $this-&gt;passw)or die(ERR1);
                    		@mysql_select_db($this-&gt;db,$this-&gt;link) or die(ERR2);
                    }
                    else
                    {
                    	$this-&gt;link=mysql_connect($this-&gt;host,$this-&gt;user, $this-&gt;passw)or die(mysql_error());
                    	mysql_select_db($this-&gt;db,$this-&gt;link) or die(mysql_error());
                    }
    
            }
    
            public function set_host($host){	$this-&gt;host=$host;	}
            public function set_user($user){	$this-&gt;user=$user;	}
            public function set_passw($passw){	$this-&gt;passw=$passw;	}
            public function set_db($db){	$this-&gt;db=$db;	}
            public function  query($q){
            	if($this-&gt;set_force_featch==true)
            	{
            		$this-&gt;query=@mysql_db_query($this-&gt;db,$q,$this-&gt;link);
            	}
            	else
            	{
    	        		if($this-&gt;debug==false){
    		        				$this-&gt;query=@mysql_db_query($this-&gt;db,$q,$this-&gt;link) or die(ERR3);	
    	        		}
    	        		else
    	        		{
    		        			$this-&gt;query=mysql_db_query($this-&gt;db,$q,$this-&gt;link) or die(mysql_error());
    	        		}
            	}
                    
            }
            
            public function num_rows(){
                 	   $this-&gt;num=mysql_num_rows($this-&gt;query);
                    	return $this-&gt;num;
            }
            public function  fetch_row(){
    		        if($this-&gt;set_force_featch==true)
    		        	{
    		        		$this-&gt;res=@mysql_fetch_row($this-&gt;query);
    		        	}
    		        	else
    		        	{
    			        		if($this-&gt;debug==false){
    				        				$this-&gt;res=@mysql_fetch_row($this-&gt;query) or die(ERR4);	
    			        		}
    			        		else
    			        		{
    				        			$this-&gt;res=mysql_fetch_row($this-&gt;query) or die(mysql_error());
    			        		}
    		        	}
                    return $this-&gt;res;
            }
            public function  fetch_array(){
            	
            	
            		   if($this-&gt;set_force_featch==true)
    		        	{
    		        		$this-&gt;res=mysql_fetch_array($this-&gt;query);
    		        	}
    		        	else
    		        	{
    			        		if($this-&gt;debug==false){
    									$this-&gt;res=@mysql_fetch_array($this-&gt;query) or die(ERR5);	
    			        		}
    			        		else
    			        		{
    				        			$this-&gt;res=mysql_fetch_array($this-&gt;query) or die(mysql_error());
    			        		}
    		        	}
                    return $this-&gt;res;
            }
    
            public function db_select()
            {
                        		if($this-&gt;debug==false){
    									@mysql_select_db($this-&gt;db,$this-&gt;link) or die(ERR2);	
    			        		}
    			        		else
    			        		{
    				        			mysql_select_db($this-&gt;db,$this-&gt;link) or die(mysql_error());
    			        		}
            }
    	public function free_result()
    	{
    		mysql_free_result($this-&gt;res);
    	}
    	public function mysql_error(){
    		return mysql_error($this-&gt;link);
    	}
    
    	public function close_db()
    	{
            if($this-&gt;debug==false){
    					@mysql_close($this-&gt;link)or die(ERR6);	
    		}
    		else
    		{
    					mysql_close($this-&gt;link)or die(mysql_error());
    		}
    	}
    
    }
    ?&gt;</p></div>
    ";i:10;s:234765:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31
    32
    33
    34
    35
    36
    37
    38
    39
    40
    41
    42
    43
    44
    45
    46
    47
    48
    49
    50
    51
    52
    53
    54
    55
    56
    57
    58
    59
    60
    61
    62
    63
    64
    65
    66
    67
    68
    69
    70
    71
    72
    73
    74
    75
    76
    77
    78
    79
    80
    81
    82
    83
    84
    85
    86
    87
    88
    89
    90
    91
    92
    93
    94
    95
    96
    97
    98
    99
    100
    101
    102
    103
    104
    105
    106
    107
    108
    109
    110
    111
    112
    113
    114
    115
    116
    117
    118
    119
    120
    121
    122
    123
    124
    125
    126
    127
    128
    129
    130
    131
    132
    133
    134
    135
    136
    137
    138
    139
    140
    141
    142
    143
    144
    145
    146
    147
    148
    149
    150
    151
    152
    153
    154
    155
    156
    157
    158
    159
    160
    161
    162
    163
    164
    165
    166
    167
    168
    169
    170
    171
    172
    173
    174
    175
    176
    177
    178
    179
    180
    181
    182
    183
    184
    185
    186
    187
    188
    189
    190
    191
    192
    193
    194
    195
    196
    197
    198
    199
    200
    201
    202
    203
    204
    205
    206
    207
    208
    209
    210
    211
    212
    213
    214
    215
    216
    217
    218
    219
    220
    221
    222
    223
    224
    225
    226
    227
    228
    229
    230
    231
    232
    233
    234
    235
    236
    237
    238
    239
    240
    241
    242
    243
    244
    245
    246
    247
    248
    249
    250
    251
    252
    253
    254
    255
    256
    257
    258
    259
    260
    261
    262
    263
    264
    265
    266
    267
    268
    269
    270
    271
    272
    273
    274
    275
    276
    277
    278
    279
    280
    281
    282
    283
    284
    285
    286
    287
    288
    289
    290
    291
    292
    293
    294
    295
    296
    297
    298
    299
    300
    301
    302
    303
    304
    305
    306
    307
    308
    309
    310
    311
    312
    313
    314
    315
    316
    317
    318
    319
    320
    321
    322
    323
    324
    325
    326
    327
    328
    329
    330
    331
    332
    333
    334
    335
    336
    337
    338
    339
    340
    341
    342
    343
    344
    345
    346
    347
    348
    349
    350
    351
    352
    353
    354
    355
    356
    357
    358
    359
    360
    361
    362
    363
    364
    365
    366
    367
    368
    369
    370
    371
    372
    373
    374
    375
    376
    377
    378
    379
    380
    381
    382
    383
    384
    385
    386
    387
    388
    389
    390
    391
    392
    393
    394
    395
    396
    397
    398
    399
    400
    401
    402
    403
    404
    405
    406
    407
    408
    409
    410
    411
    412
    413
    414
    415
    416
    417
    418
    419
    420
    421
    422
    423
    424
    425
    426
    427
    428
    429
    430
    431
    432
    433
    434
    435
    436
    437
    438
    439
    440
    441
    442
    443
    444
    445
    446
    447
    448
    449
    450
    451
    452
    453
    454
    455
    456
    457
    458
    459
    460
    461
    462
    463
    464
    465
    466
    467
    468
    469
    470
    471
    472
    473
    474
    475
    476
    477
    478
    479
    480
    481
    482
    483
    484
    485
    486
    487
    488
    489
    490
    491
    492
    493
    494
    495
    496
    497
    498
    499
    500
    501
    502
    503
    504
    505
    506
    507
    508
    509
    510
    511
    512
    513
    514
    515
    516
    517
    518
    519
    520
    521
    522
    523
    524
    525
    526
    527
    528
    529
    530
    531
    532
    533
    534
    535
    536
    537
    538
    539
    540
    541
    542
    543
    544
    545
    546
    547
    548
    549
    550
    551
    552
    553
    554
    555
    556
    557
    558
    559
    560
    561
    562
    563
    564
    565
    566
    567
    568
    569
    570
    571
    572
    573
    574
    575
    576
    577
    578
    579
    580
    581
    582
    583
    584
    585
    586
    587
    588
    589
    590
    591
    592
    593
    594
    595
    596
    597
    598
    599
    600
    601
    602
    603
    604
    605
    606
    607
    608
    609
    610
    611
    612
    613
    614
    615
    616
    617
    618
    619
    620
    621
    622
    623
    624
    625
    626
    627
    628
    629
    630
    631
    632
    633
    634
    635
    636
    637
    638
    639
    640
    641
    642
    643
    644
    645
    646
    647
    648
    649
    650
    651
    652
    653
    654
    655
    656
    657
    658
    659
    660
    661
    662
    663
    664
    665
    666
    667
    668
    669
    670
    671
    672
    673
    674
    675
    676
    677
    678
    679
    680
    681
    682
    683
    684
    685
    686
    687
    688
    689
    690
    691
    692
    693
    694
    695
    696
    697
    698
    699
    700
    701
    702
    703
    704
    705
    706
    707
    708
    709
    710
    711
    712
    713
    714
    715
    716
    717
    718
    719
    720
    721
    722
    723
    724
    725
    726
    727
    728
    729
    730
    731
    732
    733
    734
    735
    736
    737
    738
    739
    740
    741
    742
    743
    744
    745
    746
    747
    748
    749
    750
    751
    752
    753
    754
    755
    756
    757
    758
    759
    760
    761
    762
    763
    764
    765
    766
    767
    768
    769
    770
    771
    772
    773
    774
    775
    776
    777
    778
    779
    780
    781
    782
    783
    784
    785
    786
    787
    788
    789
    790
    791
    792
    793
    794
    795
    796
    797
    798
    799
    800
    801
    802
    803
    804
    805
    806
    807
    808
    809
    810
    811
    812
    813
    814
    815
    816
    817
    818
    819
    820
    821
    822
    823
    824
    825
    826
    827
    828
    829
    830
    831
    832
    833
    834
    835
    836
    837
    838
    839
    840
    841
    842
    843
    844
    845
    846
    847
    848
    849
    850
    851
    852
    853
    854
    855
    856
    857
    858
    859
    860
    861
    862
    863
    864
    865
    866
    867
    868
    869
    870
    871
    872
    873
    874
    875
    876
    877
    878
    879
    880
    881
    882
    883
    884
    885
    886
    887
    888
    889
    890
    891
    892
    893
    894
    895
    896
    897
    898
    899
    900
    901
    902
    903
    904
    905
    906
    907
    908
    909
    910
    911
    912
    913
    914
    915
    916
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span> 
    <span style="color: #000000; font-weight: bold;">class</span> page<span style="color: #009900;">&#123;</span>
    	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$db</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$db_nibs</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$telnet</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$result_telnet_connect</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000088;">$sw_type</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> __construct <span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$db</span><span style="color: #339933;">,&amp;</span><span style="color: #000088;">$db_nibs</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">=&amp;</span><span style="color: #000088;">$db</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">=&amp;</span><span style="color: #000088;">$db_nibs</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> top<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 
    			<span style="color: #339933;">@</span><span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;pages/top.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> bottom<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 
    			<span style="color: #339933;">@</span><span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;pages/bottom.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> telnet_disconnect<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">Disconnect</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> telnet<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$login</span><span style="color: #339933;">,</span><span style="color: #000088;">$pass</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> PHPTelnet<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">show_connect_error</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #666666; font-style: italic;">// if the first argument to Connect is blank,</span>
    		<span style="color: #666666; font-style: italic;">// PHPTelnet will connect to the local host via 127.0.0.1</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">Connect</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$login</span><span style="color: #339933;">,</span><span style="color: #000088;">$pass</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">:</span>
    		<span style="color: #666666; font-style: italic;">//$this-&gt;telnet-&gt;DoCommand('enter command here', $result);</span>
    		<span style="color: #666666; font-style: italic;">// NOTE: $result may contain newlines</span>
    		<span style="color: #666666; font-style: italic;">//echo $result;</span>
    		<span style="color: #666666; font-style: italic;">//$this-&gt;telnet-&gt;DoCommand('another command', $result);</span>
    		<span style="color: #666666; font-style: italic;">//echo $result;</span>
    		<span style="color: #666666; font-style: italic;">// say Disconnect(0); to break the connection without explicitly logging out</span>
    &nbsp;
    			<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">:</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'[PHP Telnet] Connect failed: Unable to open network connection'</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">:</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'[PHP Telnet] Connect failed: Unknown host'</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">3</span><span style="color: #339933;">:</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'[PHP Telnet] Connect failed: Login failed'</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">case</span> <span style="color: #cc66cc;">4</span><span style="color: #339933;">:</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'[PHP Telnet] Connect failed: Your PHP version does not support PHP Telnet'</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> initial_config_sw<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> initial_extreme_config_sw<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #666666; font-style: italic;">//delete vlan Mac</span>
    &nbsp;
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> save_current_sw_config<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> save_extreme_current_sw_config<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;save&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;yes&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;
    &quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #666666; font-style: italic;">/* $ports_tagged=1,2,3,4,5.... */</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> create_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_tagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_untagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$debug</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">switch</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">sw_type</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;dlink&quot;</span><span style="color: #339933;">:</span>
    			<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;dell&quot;</span><span style="color: #339933;">:</span>
    			<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;extreme&quot;</span><span style="color: #339933;">:</span>
    				<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">create_extreem_vlan</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_tagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_untagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$debug</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> create_extreem_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_tagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_untagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$debug</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;create vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;configure vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span> tag <span style="color: #006699; font-weight: bold;">$vlanid</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;configure vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span> add ports  <span style="color: #006699; font-weight: bold;">$ports_tagged</span> tagged<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;configure vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span> add ports  <span style="color: #006699; font-weight: bold;">$ports_untagged</span> untagged<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;create vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #666666; font-style: italic;">//create vlan vlan$vlanid</span>
    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;configure vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span> tag <span style="color: #006699; font-weight: bold;">$vlanid</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;configure vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span> add ports  <span style="color: #006699; font-weight: bold;">$ports_tagged</span> tagged&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #666666; font-style: italic;">//configure vlan vlan$vlanid add ports  $ports_tagged tagged</span>
    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;configure vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span> add ports  <span style="color: #006699; font-weight: bold;">$ports_untagged</span> untagged&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #666666; font-style: italic;">//configure vlan vlan$vlanid add ports  $ports_untagged untagged</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> create_dell_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_tagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_untagged</span><span style="color: #339933;">,</span><span style="color: #000088;">$debug</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;configure<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;vlan database<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;vlan <span style="color: #006699; font-weight: bold;">$vlanid</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;exit<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    &nbsp;
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #666666; font-style: italic;">/*$this-&gt;telnet-&gt;DoCommand(&quot;configure&quot;, $this-&gt;result_telnet_connect);
    	$this-&gt;telnet-&gt;DoCommand(&quot;vlan database&quot;, $this-&gt;result_telnet_connect);
    	$this-&gt;telnet-&gt;DoCommand(&quot;vlan $vlanid&quot;, $this-&gt;result_telnet_connect);
    	$this-&gt;telnet-&gt;DoCommand(&quot;exit&quot;, $this-&gt;result_telnet_connect);
    	*/</span>
    	 <span style="color: #000088;">$script</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> telnet<span style="color: #339933;">;</span> 
    &nbsp;
    	<span style="color: #000088;">$ar_of_ports_tagged</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$ports_tagged</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #000088;">$c</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ar_of_ports_tagged</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$port</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">is_numeric</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$port</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&amp;&amp;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$port</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
    					<span style="color: #000088;">$port_line</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;1/e&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$port</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">else</span>
    					<span style="color: #000088;">$port_line</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;,1/e&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$port</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$c</span><span style="color: #339933;">++;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #666666; font-style: italic;">//exist any ports</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    			<span style="color: #666666; font-style: italic;">//$this-&gt;telnet-&gt;DoCommand(&quot;interface range ethernet $port_line&quot;, $this-&gt;result_telnet_connect);</span>
    			<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;switchport access vlan <span style="color: #006699; font-weight: bold;">$vlanid</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> delete_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> delete_extreme_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$debug</span><span style="color: #339933;">=</span><span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$debug</span><span style="color: #339933;">==</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;delete vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">telnet</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">DoCommand</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;delete vlan vlan<span style="color: #006699; font-weight: bold;">$vlanid</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">result_telnet_connect</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #009900;">&#125;</span>	
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> remove_port_from_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$port_remove</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> remove_extreme_port_from_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$port_remove</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #666666; font-style: italic;">//configure vlan vlan$vlanid delete ports  $port_remove</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> add_port_to_vlan<span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlanid</span><span style="color: #339933;">,</span><span style="color: #000088;">$port</span><span style="color: #339933;">,</span><span style="color: #000088;">$type</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">switch</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$type</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;T&quot;</span><span style="color: #339933;">:</span>
    			<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;U&quot;</span><span style="color: #339933;">:</span>
    			<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> scan_sw_by_ip<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
       			    <span style="color: #000088;">$type</span><span style="color: #339933;">=</span>unknown<span style="color: #339933;">;</span>
    				<span style="color: #000088;">$version</span><span style="color: #339933;">=</span>no_version<span style="color: #339933;">;</span>
    				<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">=</span>COMUNITY_READ<span style="color: #339933;">;</span>	
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;snmpwalk(&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$ip</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">.</span>OID_sysDescr<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;)&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$result</span><span style="color: #339933;">=</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_sysDescr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">=</span>COMUNITY_DEF_DLINK_READ<span style="color: #339933;">;</span>
    				<span style="color: #666666; font-style: italic;">//session.version = SNMP_VERSION_2c;</span>
    				<span style="color: #000088;">$result</span><span style="color: #339933;">=</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_sysDescr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">=</span>COMUNITY_READ2<span style="color: #339933;">;</span>
    				<span style="color: #000088;">$result</span><span style="color: #339933;">=</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_sysDescr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$type</span><span style="color: #339933;">=</span>PAGE_MES_1<span style="color: #339933;">;</span>
    					<span style="color: #000088;">$version</span><span style="color: #339933;">=</span>no_version<span style="color: #339933;">;</span>
    					<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">return</span> <span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;version&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$version</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;type&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$type</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$ports</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$result</span><span style="color: #339933;">=</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    					<span style="color: #666666; font-style: italic;">//echo print_r($result);</span>
    					<span style="color: #666666; font-style: italic;">/* OID  ????????? ????????, ?? ??????? ??????:
    					* dlink : D-Link DES-3026 Fast Ethernet Switch
    					* dell :  Ethernet Stackable Switching System  
    						PowerConnect 3348 
    									?????=&gt;&quot;OID_DELL_sysDescr&quot; 
    					* extreem : Summit200-48 - Version 7.3e.2 (Build 4) by Release_Master 02/24/05 19:20:09 
    					* SMC: SMC Networks SMC8624T 1
    					* */</span>
    					<span style="color: #000088;">$dlink_oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bD-Link\b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$dlink_oid_pattern2</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bDLink\b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$dlink_oid_pattern3</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bDES\b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$extreem_oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bSummit/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$smc_oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bSMC/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$dell_oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bStackable\b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$dell__oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bEthernet\b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$dell2_oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bPowerConnect\b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$dell_ports_24_patern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\d\d24/&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$dell_ports_48_patern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\d\d48/&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$cisco_oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bcisco\b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$cisco2_oid_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bCISCO \b/i&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$netgear_FSM_pattern</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/\bFSM/i&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #009900;">&#40;</span> <span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dlink_oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dlink_oid_pattern2</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dlink_oid_pattern3</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$type</span><span style="color: #339933;">=</span>dlink<span style="color: #339933;">;</span>
    					<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #000088;">$result</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$result</span><span style="color: #339933;">=@</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_standart_ports<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    						<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/3026/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/3028/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/3528/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/3526/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/3026/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/3016/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/3010/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$extreem_oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$type</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;extreem&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #000088;">$result</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$result</span><span style="color: #339933;">=@</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_standart_ports<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$netgear_FSM_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$type</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;netgear&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #990000;">str_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Stackable Switch&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>					
    					<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/FSM7328S/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/FSM7352S/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$cisco_oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$cisco2_oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$type</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;cisco&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #000088;">$result</span><span style="color: #339933;">;</span>
    					<span style="color: #666666; font-style: italic;">//$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_standart_ports);</span>
    					<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    						<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/C3500/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    							<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;Cisco C3500XL&quot;</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">else</span> <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/WS-C2948/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                                                             <span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
                                                             <span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;Cisco WS-C2948&quot;</span><span style="color: #339933;">;</span>
                                                     <span style="color: #009900;">&#125;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$smc_oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$type</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SMC&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #000088;">$result</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    						<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/8624/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dell_oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">||</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dell__oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$result</span><span style="color: #339933;">=@</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_DELL_enterprises<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    						<span style="color: #000088;">$type</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;dell_un&quot;</span><span style="color: #339933;">;</span>
    						<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #000088;">$result</span><span style="color: #339933;">;</span>
    						<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    						<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dell2_oid_pattern</span><span style="color: #339933;">,</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    							<span style="color: #000088;">$version</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;Dell &quot;</span><span style="color: #339933;">.</span><span style="color: #990000;">str_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$type</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;dell&quot;</span><span style="color: #339933;">;</span>
    							<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dell_ports_48_patern</span><span style="color: #339933;">,</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    								<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    							<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">elseif</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dell_ports_24_patern</span><span style="color: #339933;">,</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    								<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">24</span><span style="color: #339933;">;</span>
    							<span style="color: #009900;">&#125;</span>
    							<span style="color: #000088;">$arr</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    							<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    						<span style="color: #009900;">&#125;</span>
    					<span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;type <span style="color: #006699; font-weight: bold;">$type</span> <span style="color: #000099; font-weight: bold;">\&quot;</span>ports<span style="color: #000099; font-weight: bold;">\&quot;</span>=&gt;<span style="color: #006699; font-weight: bold;">$ports</span>,<span style="color: #000099; font-weight: bold;">\&quot;</span>ip<span style="color: #000099; font-weight: bold;">\&quot;</span>=&gt;<span style="color: #006699; font-weight: bold;">$ip</span>)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">return</span> <span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;version&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #990000;">str_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;STRING:&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;type&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$type</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$ports</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> arpwatch_macs<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;DELETE FROM  `freenibs`  WHERE `user` LIKE '10.%'&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;DELETE FROM 
    				`arpwatch`
    				WHERE `date` &lt; FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -604000 )&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT *
    			FROM `arpwatch` ORDER BY `date&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$mac</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'arp'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;INSERT INTO `freenibs` (
    						`mac` ,
    						`user` ,
    						`deposit`
    						)
    						VALUES (
    						'&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #990000;">strtolower</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$mac</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;','&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', '-2048'
    						)
    						 ON DUPLICATE KEY UPDATE
    						`user`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'
    					;&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    	   <span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> clear_<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 	
    	<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;DELETE FROM `mac` WHERE `date` &lt; FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -86400 )
    		AND `mac` NOT
    		IN (
    &nbsp;
    		SELECT `mac`
    		FROM `freenibs`
    		)&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;DELETE FROM `mac` WHERE `date` &lt; FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -259200 )
    		AND `mac` 
    		IN (
    &nbsp;
    		SELECT `mac`
    		FROM `freenibs`
    		)&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> cron <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">clear_</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">arpwatch_macs</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">users_macs</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$field_to_select</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT 
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$field_to_select</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    			FROM `sw`
    				  ORDER BY `id`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #666666; font-style: italic;">//echo $q;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$query</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'#!/bin/sh'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$zzz</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$zzz</span><span style="color: #339933;">++;</span>	
    				<span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;/usr/bin/php -q /var/www/skmsw/cron_one_ip.php &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot; &gt;&gt;/dev/null &amp;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #990000;">passthru</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/usr/bin/php -q /var/www/skmsw/cron_one_ip.php &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot; &gt;&gt;/dev/null &amp;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>zzz<span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> <span style="color: #990000;">sleep</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$zzz</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #000088;">$dis</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">clear_disallow</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> cron_one_ip<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;clear_disallow_ip(<span style="color: #006699; font-weight: bold;">$ip</span>)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$dis</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">clear_disallow_ip</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot; done clear_disallow_ip(<span style="color: #006699; font-weight: bold;">$ip</span>)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;scan_by_ip_switch(<span style="color: #006699; font-weight: bold;">$dis</span>,<span style="color: #006699; font-weight: bold;">$ip</span>);<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">scan_by_ip_switch</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$dis</span><span style="color: #339933;">,</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot; done scan&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #666666; font-style: italic;">//$dis=self::clear_disallow();</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> clear_disallow_ip<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT 
    				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
    			FROM `sw`
    			WHERE `ip`=INET_ATON('&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$ip</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;')&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">else</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT 
    				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
    			FROM `sw`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #666666; font-style: italic;">//echo $q.&quot;\n&quot;;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				 <span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    					 <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
    						 <span style="color: #000088;">$disallow</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    						 <span style="color: #000088;">$dis</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$disallow</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$id</span><span style="color: #339933;">=</span><span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$p</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$p</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$port_val</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;DELETE FROM `mac` WHERE `sw_id` = '&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$id</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;' AND `port`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$port_val</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #666666; font-style: italic;">//echo $q.&quot;\n&quot;;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$dis</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> clear_disallow<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT 
    				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
    			FROM `sw`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #666666; font-style: italic;">//echo $n.&quot;\n&quot;;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				 <span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    					 <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
    						 <span style="color: #000088;">$disallow</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    						 <span style="color: #000088;">$dis</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$disallow</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$id</span><span style="color: #339933;">=</span><span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$p</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$disallow_array</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$p</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$port_val</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;DELETE FROM `mac` WHERE `sw_id` = '&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$id</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;' AND `port`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$port_val</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #666666; font-style: italic;">//echo $q.&quot;\n&quot;;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$dis</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> users_macs<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>	
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT `actions`.`call_from`,`actions`.`user`,`users`.`uid`,`users`.`deposit`,`users`.`credit`
    			FROM `actions`, `users`
    			WHERE 
    				`actions`.`call_from` LIKE '%:%'
    			AND	
    				`users`.`user`=`actions`.`user`
    				AND
    				 	`start_time`&gt;FROM_UNIXTIME(UNIX_TIMESTAMP(NOW() )-90000)
    			GROUP BY `actions`.`call_from`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			 <span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$m</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'call_from'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//10.200.30.16 / 00:1d:92:f7:46:60 / vlan51</span>
    			<span style="color: #000088;">$mac</span><span style="color: #339933;">=</span><span style="color: #990000;">strtolower</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">trim</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$m</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$user</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'user'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$uid</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'uid'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$deposit</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'deposit'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'credit'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;INSERT INTO  `freenibs` (
    					`mac` ,
    					`user`,
    					`uid`,
    					`deposit`
    					)
    					VALUES (
    					'&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$mac</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', '&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$user</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;','&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$uid</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;','&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$deposit</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'
    					)
    					ON DUPLICATE KEY UPDATE
    					`mac`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$mac</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', `user`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$user</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',`uid`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$uid</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',`deposit`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$deposit</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;';&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT `blocked`,`mac_addr`,`user`,`uid`,`deposit`,`credit` FROM `users` WHERE `mac_addr` LIKE '%:%'&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			 <span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$mac</span><span style="color: #339933;">=</span><span style="color: #990000;">strtolower</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mac_addr'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$user</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'user'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$uid</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'uid'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #000088;">$deposit</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'deposit'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'credit'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			<span style="color: #666666; font-style: italic;">//echo $user.&quot; &quot;.$mac.&quot;\n&quot;;</span>
    			<span style="color: #000088;">$blocked</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'blocked'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    &nbsp;
    			<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;INSERT INTO `freenibs` (
    					`mac` ,
    					`user`,
    					`uid`,
    					`deposit`
    					)
    					VALUES (
    					'&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$mac</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', '&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$user</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;','&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$uid</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;','&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$deposit</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'
    					)
    					ON DUPLICATE KEY UPDATE
    					`en`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$blocked</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',`mac`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$mac</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', `user`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$user</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',`uid`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$uid</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',`deposit`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$deposit</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;';&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	  <span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> user_to_port_sw<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    &nbsp;
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> scan_macs_from_ip<span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$nas_id</span><span style="color: #339933;">,</span><span style="color: #000088;">$dis</span><span style="color: #339933;">,</span><span style="color: #000088;">$type</span><span style="color: #339933;">,</span><span style="color: #000088;">$model</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$disallow</span><span style="color: #339933;">=</span><span style="color: #000088;">$dis</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$p</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$disallow</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">=</span>COMUNITY_READ<span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">==</span><span style="color: #0000ff;">'127.0.0.1'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #666666; font-style: italic;">//трюк для ЦИСКИ, так как ей надо указывать комьюнити в виде community@vlan</span>
    					 <span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;public@25&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #000088;">$result</span><span style="color: #339933;">=</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_sysDescr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">=</span>COMUNITY_DEF_DLINK_READ<span style="color: #339933;">;</span>
    					<span style="color: #000088;">$result</span><span style="color: #339933;">=</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_sysDescr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">=</span>COMUNITY_READ2<span style="color: #339933;">;</span>
    				<span style="color: #000088;">$result</span><span style="color: #339933;">=</span><span style="color: #990000;">snmpwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_sysDescr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;SNMP_COMUNITY_READ <span style="color: #006699; font-weight: bold;">$SNMP_COMUNITY_READ</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">return</span> <span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$type</span><span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;cisco&quot;</span><span style="color: #009900;">&#41;</span>
    						<span style="color: #000088;">$res</span><span style="color: #339933;">=</span><span style="color: #990000;">snmprealwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_cisco_mac_on_ports<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #666666; font-style: italic;">//$res=snmp2_real_walk($ip,$SNMP_COMUNITY_READ,OID_mac_on_ports);</span>
    						<span style="color: #000088;">$res</span><span style="color: #339933;">=</span><span style="color: #990000;">snmprealwalk</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #339933;">,</span><span style="color: #000088;">$SNMP_COMUNITY_READ</span><span style="color: #339933;">,</span>OID_mac_on_ports<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    						<span style="color: #666666; font-style: italic;">//print_r($res);</span>
    					<span style="color: #009900;">&#125;</span>
    &nbsp;
    					<span style="color: #666666; font-style: italic;">/*  old cisco
    					 $res=snmprealwalk($ip,&quot;public@54&quot;,&quot;.1.3.6.1.2.1.17.4.3.1.2&quot;);
                                             foreach ($res as $ind=&gt;$port){
                                                 $arr=explode('.',$ind);
                                                    $c=count($arr);
                                                     $port=explode(':',$port);
                                                     $port_temp=$port;
                                                     $port=(int)$port[1];
                                             if($ip=='172.16.2.26'){
                                                    $port=$cisco_rp[$port];
                                              }
    &nbsp;
                                              $mc=dec_hex($arr[$c-6]).':'.dec_hex($arr[$c-5]).':'.dec_hex($arr[$c-4]).':'.dec_hex($arr[$c-3]).':'.dec_hex($arr[$c-2]).':'.dec_hex($arr[$c-1]);
                                                     $mac=strtolower($mc);
                                                 $main[$mac]=$port;
                                                 echo $mac.&quot; - $port - $port_t[0]--.1.3.6.1.2.1.17.1.4.1.2.&quot;.$port.&quot;\n&quot;;
                                             }
    					*/</span>
    &nbsp;
    					<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$main</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$mac</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$port</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">in_array</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$port</span><span style="color: #339933;">,</span><span style="color: #000088;">$p</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					    <span style="color: #000088;">$query</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;
    					     INSERT INTO `mac` (
    &nbsp;
    							`mac` ,
    							`sw_id`,
    							`port`,
    							`date`
    							)
    							VALUES (
    							'&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$mac</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;' , '&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$nas_id</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', '&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$port</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',NOW()
    							)
    							ON DUPLICATE KEY UPDATE
    							`mac`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$mac</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;' , 
    							`sw_id`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$nas_id</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', 
    							`port`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$port</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',
    							`date`=NOW();&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    					    <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    					<span style="color: #009900;">&#125;</span>
    					<span style="color: #009900;">&#125;</span>
    &nbsp;
    				<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> scan_all_switches<span style="color: #009900;">&#40;</span><span style="color: #000088;">$dis</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$field_to_select</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT 
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$field_to_select</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    			FROM `sw`
    				  ORDER BY `id`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=@</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$query</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$sw</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">scan_sw_by_ip</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$dis</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$switches</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span>
    						<span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;type&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;model&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'model'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;disallow_ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'disallow_ports'</span><span style="color: #009900;">&#93;</span>
    						<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;process &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$sw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">!=</span><span style="color: #0000ff;">&quot;unknown&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$q1</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;UPDATE
    					`sw`	SET
    							`type`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',  
    							`model`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', 
    							`ports`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'
    					WHERE
    						`id`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$query</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;d&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$q</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;u&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$q1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span>
    			<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$qw</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$qw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'u'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    			<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$switches</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$switch</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;process mas on &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot; id:&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">scan_macs_from_ip</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$dis</span><span style="color: #339933;">,</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'model'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span>
    					<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> scan_by_ip_switch<span style="color: #009900;">&#40;</span><span style="color: #000088;">$dis</span><span style="color: #339933;">,</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #000088;">$field_to_select</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT 
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$field_to_select</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    			FROM `sw`
    			WHERE
    				`ip`=INET_ATON('&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$ip</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;')
    				  ORDER BY `id`&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$query</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$sw</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">scan_sw_by_ip</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$dis</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$switches</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span>
    						<span style="color: #0000ff;">&quot;ip&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;type&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;model&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'model'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    						<span style="color: #0000ff;">&quot;disallow_ports&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'disallow_ports'</span><span style="color: #009900;">&#93;</span>
    						<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;process &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;D ELETE FROM `sw` WHERE `id`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;';&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$q1</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;UPDATE
    					`sw`	SET
    							`type`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;',  
    							`model`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;', 
    							`ports`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$sw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'
    					WHERE
    						`id`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$query</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;d&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$q</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;u&quot;</span><span style="color: #339933;">=&gt;</span><span style="color: #000088;">$q1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>				
    			<span style="color: #009900;">&#125;</span>
    			<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$query</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$qw</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #666666; font-style: italic;">//echo $qw['u'].&quot;\n&quot;;</span>
    				<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$qw</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'u'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    			<span style="color: #b1b100;">foreach</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$switches</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$switch</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;process on switch: &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot; id:&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">scan_macs_from_ip</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$dis</span><span style="color: #339933;">,</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #000088;">$switch</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'model'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span>
    					<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #990000;">mysql_error</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> show_all_sw<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #000088;">$field_to_select</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;
    			`freenibs`.`mac`,`freenibs`.`user`,`freenibs`.`uid`,`freenibs`.`deposit`,
    			`mac`.`port`,`mac`.`sw_id`,
    			`sw`.`name`,`sw`.`id`, INET_NTOA(`sw`.`ip`) AS `nas_ip`,`sw`.`type`,`sw`.`model` AS `version`,`sw`.`ports`,`sw`.`addr`
    			 &quot;</span><span style="color: #339933;">;</span>					
    	<span style="color: #b1b100;">switch</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'sort'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;ul&quot;</span><span style="color: #339933;">:</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT 
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$field_to_select</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    			FROM `freenibs`,`mac`,`sw`
    			WHERE
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    				  ORDER BY `sw`.`id`	&quot;</span><span style="color: #339933;">;</span>
    	<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    	<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">:</span>
    		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    			<span style="color: #000088;">$add_</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot; 
    					`id`='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT  
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$field_to_select</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    			FROM 
    					`freenibs`,`mac`,`sw`
    			WHERE
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$add_</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    				AND
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    				  ORDER BY 
    				  		`sw`.`id`,`sw`.`ports`
    				  		&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #666666; font-style: italic;">//echo $q;</span>
    	<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    	<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;type&quot;</span><span style="color: #339933;">:</span>
    		<span style="color: #b1b100;">switch</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'sub_type'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    		<span style="color: #b1b100;">default</span><span style="color: #339933;">:</span>
    			<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'sub_type'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				<span style="color: #000088;">$add_</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;
    &nbsp;
    						`sw`.`type` ='&quot;</span><span style="color: #339933;">.</span>quote_smart<span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'sub_type'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;'
    						&quot;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    			<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT  
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$field_to_select</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    			FROM 
    					`freenibs`,`mac`,`sw`
    			WHERE
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    				AND
    &nbsp;
      			      &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$add_</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    &nbsp;
    &nbsp;
    				  ORDER BY 
    				  		`sw`.`type`,`sw`.`name`,`mac`.`port`
    				  		&quot;</span><span style="color: #339933;">;</span>
    		<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    &nbsp;
    &nbsp;
    	<span style="color: #b1b100;">default</span><span style="color: #339933;">:</span>
    		<span style="color: #000088;">$q</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;SELECT  
    				&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$field_to_select</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    			FROM 
    					`freenibs`,`mac`,`sw`
    			WHERE
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    &nbsp;
    				  ORDER BY `sw`.`id`,`mac`.`port`
    				  		&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    	<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>		
    	<span style="color: #009900;">&#125;</span>
    		<span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">query</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$q</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$n</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">num_rows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000088;">$c</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    			<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$n</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    				<span style="color: #000088;">$nasid</span><span style="color: #339933;">=-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$nastemp</span><span style="color: #339933;">=-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
    				<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				<span style="color: #000088;">$n_of_ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    						<span style="color: #000088;">$header_sw</span><span style="color: #339933;">.=</span><span style="color: #0000ff;">&quot;&lt;td&gt;&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>?sort=ul<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;Àäðåññ&lt;/a&gt;&lt;td&gt;
    									&lt;td&gt;&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>?sort=id<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;ID&lt;/a&gt;&lt;td&gt;
    									&lt;td&gt;&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>?sort=type<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;type&lt;/a&gt;&lt;td&gt;&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    						<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$header_sw</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;
    					&lt;div style=<span style="color: #000099; font-weight: bold;">\&quot;</span>font-size:12px<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;table  border=<span style="color: #000099; font-weight: bold;">\&quot;</span>1px<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;tr&gt;&quot;</span><span style="color: #339933;">;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #000088;">$n</span><span style="color: #339933;">++;</span>
    				<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #339933;">!</span><span style="color: #009900;">&#40;</span> <span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&amp;&amp;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">==</span><span style="color: #000088;">$n</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					 	 <span style="color: #000088;">$row</span><span style="color: #339933;">=</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">fetch_array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    						<span style="color: #000088;">$nasid</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    &nbsp;
    					<span style="color: #009900;">&#125;</span>
    					<span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    					  <span style="color: #000088;">$nasid</span><span style="color: #339933;">++;</span>
    &nbsp;
    					<span style="color: #009900;">&#125;</span>
    &nbsp;
    					  	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    					  		<span style="color: #000088;">$nasid</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    					  		<span style="color: #000088;">$nastemp</span><span style="color: #339933;">=</span><span style="color: #000088;">$nasid</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_nas_ip</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_name</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'name'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_type</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_id</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_ports</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_version</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    					  		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/\bVersion/i&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$temp_version</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Version&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    									<span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #000088;">$temp_version</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'0'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    									<span style="color: #000088;">$temp_version</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    								<span style="color: #009900;">&#125;</span>
    					  	<span style="color: #009900;">&#125;</span>
    &nbsp;
    					    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$nastemp</span><span style="color: #339933;">!=</span><span style="color: #000088;">$nasid</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    							<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'snmp'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span>
    								<span style="color: #000088;">$sw_res</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">scan_sw_by_ip</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$temp_nas_ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    				      			  <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$temp_ports</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&amp;&amp;</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$temp_ports</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">100</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
    				      			  	<span style="color: #000088;">$n_of_ports</span><span style="color: #339933;">=</span><span style="color: #000088;">$temp_ports</span><span style="color: #339933;">;</span>
    				      			  <span style="color: #b1b100;">else</span>
    				      			  	<span style="color: #000088;">$n_of_ports</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">;</span>
    &nbsp;
    								<span style="color: #000088;">$c</span><span style="color: #339933;">++;</span>
    								<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$c</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$c</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    									<span style="color: #000088;">$td_pre</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot; border=<span style="color: #000099; font-weight: bold;">\&quot;</span>1px<span style="color: #000099; font-weight: bold;">\&quot;</span> &quot;</span><span style="color: #339933;">;</span>
    								<span style="color: #009900;">&#125;</span>
    								<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$td_pre</span><span style="color: #339933;">=</span><span style="color: #0000ff;">' '</span><span style="color: #339933;">;</span>
    								<span style="color: #009900;">&#125;</span>
    								<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;
    &nbsp;
    				      			&lt;tr &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$td_pre</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&gt;
    				      				 &lt;td  rowspan=<span style="color: #000099; font-weight: bold;">\&quot;</span>2<span style="color: #000099; font-weight: bold;">\&quot;</span> nowrap=<span style="color: #000099; font-weight: bold;">\&quot;</span>nowrap<span style="color: #000099; font-weight: bold;">\&quot;</span> bgcolor=<span style="color: #000099; font-weight: bold;">\&quot;</span>#999999<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;
    								&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$temp_nas_ip</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span>  target=<span style="color: #000099; font-weight: bold;">\&quot;</span>_blank<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$temp_name</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;/a&gt;
    									&lt;br&gt;&quot;</span><span style="color: #339933;">.</span><span style="color: #990000;">str_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Fast Ethernet Switch&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$temp_version</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    							&lt;/td&gt;
    							&lt;td rowspan=<span style="color: #000099; font-weight: bold;">\&quot;</span>2<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;
    								&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>?sort=id&amp;amp;id=&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$temp_id</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span> target=<span style="color: #000099; font-weight: bold;">\&quot;</span>_blank<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt; &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$temp_id</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;/a&gt;&lt;/td&gt;
    							&lt;td &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$td_pre</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot; rowspan=<span style="color: #000099; font-weight: bold;">\&quot;</span>2<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;
    								&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>?sort=type&amp;amp;sub_type=&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$temp_type</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;
    										&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$temp_type</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;
    								&lt;/a&gt;
    							&lt;/td&gt;&quot;</span><span style="color: #339933;">;</span>
    				      			<span style="color: #000088;">$nastemp</span><span style="color: #339933;">=</span><span style="color: #000088;">$nasid</span><span style="color: #339933;">;</span>	
    								<span style="color: #000088;">$header_ports</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
    				      			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n_of_ports</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    				      				<span style="color: #000088;">$header_ports</span><span style="color: #339933;">.=</span><span style="color: #0000ff;">&quot;&lt;td &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$td_pre</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;  bgcolor=<span style="color: #000099; font-weight: bold;">\&quot;</span>#CCCCCC<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$i</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;/td&gt;&quot;</span><span style="color: #339933;">;</span>
    				      			<span style="color: #009900;">&#125;</span>
    &nbsp;
    				      			<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;	&lt;tr &quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$td_pre</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&gt;<span style="color: #006699; font-weight: bold;">$header_ports</span>&lt;/tr&gt;
    									&lt;tr&gt;
    				      					&lt;td&gt;&lt;/td&gt;
    									&lt;td&gt;&lt;/td&gt;
    									&lt;td&gt;&lt;/td&gt;	&quot;</span><span style="color: #339933;">;</span>
    				      			<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><span style="color: #000088;">$n_of_ports</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><span style="color: #000088;">$i</span><span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    				      				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ports</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;td&gt;&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$ports</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$i</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;/td&gt;&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
    				      				<span style="color: #009900;">&#125;</span>
    				      				<span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    				      					<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;td bgcolor=<span style="color: #000099; font-weight: bold;">\&quot;</span>#FFFF00<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt; &lt;/td&gt;&quot;</span><span style="color: #339933;">;</span>
    				      				<span style="color: #009900;">&#125;</span>
    &nbsp;
    				      			<span style="color: #009900;">&#125;</span>
    			      				<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;/tr&gt;&quot;</span><span style="color: #339933;">;</span>
    			      				<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span>
    			      				<span style="color: #000088;">$ports</span><span style="color: #339933;">=</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			      		<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    &nbsp;
    							<span style="color: #000088;">$temp_nas_ip</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'nas_ip'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_name</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'name'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_type</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'type'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_id</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_ports</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'ports'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    							<span style="color: #000088;">$temp_version</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    			      			<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">preg_match</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/\bVersion/i&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    									<span style="color: #000088;">$temp_version</span><span style="color: #339933;">=</span><span style="color: #990000;">explode</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Version&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    									<span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #000088;">$temp_version</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'0'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    									<span style="color: #000088;">$temp_version</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'version'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    								<span style="color: #009900;">&#125;</span>
    			      		<span style="color: #009900;">&#125;</span>
    &nbsp;
    &nbsp;
    					<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'user'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
    							<span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'user'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'mac'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'deposit'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">&gt;=</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #000088;">$ports</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'port'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.=</span><span style="color: #0000ff;">&quot;&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://admin/edit_user.php?uid=&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'uid'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span> target=<span style="color: #000099; font-weight: bold;">\&quot;</span>_blank<span style="color: #000099; font-weight: bold;">\&quot;</span> &gt;&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'user'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span><span style="color: #339933;">;</span>	
    					<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    						<span style="color: #000088;">$ports</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'port'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.=</span><span style="color: #0000ff;">&quot;&lt;b&gt;&lt;a style=<span style="color: #000099; font-weight: bold;">\&quot;</span>color: red<span style="color: #000099; font-weight: bold;">\&quot;</span> href=<span style="color: #000099; font-weight: bold;">\&quot;</span>https://admin/edit_user.php?uid=&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'uid'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span> target=<span style="color: #000099; font-weight: bold;">\&quot;</span>_blank<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$row</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'user'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;/a&gt;&lt;/b&gt;&lt;br&gt;&quot;</span><span style="color: #339933;">;</span>	
    					<span style="color: #009900;">&#125;</span>
    				<span style="color: #009900;">&#125;</span>
    				<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">switch</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_GET</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'snmp'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    					<span style="color: #b1b100;">case</span> <span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #339933;">:</span>
    						<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;/tr&gt;
    						&lt;/table&gt;&lt;/div&gt;&quot;</span><span style="color: #339933;">;</span>
    						<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;p&gt;&quot;</span><span style="color: #339933;">.</span>PAGE_MES_2<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;:&lt;/p&gt;
    						&lt;p&gt;	&quot;</span><span style="color: #339933;">.</span>PAGE_MES_3<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;:	<span style="color: #006699; font-weight: bold;">$sw_res[type]</span>&lt;/p&gt;
    						&lt;p&gt;	&quot;</span><span style="color: #339933;">.</span>PAGE_MES_4<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;	<span style="color: #006699; font-weight: bold;">$sw_res[version]</span>&lt;/p&gt;
    						&lt;p&gt;	&quot;</span><span style="color: #339933;">.</span>PAGE_MES_5<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;	<span style="color: #006699; font-weight: bold;">$sw_res[ports]</span>&lt;/p&gt;
    						&lt;p&gt;	Ip	<span style="color: #006699; font-weight: bold;">$sw_res[ip]</span>&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">default</span><span style="color: #339933;">:</span>
    						<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;/tr&gt;
    						&lt;/table&gt;&lt;/div&gt;&quot;</span><span style="color: #339933;">;</span>
    						<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;
    						&lt;p&gt;&lt;a href=<span style="color: #000099; font-weight: bold;">\&quot;</span>?sort=id&amp;amp;id=&quot;</span><span style="color: #339933;">.</span><span style="color: #000088;">$temp_id</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&amp;amp;snmp=true<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;Get data by snmp&lt;/a&gt;
    						&lt;p&gt;&quot;</span><span style="color: #339933;">.</span>PAGE_MES_2<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;:&lt;/p&gt;
    						&lt;p&gt;	&quot;</span><span style="color: #339933;">.</span>PAGE_MES_3<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;:	<span style="color: #006699; font-weight: bold;">$temp_type</span>&lt;/p&gt;
    						&lt;p&gt;	&quot;</span><span style="color: #339933;">.</span>PAGE_MES_4<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;	&lt;/p&gt;
    						&lt;p&gt;	&quot;</span><span style="color: #339933;">.</span>PAGE_MES_5<span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;	&lt;/p&gt;
    						&lt;p&gt;	Ip	<span style="color: #006699; font-weight: bold;">$temp_nas_ip</span>&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
    					<span style="color: #b1b100;">break</span><span style="color: #339933;">;</span>
    					<span style="color: #009900;">&#125;</span>
    				<span style="color: #009900;">&#125;</span>
    			<span style="color: #009900;">&#125;</span>
    &nbsp;
    &nbsp;
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php 
    class page{
    	protected $db;
    	protected $db_nibs;
    	protected $telnet;
    	protected $result_telnet_connect;
    	protected $sw_type;
    	public function __construct (&amp;$db,&amp;$db_nibs){
    			$this-&gt;db=&amp;$db;
    			$this-&gt;db_nibs=&amp;$db_nibs;
    	}
    	public function top(){ 
    			@include_once(&quot;pages/top.php&quot;); 
    	}
    	public function bottom(){ 
    			@include_once(&quot;pages/bottom.php&quot;); 
    	}
    
    	public function telnet_disconnect(){ $this-&gt;telnet-&gt;Disconnect(); }
    	public function telnet($ip,$login,$pass){
    		$this-&gt;telnet=new PHPTelnet();
    		$this-&gt;telnet-&gt;show_connect_error=0;
    
    		// if the first argument to Connect is blank,
    		// PHPTelnet will connect to the local host via 127.0.0.1
    		$this-&gt;result_telnet_connect = $this-&gt;telnet-&gt;Connect($ip,$login,$pass);
    		
    		switch ($this-&gt;result_telnet_connect) {
    		case 0:
    		//$this-&gt;telnet-&gt;DoCommand('enter command here', $result);
    		// NOTE: $result may contain newlines
    		//echo $result;
    		//$this-&gt;telnet-&gt;DoCommand('another command', $result);
    		//echo $result;
    		// say Disconnect(0); to break the connection without explicitly logging out
    		
    			return true;
    		break;
    		case 1:
    		echo '[PHP Telnet] Connect failed: Unable to open network connection';
    		break;
    		case 2:
    		echo '[PHP Telnet] Connect failed: Unknown host';
    		break;
    		case 3:
    		echo '[PHP Telnet] Connect failed: Login failed';
    		break;
    		case 4:
    		echo '[PHP Telnet] Connect failed: Your PHP version does not support PHP Telnet';
    		break;
    		}
    		return false;
    	}
    	public function initial_config_sw($ip){
    	}
    	public function initial_extreme_config_sw($ip){
    		//delete vlan Mac
    		
    	}
    
    	public function save_current_sw_config(){
    	}
    	public function save_extreme_current_sw_config(){
    		$this-&gt;telnet-&gt;DoCommand(&quot;save&quot;, $this-&gt;result_telnet_connect);
    		$this-&gt;telnet-&gt;DoCommand(&quot;yes&quot;, $this-&gt;result_telnet_connect);
    		$this-&gt;telnet-&gt;DoCommand(&quot;
    &quot;, $this-&gt;result_telnet_connect);
    	}
    	/* $ports_tagged=1,2,3,4,5.... */
    	public function create_vlan($vlanid,$ports_tagged,$ports_untagged,$debug=false){
    		switch($this-&gt;sw_type){
    			case &quot;dlink&quot;:
    			break;
    			case &quot;dell&quot;:
    			break;
    			case &quot;extreme&quot;:
    				self::create_extreem_vlan($vlanid,$ports_tagged,$ports_untagged,$debug);
    			break;
    		}
    		
    	}
    	public function create_extreem_vlan($vlanid,$ports_tagged,$ports_untagged,$debug=false){
    	if($debug==true){
    		echo &quot;create vlan vlan$vlanid\n&quot;;
    		echo &quot;configure vlan vlan$vlanid tag $vlanid\n&quot;;
    		echo &quot;configure vlan vlan$vlanid add ports  $ports_tagged tagged\n&quot;;
    		echo &quot;configure vlan vlan$vlanid add ports  $ports_untagged untagged\n&quot;;
    	}
    	$this-&gt;telnet-&gt;DoCommand(&quot;create vlan vlan$vlanid&quot;, $this-&gt;result_telnet_connect);
    			//create vlan vlan$vlanid
    	$this-&gt;telnet-&gt;DoCommand(&quot;configure vlan vlan$vlanid tag $vlanid&quot;, $this-&gt;result_telnet_connect);
    
    	$this-&gt;telnet-&gt;DoCommand(&quot;configure vlan vlan$vlanid add ports  $ports_tagged tagged&quot;, $this-&gt;result_telnet_connect);
    	
    			//configure vlan vlan$vlanid add ports  $ports_tagged tagged
    	$this-&gt;telnet-&gt;DoCommand(&quot;configure vlan vlan$vlanid add ports  $ports_untagged untagged&quot;, $this-&gt;result_telnet_connect);
    	
    			//configure vlan vlan$vlanid add ports  $ports_untagged untagged
    	}
    
    	public function create_dell_vlan($vlanid,$ports_tagged,$ports_untagged,$debug=false){
    	if($debug==true){
    		echo &quot;configure\n&quot;;
    		echo &quot;vlan database\n&quot;;
    		echo &quot;vlan $vlanid\n&quot;;
    		echo &quot;exit\n&quot;;
    	
    
    	}
    
    	/*$this-&gt;telnet-&gt;DoCommand(&quot;configure&quot;, $this-&gt;result_telnet_connect);
    	$this-&gt;telnet-&gt;DoCommand(&quot;vlan database&quot;, $this-&gt;result_telnet_connect);
    	$this-&gt;telnet-&gt;DoCommand(&quot;vlan $vlanid&quot;, $this-&gt;result_telnet_connect);
    	$this-&gt;telnet-&gt;DoCommand(&quot;exit&quot;, $this-&gt;result_telnet_connect);
    	*/
    	 $script = new telnet; 
    	
    	$ar_of_ports_tagged=explode(&quot;,&quot;,$ports_tagged);
    	$c=0;
    		foreach($ar_of_ports_tagged as $port){
    			if(is_numeric($port)&amp;&amp;($port&gt;0)){
    				
    				if($c==0)
    					$port_line=&quot;1/e&quot;.$port.&quot;,&quot;;
    				else
    					$port_line=&quot;,1/e&quot;.$port.&quot;&quot;;
    				$c++;
    			}
    		}
    		//exist any ports
    		if($c&gt;0){
    			
    			//$this-&gt;telnet-&gt;DoCommand(&quot;interface range ethernet $port_line&quot;, $this-&gt;result_telnet_connect);
    			$this-&gt;telnet-&gt;DoCommand(&quot;switchport access vlan $vlanid&quot;, $this-&gt;result_telnet_connect);
    		}
    	}
    
    
    	public function delete_vlan($vlanid){
    	}
    	public function delete_extreme_vlan($vlanid,$debug=false){
    		if($debug==true){
    			echo &quot;delete vlan vlan$vlanid\n&quot;;
    		}
    		$this-&gt;telnet-&gt;DoCommand(&quot;delete vlan vlan$vlanid&quot;, $this-&gt;result_telnet_connect);
    		
    	}	
    
    	public function remove_port_from_vlan($vlanid,$port_remove){
    	}
    	public function remove_extreme_port_from_vlan($vlanid,$port_remove){
    		//configure vlan vlan$vlanid delete ports  $port_remove
    	}
    	
    	public function add_port_to_vlan($vlanid,$port,$type){
    		switch($type){
    			case &quot;T&quot;:
    			break;
    			case &quot;U&quot;:
    			break;
    		}
    	}
    
    	public function scan_sw_by_ip($ip){
       			    $type=unknown;
    				$version=no_version;
    				$ports=48;
    				$SNMP_COMUNITY_READ=COMUNITY_READ;	
    				echo &quot;snmpwalk(&quot;.$ip.&quot;,&quot;.$SNMP_COMUNITY_READ.&quot;,&quot;.OID_sysDescr.&quot;,&quot;.&quot;)&quot;;
    				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
    				
    				if(strlen($result[0])&lt;2){
    					$SNMP_COMUNITY_READ=COMUNITY_DEF_DLINK_READ;
    				//session.version = SNMP_VERSION_2c;
    				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
    				}
    				if(strlen($result[0])&lt;2){
    					$SNMP_COMUNITY_READ=COMUNITY_READ2;
    				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
    				}
    				if(strlen($result[0])&lt;2){
    					$type=PAGE_MES_1;
    					$version=no_version;
    					$ports=48;
    					return array(&quot;version&quot;=&gt;$version,&quot;type&quot;=&gt;$type,&quot;ports&quot;=&gt;$ports,&quot;ip&quot;=&gt;$ip);
    				}
    				else{
    					$result=$result[0];
    					//echo print_r($result);
    					/* OID  ????????? ????????, ?? ??????? ??????:
    					* dlink : D-Link DES-3026 Fast Ethernet Switch
    					* dell :  Ethernet Stackable Switching System  
    						PowerConnect 3348 
    									?????=&gt;&quot;OID_DELL_sysDescr&quot; 
    					* extreem : Summit200-48 - Version 7.3e.2 (Build 4) by Release_Master 02/24/05 19:20:09 
    					* SMC: SMC Networks SMC8624T 1
    					* */
    					$dlink_oid_pattern=&quot;/\bD-Link\b/i&quot;;
    					$dlink_oid_pattern2=&quot;/\bDLink\b/i&quot;;
    					$dlink_oid_pattern3=&quot;/\bDES\b/i&quot;;
    					$extreem_oid_pattern=&quot;/\bSummit/i&quot;;
    					$smc_oid_pattern=&quot;/\bSMC/i&quot;;
    					$dell_oid_pattern=&quot;/\bStackable\b/i&quot;;
    					$dell__oid_pattern=&quot;/\bEthernet\b/i&quot;;
    					$dell2_oid_pattern=&quot;/\bPowerConnect\b/i&quot;;
    					$dell_ports_24_patern=&quot;/\d\d24/&quot;;
    					$dell_ports_48_patern=&quot;/\d\d48/&quot;;
    					$cisco_oid_pattern=&quot;/\bcisco\b/i&quot;;
    					$cisco2_oid_pattern=&quot;/\bCISCO \b/i&quot;;
    					$netgear_FSM_pattern=&quot;/\bFSM/i&quot;;
    					
    				if( ( preg_match($dlink_oid_pattern,$result))|| (preg_match($dlink_oid_pattern2,$result)) || (preg_match($dlink_oid_pattern3,$result))){
    					$type=dlink;
    					$version=$result;
    					$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_standart_ports);
    					$ports=48;
    						if(preg_match(&quot;/3026/&quot;,$version)){
    									$ports=24;
    						}elseif(preg_match(&quot;/3028/&quot;,$version)){
    									$ports=24;
    						}elseif(preg_match(&quot;/3528/&quot;,$version)){
    									$ports=24;
    						}elseif(preg_match(&quot;/3526/&quot;,$version)){
    									$ports=24;
    						}elseif(preg_match(&quot;/3026/&quot;,$version)){
    									$ports=24;
    						}elseif(preg_match(&quot;/3016/&quot;,$version)){
    									$ports=16;
    						}elseif(preg_match(&quot;/3010/&quot;,$version)){
    									$ports=10;
    						}
    						 
    				}
    				elseif(preg_match($extreem_oid_pattern,$result)){
    					$type=&quot;extreem&quot;;
    					$version=$result;
    					$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_standart_ports);
    					$ports=48;
    					
    				}elseif(preg_match($netgear_FSM_pattern,$result)){
    					$type=&quot;netgear&quot;;
    					$version=str_replace(&quot;Stackable Switch&quot;,&quot;&quot;,$result);
    					$ports=48;					
    					if(preg_match(&quot;/FSM7328S/&quot;,$version)){
    									$ports=24;
    						}elseif(preg_match(&quot;/FSM7352S/&quot;,$version)){
    									$ports=48;
    						}
    					
    				}
    				elseif((preg_match($cisco_oid_pattern,$result))|| (preg_match($cisco2_oid_pattern,$result)) ){
    					$type=&quot;cisco&quot;;
    					$version=$result;
    					//$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_standart_ports);
    					$ports=48;
    						if(preg_match(&quot;/C3500/&quot;,$version)){
    							$ports=48;
    							$version=&quot;Cisco C3500XL&quot;;
    						}else if(preg_match(&quot;/WS-C2948/&quot;,$version)){
                                                             $ports=48;
                                                             $version=&quot;Cisco WS-C2948&quot;;
                                                     }
    				}
    				elseif(preg_match($smc_oid_pattern,$result)){
    					$type=&quot;SMC&quot;;
    					$version=$result;
    					$ports=48;
    						if(preg_match(&quot;/8624/&quot;,$version)){
    									$ports=24;
    						}
    					
    				}
    				elseif((preg_match($dell_oid_pattern,$result))||(preg_match($dell__oid_pattern,$result))){
    					$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_DELL_enterprises);
    						$type=&quot;dell_un&quot;;
    						$version=$result;
    						$ports=48;
    						foreach($result as $key){
    						if(preg_match($dell2_oid_pattern,$key)){
    							$version=&quot;Dell &quot;.str_replace(&quot;\&quot;&quot;,&quot;&quot;,$key);
    							$type=&quot;dell&quot;;
    							if(preg_match($dell_ports_48_patern,$key)){
    								$ports=48;
    							}elseif(preg_match($dell_ports_24_patern,$key)){
    								$ports=24;
    							}
    							$arr=array();
    							break;
    						}
    					}
    
    				}
    				echo &quot;type $type \&quot;ports\&quot;=&gt;$ports,\&quot;ip\&quot;=&gt;$ip)\n&quot;;
    				return array(&quot;version&quot;=&gt;str_replace(&quot;STRING:&quot;,&quot;&quot;,$version),&quot;type&quot;=&gt;$type,&quot;ports&quot;=&gt;$ports,&quot;ip&quot;=&gt;$ip);
    			}
    			
    	}
    	public function arpwatch_macs(){
    		$q=&quot;DELETE FROM  `freenibs`  WHERE `user` LIKE '10.%'&quot;;
    		$this-&gt;db-&gt;query($q);
    		$q=&quot;DELETE FROM 
    				`arpwatch`
    				WHERE `date` &lt; FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -604000 )&quot;;
    		$this-&gt;db_nibs-&gt;query($q);
    		$q=&quot;SELECT *
    			FROM `arpwatch` ORDER BY `date&quot;;
    		$this-&gt;db_nibs-&gt;query($q);
    		$n=$this-&gt;db_nibs-&gt;num_rows();
    		if($n&gt;0){
    			for($i=0;$i&lt;$n;$i++){
    				$row=$this-&gt;db_nibs-&gt;fetch_array();
    				$ip=$row['ip'];
    				$mac=$row['arp'];
    				$q=&quot;INSERT INTO `freenibs` (
    						`mac` ,
    						`user` ,
    						`deposit`
    						)
    						VALUES (
    						'&quot;.quote_smart(strtolower($mac)).&quot;','&quot;.quote_smart($ip).&quot;', '-2048'
    						)
    						 ON DUPLICATE KEY UPDATE
    						`user`='&quot;.quote_smart($ip).&quot;'
    					;&quot;;
    				$this-&gt;db-&gt;query($q);
    			}
    				
    	   }
    	}
    	public function clear_(){ 	
    	$q=&quot;DELETE FROM `mac` WHERE `date` &lt; FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -86400 )
    		AND `mac` NOT
    		IN (
    		
    		SELECT `mac`
    		FROM `freenibs`
    		)&quot;;
    	$this-&gt;db-&gt;query($q);
    		$q=&quot;DELETE FROM `mac` WHERE `date` &lt; FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -259200 )
    		AND `mac` 
    		IN (
    		
    		SELECT `mac`
    		FROM `freenibs`
    		)&quot;;
    	$this-&gt;db-&gt;query($q);
    	}
    	public function cron (){
    		self::clear_();
    		self::arpwatch_macs();
    		self::users_macs();
    		$field_to_select=&quot;INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`&quot;;
    		$q=&quot;SELECT 
    				&quot;.$field_to_select.&quot;
    			FROM `sw`
    				  ORDER BY `id`&quot;;
    		//echo $q;
    		$this-&gt;db-&gt;query($q);
    		$n=$this-&gt;db-&gt;num_rows();
    		$query=array();
    		if($n&gt;0){
    			echo '#!/bin/sh'.&quot;\n&quot;;
    			$zzz=0;
    			for($i=0;$i&lt;$n;$i++){
    			$zzz++;	
    				$row=$this-&gt;db-&gt;fetch_array();
    				echo &quot;/usr/bin/php -q /var/www/skmsw/cron_one_ip.php &quot;.$row['nas_ip'].&quot; &gt;&gt;/dev/null &amp;\n&quot;;
    				passthru(&quot;/usr/bin/php -q /var/www/skmsw/cron_one_ip.php &quot;.$row['nas_ip'].&quot; &gt;&gt;/dev/null &amp;&quot;);
    			if(zzz&gt;4){ sleep(5); $zzz=0; }
    			}
    		}
    		$dis=self::clear_disallow();
    	}
    	public function cron_one_ip($ip){
    		echo &quot;clear_disallow_ip($ip)\n&quot;;
    		$dis=self::clear_disallow_ip($ip);
    		echo &quot; done clear_disallow_ip($ip)\n&quot;;
    		echo &quot;scan_by_ip_switch($dis,$ip);\n&quot;;
    		self::scan_by_ip_switch($dis,$ip);
    		echo &quot; done scan&quot;;
    		//$dis=self::clear_disallow();
    	}
    	public function clear_disallow_ip($ip){
    		if(strlen($ip)&gt;0)
    		$q=&quot;SELECT 
    				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
    			FROM `sw`
    			WHERE `ip`=INET_ATON('&quot;.$ip.&quot;')&quot;;
    		else
    		$q=&quot;SELECT 
    				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
    			FROM `sw`&quot;;
    		$this-&gt;db-&gt;query($q);
    		$n=$this-&gt;db-&gt;num_rows();
    		//echo $q.&quot;\n&quot;;
    		if($n&gt;0){
    			for($i=0;$i&lt;$n;$i++){
    				 $row=$this-&gt;db-&gt;fetch_array();
    					 if(strlen($row['ports'])&gt;0)
    						 $disallow[]=array(&quot;ip&quot;=&gt;$row['nas_ip'],&quot;ports&quot;=&gt;$row['ports'],&quot;id&quot;=&gt;$row['id']);
    						 $dis[$row['nas_ip']]=array(&quot;ip&quot;=&gt;$row['nas_ip'],&quot;ports&quot;=&gt;$row['ports'],&quot;id&quot;=&gt;$row['id']);
    						 
    			}
    		}
    		foreach($disallow as $disallow_array){
    			$ip=$disallow_array['ip'];
    			$id=$disallow_array['id'];
    			$p=explode(&quot;,&quot;,$disallow_array['ports']);
    			foreach($p as $port_val){
    				$q=&quot;DELETE FROM `mac` WHERE `sw_id` = '&quot;.quote_smart($id).&quot;' AND `port`='&quot;.quote_smart($port_val).&quot;'&quot;;
    				//echo $q.&quot;\n&quot;;
    				$this-&gt;db-&gt;query($q);
    			}
    		}
    		return $dis;
    	}
    	public function clear_disallow(){
    		$q=&quot;SELECT 
    				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
    			FROM `sw`&quot;;
    		$this-&gt;db-&gt;query($q);
    		$n=$this-&gt;db-&gt;num_rows();
    		//echo $n.&quot;\n&quot;;
    		if($n&gt;0){
    			for($i=0;$i&lt;$n;$i++){
    				 $row=$this-&gt;db-&gt;fetch_array();
    					 if(strlen($row['ports'])&gt;0)
    						 $disallow[]=array(&quot;ip&quot;=&gt;$row['nas_ip'],&quot;ports&quot;=&gt;$row['ports'],&quot;id&quot;=&gt;$row['id']);
    						 $dis[$row['nas_ip']]=array(&quot;ip&quot;=&gt;$row['nas_ip'],&quot;ports&quot;=&gt;$row['ports'],&quot;id&quot;=&gt;$row['id']);
    						 
    			}
    		}
    		foreach($disallow as $disallow_array){
    			$ip=$disallow_array['ip'];
    			$id=$disallow_array['id'];
    			$p=explode(&quot;,&quot;,$disallow_array['ports']);
    			foreach($p as $port_val){
    				$q=&quot;DELETE FROM `mac` WHERE `sw_id` = '&quot;.quote_smart($id).&quot;' AND `port`='&quot;.quote_smart($port_val).&quot;'&quot;;
    				//echo $q.&quot;\n&quot;;
    				$this-&gt;db-&gt;query($q);
    			}
    		}
    		return $dis;
    	}
    	public function users_macs(){	
    		$q=&quot;SELECT `actions`.`call_from`,`actions`.`user`,`users`.`uid`,`users`.`deposit`,`users`.`credit`
    			FROM `actions`, `users`
    			WHERE 
    				`actions`.`call_from` LIKE '%:%'
    			AND	
    				`users`.`user`=`actions`.`user`
    				AND
    				 	`start_time`&gt;FROM_UNIXTIME(UNIX_TIMESTAMP(NOW() )-90000)
    			GROUP BY `actions`.`call_from`&quot;;
    		$this-&gt;db_nibs-&gt;query($q);
    		$n=$this-&gt;db_nibs-&gt;num_rows();
    		if($n&gt;0){
    			for($i=0;$i&lt;$n;$i++){
    			 $row=$this-&gt;db_nibs-&gt;fetch_array();
    			$m=explode(&quot;/&quot;,$row['call_from']); //10.200.30.16 / 00:1d:92:f7:46:60 / vlan51
    			$mac=strtolower(trim($m[1]));
    			$user=$row['user'];
    			$uid=$row['uid'];
    			$deposit=$row['deposit']+$row['credit'];
    			$q=&quot;INSERT INTO  `freenibs` (
    					`mac` ,
    					`user`,
    					`uid`,
    					`deposit`
    					)
    					VALUES (
    					'&quot;.quote_smart($mac).&quot;', '&quot;.quote_smart($user).&quot;','&quot;.quote_smart($uid).&quot;','&quot;.quote_smart($deposit).&quot;'
    					)
    					ON DUPLICATE KEY UPDATE
    					`mac`='&quot;.quote_smart($mac).&quot;', `user`='&quot;.quote_smart($user).&quot;',`uid`='&quot;.quote_smart($uid).&quot;',`deposit`='&quot;.quote_smart($deposit).&quot;';&quot;;
    				$this-&gt;db-&gt;query($q);
    			}
    		}
    		$q=&quot;SELECT `blocked`,`mac_addr`,`user`,`uid`,`deposit`,`credit` FROM `users` WHERE `mac_addr` LIKE '%:%'&quot;;
    		$this-&gt;db_nibs-&gt;query($q);
    		$n=$this-&gt;db_nibs-&gt;num_rows();
    	if($n&gt;0){
    		for($i=0;$i&lt;$n;$i++){
    			 $row=$this-&gt;db_nibs-&gt;fetch_array();
    			$mac=strtolower($row['mac_addr']);
    			$user=$row['user'];
    			$uid=$row['uid'];
    			$deposit=$row['deposit']+$row['credit'];
    			//echo $user.&quot; &quot;.$mac.&quot;\n&quot;;
    			$blocked=$row['blocked'];
    
    			$q=&quot;INSERT INTO `freenibs` (
    					`mac` ,
    					`user`,
    					`uid`,
    					`deposit`
    					)
    					VALUES (
    					'&quot;.quote_smart($mac).&quot;', '&quot;.quote_smart($user).&quot;','&quot;.quote_smart($uid).&quot;','&quot;.quote_smart($deposit).&quot;'
    					)
    					ON DUPLICATE KEY UPDATE
    					`en`='&quot;.quote_smart($blocked).&quot;',`mac`='&quot;.quote_smart($mac).&quot;', `user`='&quot;.quote_smart($user).&quot;',`uid`='&quot;.quote_smart($uid).&quot;',`deposit`='&quot;.quote_smart($deposit).&quot;';&quot;;
    					$this-&gt;db-&gt;query($q);
    		}
    	  }
    	}
    	public function user_to_port_sw(){
    
    		
    	}
    	
    	public function scan_macs_from_ip($ip,$nas_id,$dis,$type,$model){
    				$disallow=$dis[$ip];
    				$p=explode(&quot;,&quot;,$disallow['ports']);
    				$SNMP_COMUNITY_READ=COMUNITY_READ;
    				if($ip=='127.0.0.1'){
    					//трюк для ЦИСКИ, так как ей надо указывать комьюнити в виде community@vlan
    					 $SNMP_COMUNITY_READ=&quot;public@25&quot;;
    				}
    				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
    				if(strlen($result[0])&lt;2){
    					$SNMP_COMUNITY_READ=COMUNITY_DEF_DLINK_READ;
    					$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
    				}
    				if(strlen($result[0])&lt;2){
    					$SNMP_COMUNITY_READ=COMUNITY_READ2;
    				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
    				}
    				echo &quot;SNMP_COMUNITY_READ $SNMP_COMUNITY_READ\n&quot;;
    				if(strlen($result[0])&lt;2){
    					return array();
    				}
    				else{
    					if($type==&quot;cisco&quot;)
    						$res=snmprealwalk($ip,$SNMP_COMUNITY_READ,OID_cisco_mac_on_ports);
    					else{
    						//$res=snmp2_real_walk($ip,$SNMP_COMUNITY_READ,OID_mac_on_ports);
    						$res=snmprealwalk($ip,$SNMP_COMUNITY_READ,OID_mac_on_ports);
    						//print_r($res);
    					}
    
    					/*  old cisco
    					 $res=snmprealwalk($ip,&quot;public@54&quot;,&quot;.1.3.6.1.2.1.17.4.3.1.2&quot;);
                                             foreach ($res as $ind=&gt;$port){
                                                 $arr=explode('.',$ind);
                                                    $c=count($arr);
                                                     $port=explode(':',$port);
                                                     $port_temp=$port;
                                                     $port=(int)$port[1];
                                             if($ip=='172.16.2.26'){
                                                    $port=$cisco_rp[$port];
                                              }
    
                                              $mc=dec_hex($arr[$c-6]).':'.dec_hex($arr[$c-5]).':'.dec_hex($arr[$c-4]).':'.dec_hex($arr[$c-3]).':'.dec_hex($arr[$c-2]).':'.dec_hex($arr[$c-1]);
                                                     $mac=strtolower($mc);
                                                 $main[$mac]=$port;
                                                 echo $mac.&quot; - $port - $port_t[0]--.1.3.6.1.2.1.17.1.4.1.2.&quot;.$port.&quot;\n&quot;;
                                             }
    					*/
    
    					foreach ($main as $mac=&gt;$port){
    						if(!(in_array($port,$p))){
    					    $query=&quot;
    					     INSERT INTO `mac` (
    							
    							`mac` ,
    							`sw_id`,
    							`port`,
    							`date`
    							)
    							VALUES (
    							'&quot;.quote_smart($mac).&quot;' , '&quot;.quote_smart($nas_id).&quot;', '&quot;.quote_smart($port).&quot;',NOW()
    							)
    							ON DUPLICATE KEY UPDATE
    							`mac`='&quot;.quote_smart($mac).&quot;' , 
    							`sw_id`='&quot;.quote_smart($nas_id).&quot;', 
    							`port`='&quot;.quote_smart($port).&quot;',
    							`date`=NOW();&quot;;
    							
    					    $this-&gt;db-&gt;query($query);
    					}
    					}
    										
    				}
    	}
    	
    	public function scan_all_switches($dis){
    		$field_to_select=&quot;INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`&quot;;
    		$q=&quot;SELECT 
    				&quot;.$field_to_select.&quot;
    			FROM `sw`
    				  ORDER BY `id`&quot;;
    		$this-&gt;db-&gt;query($q);
    		$n=@$this-&gt;db-&gt;num_rows();
    		$query=array();
    		if($n&gt;0){
    			for($i=0;$i&lt;$n;$i++){
    				$row=$this-&gt;db-&gt;fetch_array();
    				$sw=self::scan_sw_by_ip($row['nas_ip'],$dis);
    				$switches[]=array(
    						&quot;ip&quot;=&gt;$row['nas_ip'],
    						&quot;id&quot;=&gt;$row['id'],
    						&quot;type&quot;=&gt;$row['type'],
    						&quot;model&quot;=&gt;$row['model'],
    						&quot;disallow_ports&quot;=&gt;$row['disallow_ports']
    						);
    				
    				echo &quot;process &quot;.$row['nas_ip'].&quot;\n&quot;;
    				if($sw['type']!=&quot;unknown&quot;){
    				$q1=&quot;UPDATE
    					`sw`	SET
    							`type`='&quot;.quote_smart($sw['type']).&quot;',  
    							`model`='&quot;.quote_smart($sw['version']).&quot;', 
    							`ports`='&quot;.quote_smart($sw['ports']).&quot;'
    					WHERE
    						`id`='&quot;.quote_smart($row['id']).&quot;'&quot;;
    				$query[]=array(&quot;d&quot;=&gt;$q,&quot;u&quot;=&gt;$q1);
    				}
    			}
    			foreach($query as $qw){
    				$this-&gt;db-&gt;query($qw['u']);
    			}
    			foreach($switches as $switch){
    				echo &quot;process mas on &quot;.$switch['ip'].&quot; id:&quot;.$switch['id'].&quot;\n&quot;;
    				self::scan_macs_from_ip($switch['ip'],$switch['id'],$dis,$switch['type'],$switch['model']);
    			}
    		}
    		if(DEBUG_DB==&quot;true&quot;)
    					echo $this-&gt;db-&gt;mysql_error();	
    	}
    	public function scan_by_ip_switch($dis,$ip){
    		$field_to_select=&quot;INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`&quot;;
    		$q=&quot;SELECT 
    				&quot;.$field_to_select.&quot;
    			FROM `sw`
    			WHERE
    				`ip`=INET_ATON('&quot;.$ip.&quot;')
    				  ORDER BY `id`&quot;;
    		$this-&gt;db-&gt;query($q);
    		$n=$this-&gt;db-&gt;num_rows();
    		$query=array();
    		if($n&gt;0){
    			
    			for($i=0;$i&lt;$n;$i++){
    				$row=$this-&gt;db-&gt;fetch_array();
    				$sw=self::scan_sw_by_ip($row['nas_ip'],$dis);
    				$switches[]=array(
    						&quot;ip&quot;=&gt;$row['nas_ip'],
    						&quot;id&quot;=&gt;$row['id'],
    						&quot;type&quot;=&gt;$row['type'],
    						&quot;model&quot;=&gt;$row['model'],
    						&quot;disallow_ports&quot;=&gt;$row['disallow_ports']
    						);
    				
    				echo &quot;process &quot;.$row['nas_ip'].&quot;\n&quot;;
    				$q=&quot;D ELETE FROM `sw` WHERE `id`='&quot;.quote_smart($row['id']).&quot;';&quot;;
    				$q1=&quot;UPDATE
    					`sw`	SET
    							`type`='&quot;.quote_smart($sw['type']).&quot;',  
    							`model`='&quot;.quote_smart($sw['version']).&quot;', 
    							`ports`='&quot;.quote_smart($sw['ports']).&quot;'
    					WHERE
    						`id`='&quot;.quote_smart($row['id']).&quot;'&quot;;
    				$query[]=array(&quot;d&quot;=&gt;$q,&quot;u&quot;=&gt;$q1);				
    			}
    			foreach($query as $qw){
    				//echo $qw['u'].&quot;\n&quot;;
    				$this-&gt;db-&gt;query($qw['u']);
    			}
    			foreach($switches as $switch){
    				echo &quot;process on switch: &quot;.$switch['ip'].&quot; id:&quot;.$switch['id'].&quot;\n&quot;;
    				self::scan_macs_from_ip($switch['ip'],$switch['id'],$dis,$switch['type'],$switch['model']);
    			}
    		}
    		if(DEBUG_DB==&quot;true&quot;)
    					echo $this-&gt;db-&gt;mysql_error();	
    	}
    	
    	public function show_all_sw(){
    	$field_to_select=&quot;
    			`freenibs`.`mac`,`freenibs`.`user`,`freenibs`.`uid`,`freenibs`.`deposit`,
    			`mac`.`port`,`mac`.`sw_id`,
    			`sw`.`name`,`sw`.`id`, INET_NTOA(`sw`.`ip`) AS `nas_ip`,`sw`.`type`,`sw`.`model` AS `version`,`sw`.`ports`,`sw`.`addr`
    			 &quot;;					
    	switch($_GET['sort']){
    	case &quot;ul&quot;:
    		$q=&quot;SELECT 
    				&quot;.$field_to_select.&quot;
    			FROM `freenibs`,`mac`,`sw`
    			WHERE
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    				  ORDER BY `sw`.`id`	&quot;;
    	break;
    	case &quot;id&quot;:
    		if(strlen($_GET['id'])&gt;1){
    			$add_=&quot; 
    					`id`='&quot;.quote_smart($_GET['id']).&quot;'&quot;;
    		}
    		$q=&quot;SELECT  
    				&quot;.$field_to_select.&quot;
    			FROM 
    					`freenibs`,`mac`,`sw`
    			WHERE
    				&quot;.$add_.&quot;
    				AND
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    				  ORDER BY 
    				  		`sw`.`id`,`sw`.`ports`
    				  		&quot;;
    			//echo $q;
    	break;
    	case &quot;type&quot;:
    		switch($_GET['sub_type']){
    		default:
    			if(strlen($_GET['sub_type'])&gt;1){
    				$add_=&quot;
    					 
    						`sw`.`type` ='&quot;.quote_smart($_GET['sub_type']).&quot;'
    						&quot;;
    			}
    			
    			$q=&quot;SELECT  
    				&quot;.$field_to_select.&quot;
    			FROM 
    					`freenibs`,`mac`,`sw`
    			WHERE
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    				AND
    				  		
      			      &quot;.$add_.&quot;
    				
    				
    				  ORDER BY 
    				  		`sw`.`type`,`sw`.`name`,`mac`.`port`
    				  		&quot;;
    		break;
    		}
    	break;
    
    
    	default:
    		$q=&quot;SELECT  
    				&quot;.$field_to_select.&quot;
    			FROM 
    					`freenibs`,`mac`,`sw`
    			WHERE
    					`mac`.`mac`=`freenibs`.`mac`
    				AND
    					`sw`.`id`=`mac`.`sw_id`	
    				
    				  ORDER BY `sw`.`id`,`mac`.`port`
    				  		&quot;;
    		
    	break;		
    	}
    		$this-&gt;db-&gt;query($q);
    		$n=$this-&gt;db-&gt;num_rows();
    		$c=0;
    			if($n&gt;0){
    				
    				$nasid=-1;
    				$nastemp=-1;
    				$ports=array();
    
    				$n_of_ports=48;
    						$header_sw.=&quot;&lt;td&gt;&lt;a href=\&quot;?sort=ul\&quot;&gt;Àäðåññ&lt;/a&gt;&lt;td&gt;
    									&lt;td&gt;&lt;a href=\&quot;?sort=id\&quot;&gt;ID&lt;/a&gt;&lt;td&gt;
    									&lt;td&gt;&lt;a href=\&quot;?sort=type\&quot;&gt;type&lt;/a&gt;&lt;td&gt;&quot;;
    					
    						echo $header_sw;
    					echo &quot;
    					&lt;div style=\&quot;font-size:12px\&quot;&gt;&lt;table  border=\&quot;1px\&quot;&gt;&lt;tr&gt;&quot;;
    				if(strlen($_GET['id'])&gt;1) $n++;
    				for($i=0;$i&lt;$n;$i++){
    					if( !( (strlen($_GET['id'])&gt;1)&amp;&amp;($i==$n))){
    					 	 $row=$this-&gt;db-&gt;fetch_array();
    						$nasid=$row['id'];
    						
    					}
    					else{
    					  $nasid++;
    					 
    					}
    					
    					  	if($i==0) {
    					  		$nasid=$row['id'];
    					  		$nastemp=$nasid;
    							$temp_nas_ip=$row['nas_ip'];
    							$temp_name=$row['name'];
    							$temp_type=$row['type'];
    							$temp_id=$row['id'];
    							$temp_ports=$row['ports'];
    							$temp_version=$row['version'];
    					  		if(preg_match(&quot;/\bVersion/i&quot;,$row['version'])){
    									$temp_version=explode(&quot;Version&quot;,$row['version']);
    									$row['version']=$temp_version['0'];
    									$temp_version=$row['version'];
    								}
    					  	}
    					  	
    					    if($nastemp!=$nasid){
    							if($_GET['snmp']==&quot;true&quot;)
    								$sw_res=self::scan_sw_by_ip($temp_nas_ip);
    
    				      			  if( ($temp_ports&gt;0)&amp;&amp;($temp_ports&lt;100))
    				      			  	$n_of_ports=$temp_ports;
    				      			  else
    				      			  	$n_of_ports=48;
    
    								$c++;
    								if($c&gt;1){
    									$c=0;
    									$td_pre=&quot; border=\&quot;1px\&quot; &quot;;
    								}
    								else {
    									$td_pre=' ';
    								}
    								echo &quot;
    				      			
    				      			&lt;tr &quot;.$td_pre.&quot;&gt;
    				      				 &lt;td  rowspan=\&quot;2\&quot; nowrap=\&quot;nowrap\&quot; bgcolor=\&quot;#999999\&quot;&gt;
    								&lt;a href=\&quot;http://&quot;.$temp_nas_ip.&quot;\&quot;  target=\&quot;_blank\&quot;&gt;&quot;.$temp_name.&quot;&lt;/a&gt;
    									&lt;br&gt;&quot;.str_replace(&quot;Fast Ethernet Switch&quot;,&quot;&quot;,$temp_version).&quot;
    							&lt;/td&gt;
    							&lt;td rowspan=\&quot;2\&quot;&gt;
    								&lt;a href=\&quot;?sort=id&amp;amp;id=&quot;.$temp_id.&quot;\&quot; target=\&quot;_blank\&quot;&gt; &quot;.$temp_id.&quot;&lt;/a&gt;&lt;/td&gt;
    							&lt;td &quot;.$td_pre.&quot; rowspan=\&quot;2\&quot;&gt;
    								&lt;a href=\&quot;?sort=type&amp;amp;sub_type=&quot;.$temp_type.&quot;\&quot;&gt;
    										&quot;.$temp_type.&quot;
    								&lt;/a&gt;
    							&lt;/td&gt;&quot;;
    				      			$nastemp=$nasid;	
    								$header_ports='';
    				      			for($i=1;$i&lt;$n_of_ports+1;$i++){
    									
    				      				$header_ports.=&quot;&lt;td &quot;.$td_pre.&quot;  bgcolor=\&quot;#CCCCCC\&quot;&gt;&quot;.$i.&quot;&lt;/td&gt;&quot;;
    				      			}
    							
    				      			echo &quot;	&lt;tr &quot;.$td_pre.&quot;&gt;$header_ports&lt;/tr&gt;
    									&lt;tr&gt;
    				      					&lt;td&gt;&lt;/td&gt;
    									&lt;td&gt;&lt;/td&gt;
    									&lt;td&gt;&lt;/td&gt;	&quot;;
    				      			for($i=1;$i&lt;$n_of_ports+1;$i++){
    				      				if(strlen($ports[$i])&gt;0){
    									echo &quot;&lt;td&gt;&quot;.$ports[$i].&quot;&lt;/td&gt;&quot;;
    					      					
    				      				}
    				      				else{
    				      					echo &quot;&lt;td bgcolor=\&quot;#FFFF00\&quot;&gt; &lt;/td&gt;&quot;;
    				      				}
    				      				
    				      			}
    			      				echo &quot;&lt;/tr&gt;&quot;;
    			      				$ports='';
    			      				$ports=array();
    			      		}else{
    			      			
    							$temp_nas_ip=$row['nas_ip'];
    							$temp_name=$row['name'];
    							$temp_type=$row['type'];
    							$temp_id=$row['id'];
    							$temp_ports=$row['ports'];
    							$temp_version=$row['version'];
    			      			if(preg_match(&quot;/\bVersion/i&quot;,$row['version'])){
    									$temp_version=explode(&quot;Version&quot;,$row['version']);
    									$row['version']=$temp_version['0'];
    									$temp_version=$row['version'];
    								}
    			      		}
    
    
    					if(!(strlen($row['user'])&gt;0))
    							$row['user']=$row['mac'];
    					if($row['deposit']&gt;=0){
    						$ports[$row['port']].=&quot;&lt;a href=\&quot;http://admin/edit_user.php?uid=&quot;.$row['uid'].&quot;\&quot; target=\&quot;_blank\&quot; &gt;&quot;.$row['user'].&quot;&lt;/a&gt;&lt;br&gt;&quot;;	
    					}else{
    						$ports[$row['port']].=&quot;&lt;b&gt;&lt;a style=\&quot;color: red\&quot; href=\&quot;https://admin/edit_user.php?uid=&quot;.$row['uid'].&quot;\&quot; target=\&quot;_blank\&quot;&gt;&quot;.$row['user'].&quot;&lt;/a&gt;&lt;/b&gt;&lt;br&gt;&quot;;	
    					}
    				}
    				if($_GET['id']&gt;1){
    					switch($_GET['snmp']){
    					case &quot;true&quot;:
    						echo &quot;&lt;/tr&gt;
    						&lt;/table&gt;&lt;/div&gt;&quot;;
    						echo &quot;&lt;p&gt;&quot;.PAGE_MES_2.&quot;:&lt;/p&gt;
    						&lt;p&gt;	&quot;.PAGE_MES_3.&quot;:	$sw_res[type]&lt;/p&gt;
    						&lt;p&gt;	&quot;.PAGE_MES_4.&quot;	$sw_res[version]&lt;/p&gt;
    						&lt;p&gt;	&quot;.PAGE_MES_5.&quot;	$sw_res[ports]&lt;/p&gt;
    						&lt;p&gt;	Ip	$sw_res[ip]&lt;/p&gt;&quot;;
    					break;
    					default:
    						echo &quot;&lt;/tr&gt;
    						&lt;/table&gt;&lt;/div&gt;&quot;;
    						echo &quot;
    						&lt;p&gt;&lt;a href=\&quot;?sort=id&amp;amp;id=&quot;.$temp_id.&quot;&amp;amp;snmp=true\&quot;&gt;Get data by snmp&lt;/a&gt;
    						&lt;p&gt;&quot;.PAGE_MES_2.&quot;:&lt;/p&gt;
    						&lt;p&gt;	&quot;.PAGE_MES_3.&quot;:	$temp_type&lt;/p&gt;
    						&lt;p&gt;	&quot;.PAGE_MES_4.&quot;	&lt;/p&gt;
    						&lt;p&gt;	&quot;.PAGE_MES_5.&quot;	&lt;/p&gt;
    						&lt;p&gt;	Ip	$temp_nas_ip&lt;/p&gt;&quot;;
    					break;
    					}
    				}
    			}
    		
    		
    	}
    }
    ?&gt;</p></div>
    ";i:11;s:3645:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>
    &lt;!DOCTYPE html 
         PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
    &nbsp;
             &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot;&gt; 
            &lt;head&gt; 
    				&lt;title&gt;Skyhome&lt;/title&gt;
        	      	&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=windows-1251&quot; /&gt;
    				&lt;meta name=ROBOTS&quot; CONTENT=&quot;NOINDEX, NOFOLLOW&quot;&gt;
    				&lt;meta name=&quot;keywords&quot; content=&quot;Internet, РїСЂРѕРІР°Р№РґРµСЂ, РЎРєР°Р№С…РѕРј, Skyhome, UA-IX, РѕРїС‚РѕРІРѕР»РѕРєРЅРѕ&quot;&gt;
     				&lt;link rel=&quot;shortcut icon&quot; href=&quot;page/style/favicon.ico&quot; type=&quot;image/x-icon&quot;/&gt; 
    				&lt;script type=&quot;text/javascript&quot; src=&quot;style/jquery-1.3.1.min.js&quot;&gt;&lt;/script&gt;
    &nbsp;
    				&lt;script type=&quot;text/javascript&quot; src=&quot;style/ddaccordion.js&quot;&gt;
    				&lt;/script&gt;
    				&lt;script type=&quot;text/javascript&quot;&gt;
    &nbsp;
    &nbsp;
    				&lt;/script&gt;
    &nbsp;
    			&lt;link href=&quot;style/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;&lt;!--[if IE]&gt;
    			&lt;style type=&quot;text/css&quot;&gt; 
    			/* css fixes for all versions of IE */
    &nbsp;
    			.twoColLiqLtHdr #mainContent { zoom: 1; padding-top: 15px; }
    			/* the above proprietary zoom property gives IE the hasLayout it needs to avoid several bugs */
    			&lt;/style&gt;
    			&lt;![endif]--&gt;
    &lt;/head&gt;</pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php ?&gt;
    &lt;!DOCTYPE html 
         PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
          
             &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot;&gt; 
            &lt;head&gt; 
    				&lt;title&gt;Skyhome&lt;/title&gt;
        	      	&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=windows-1251&quot; /&gt;
    				&lt;meta name=ROBOTS&quot; CONTENT=&quot;NOINDEX, NOFOLLOW&quot;&gt;
    				&lt;meta name=&quot;keywords&quot; content=&quot;Internet, РїСЂРѕРІР°Р№РґРµСЂ, РЎРєР°Р№С…РѕРј, Skyhome, UA-IX, РѕРїС‚РѕРІРѕР»РѕРєРЅРѕ&quot;&gt;
     				&lt;link rel=&quot;shortcut icon&quot; href=&quot;page/style/favicon.ico&quot; type=&quot;image/x-icon&quot;/&gt; 
    				&lt;script type=&quot;text/javascript&quot; src=&quot;style/jquery-1.3.1.min.js&quot;&gt;&lt;/script&gt;
    				
    				&lt;script type=&quot;text/javascript&quot; src=&quot;style/ddaccordion.js&quot;&gt;
    				&lt;/script&gt;
    				&lt;script type=&quot;text/javascript&quot;&gt;
    
    				
    				&lt;/script&gt;
    
    			&lt;link href=&quot;style/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;&lt;!--[if IE]&gt;
    			&lt;style type=&quot;text/css&quot;&gt; 
    			/* css fixes for all versions of IE */
    			
    			.twoColLiqLtHdr #mainContent { zoom: 1; padding-top: 15px; }
    			/* the above proprietary zoom property gives IE the hasLayout it needs to avoid several bugs */
    			&lt;/style&gt;
    			&lt;![endif]--&gt;
    &lt;/head&gt;</p></div>
    ";i:12;s:417:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>
    &lt;/html&gt;</pre></td></tr></table><p class="theCode" style="display:none;">&lt;?php ?&gt;
    &lt;/html&gt;</p></div>
    ";i:13;s:4965:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;">#!/usr/bin/php
    <span style="color: #000000; font-weight: bold;">&lt;?php</span>
     <span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;engine.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000088;">$db</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> db_mysql<span style="color: #009900;">&#40;</span>HOST<span style="color: #339933;">,</span>USER<span style="color: #339933;">,</span>DB_PASS<span style="color: #339933;">,</span>DB<span style="color: #339933;">,</span>DEBUG_DB<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'$db obj is ok'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;br&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    &nbsp;
     <span style="color: #000088;">$db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SET_NAMES</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;utf8&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
     <span style="color: #000088;">$db_nibs</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> db_mysql<span style="color: #009900;">&#40;</span>HOST_NIBS<span style="color: #339933;">,</span>USER_NIBS<span style="color: #339933;">,</span>DB_NIBS_PASS<span style="color: #339933;">,</span>DB_NIBS<span style="color: #339933;">,</span>DEBUG_DB<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'$db_nibs obj is ok'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;br&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
     <span style="color: #666666; font-style: italic;">//$db_nibs-&gt;SET_NAMES(&quot;cp1251&quot;);</span>
     <span style="color: #666666; font-style: italic;">//$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);</span>
     <span style="color: #666666; font-style: italic;">//$db_nibs-&gt;SET_COLLATE(&quot;cp1251_general_ci&quot;);</span>
     <span style="color: #000088;">$db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SET_NAMES</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;utf8&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #000088;">$page</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> page<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$db</span><span style="color: #339933;">,&amp;</span><span style="color: #000088;">$db_nibs</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
     <span style="color: #000088;">$page</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">cron</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">#!/usr/bin/php
    &lt;?php
     include_once(&quot;engine.php&quot;);
      $db=new db_mysql(HOST,USER,DB_PASS,DB,DEBUG_DB);
     if(DEBUG_DB==&quot;true&quot;) echo '$db obj is ok'.&quot;&lt;br&gt;\n&quot;;
     
     $db-&gt;SET_NAMES(&quot;utf8&quot;);
     
     $db_nibs=new db_mysql(HOST_NIBS,USER_NIBS,DB_NIBS_PASS,DB_NIBS,DEBUG_DB);
     if(DEBUG_DB==&quot;true&quot;) echo '$db_nibs obj is ok'.&quot;&lt;br&gt;\n&quot;;
     //$db_nibs-&gt;SET_NAMES(&quot;cp1251&quot;);
     //$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);
     //$db_nibs-&gt;SET_COLLATE(&quot;cp1251_general_ci&quot;);
     $db_nibs-&gt;SET_NAMES(&quot;utf8&quot;);
     $page=new page(&amp;$db,&amp;$db_nibs);
     
     $page-&gt;cron();
     
    ?&gt;</p></div>
    ";i:14;s:8867:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="line_numbers"><pre>1
    2
    3
    4
    5
    6
    7
    8
    9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    </pre></td><td class="code"><pre class="php" style="font-family:monospace;">#!/usr/bin/php -q
    <span style="color: #000000; font-weight: bold;">&lt;?php</span> 
    <span style="color: #000088;">$path</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;/var/www/skmsw&quot;</span><span style="color: #339933;">;</span>
     <span style="color: #000088;">$ip</span><span style="color: #339933;">=</span><span style="color: #000088;">$argv</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'1'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">file_exists</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;/pid/&quot;</span><span style="color: #339933;">.</span><span style="color: #990000;">str_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;.&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    	<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;exist&quot;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
    <span style="color: #000088;">$f</span><span style="color: #339933;">=</span><span style="color: #990000;">fopen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;/pid/&quot;</span><span style="color: #339933;">.</span><span style="color: #990000;">str_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;.&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;w&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
    <span style="color: #990000;">fwrite</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$f</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;do&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
    <span style="color: #b1b100;">include_once</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;engine.php&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000088;">$db</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> db_mysql<span style="color: #009900;">&#40;</span>HOST<span style="color: #339933;">,</span>USER<span style="color: #339933;">,</span>DB_PASS<span style="color: #339933;">,</span>DB<span style="color: #339933;">,</span>DEBUG_DB<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'$db obj is ok'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;br&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
     	 <span style="color: #000088;">$db</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SET_NAMES</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;utf8&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
     <span style="color: #000088;">$db_nibs</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> db_mysql<span style="color: #009900;">&#40;</span>HOST_NIBS<span style="color: #339933;">,</span>USER_NIBS<span style="color: #339933;">,</span>DB_NIBS_PASS<span style="color: #339933;">,</span>DB_NIBS<span style="color: #339933;">,</span>DEBUG_DB<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>DEBUG_DB<span style="color: #339933;">==</span><span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'$db_nibs obj is ok'</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;br&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
     <span style="color: #666666; font-style: italic;">//$db_nibs-&gt;SET_NAMES(&quot;cp1251&quot;);</span>
     <span style="color: #666666; font-style: italic;">//$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);</span>
     <span style="color: #666666; font-style: italic;">//$db_nibs-&gt;SET_COLLATE(&quot;cp1251_general_ci&quot;);</span>
     <span style="color: #000088;">$db_nibs</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">SET_NAMES</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;utf8&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #000088;">$page</span><span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> page<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span><span style="color: #000088;">$db</span><span style="color: #339933;">,&amp;</span><span style="color: #000088;">$db_nibs</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #000088;">$page</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">cron_one_ip</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    &nbsp;
    &nbsp;
    <span style="color: #990000;">unlink</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$path</span><span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;/pid/&quot;</span><span style="color: #339933;">.</span><span style="color: #990000;">str_replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;.&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">,</span><span style="color: #000088;">$ip</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
    <span style="color: #009900;">&#125;</span>
     <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table><p class="theCode" style="display:none;">#!/usr/bin/php -q
    &lt;?php 
    $path=&quot;/var/www/skmsw&quot;;
     $ip=$argv['1'];
    if(file_exists($path.&quot;/pid/&quot;.str_replace(&quot;.&quot;,&quot;&quot;,$ip))){
    	echo &quot;exist&quot;;
    }
    else{
    $f=fopen($path.&quot;/pid/&quot;.str_replace(&quot;.&quot;,&quot;&quot;,$ip),&quot;w&quot;); 
    fwrite($f,&quot;do&quot;); 
    include_once(&quot;engine.php&quot;);
      $db=new db_mysql(HOST,USER,DB_PASS,DB,DEBUG_DB);
     if(DEBUG_DB==&quot;true&quot;) echo '$db obj is ok'.&quot;&lt;br&gt;\n&quot;;
     	 $db-&gt;SET_NAMES(&quot;utf8&quot;);
     
     $db_nibs=new db_mysql(HOST_NIBS,USER_NIBS,DB_NIBS_PASS,DB_NIBS,DEBUG_DB);
     if(DEBUG_DB==&quot;true&quot;) echo '$db_nibs obj is ok'.&quot;&lt;br&gt;\n&quot;;
     //$db_nibs-&gt;SET_NAMES(&quot;cp1251&quot;);
     //$db-&gt;SET_COLLATE(&quot;latin1_swedish_ci&quot;);
     //$db_nibs-&gt;SET_COLLATE(&quot;cp1251_general_ci&quot;);
     $db_nibs-&gt;SET_NAMES(&quot;utf8&quot;);
     $page=new page(&amp;$db,&amp;$db_nibs);
     $page-&gt;cron_one_ip($ip);
    
    
    
    unlink($path.&quot;/pid/&quot;.str_replace(&quot;.&quot;,&quot;&quot;,$ip)); 
    }
     ?&gt;</p></div>
    ";}
categories:
  - 4isp
  - billing
  - дополнения
tags:
  - Cisco
  - Dlink
  - netgear
  - Zyxel

---
## Мои скрипты мониторинга свичей по snmp

Я синхронизирую данные с базай FreeNIBS 1.x где беру данные;) Это можно пофиксить в принципе.
  
Так выглядит результат:
  


<div id="attachment_170" style="width: 1034px" class="wp-caption alignleft">
  <a href="http://b-comm.ru/wp-content/uploads/2011/02/SNMP-Dlink-3028.jpg"><img src="http://b-comm.ru/wp-content/uploads/2011/02/SNMP-Dlink-3028-1024x159.jpg" alt="SNMP Dlink 3028" title="SNMP Dlink 3028" width="1024" height="159" class="size-large wp-image-170" srcset="http://b-comm.ru/wp-content/uploads/2011/02/SNMP-Dlink-3028-1024x159.jpg 1024w, http://b-comm.ru/wp-content/uploads/2011/02/SNMP-Dlink-3028-300x46.jpg 300w, http://b-comm.ru/wp-content/uploads/2011/02/SNMP-Dlink-3028.jpg 1270w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>
  
  <p class="wp-caption-text">
    SNMP Dlink 3028
  </p>
</div>

В общем скрипт раз в х минут по крону скрипт сканирует свичи. Так же идёт синхронизация с базой в которой содержатся данные о пользователях их дипозитах и макадрессах.
  
**crontab:**<!--more-->

<pre lang="php" line="1">*/30 *  * * *   root   rm /var/www/skmsw/pid/*
*/5 *  * * *   root    /usr/bin/php -q /var/www/skmsw/cron.php  >/dev/null 2>1&
</pre>

<pre lang="sql" line="1">-- phpMyAdmin SQL Dump
-- version 3.3.9.2

-- Время создания: Фев 21 2011 г., 00:24
-- Версия сервера: 5.5.9
-- Версия PHP: 5.3.5

SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";

--
-- База данных: `skmsw`
--

-- --------------------------------------------------------

--
-- Структура таблицы `freenibs`
--

DROP TABLE IF EXISTS `freenibs`;
CREATE TABLE IF NOT EXISTS `freenibs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `mac` varchar(100) NOT NULL,
  `user` varchar(255) NOT NULL,
  `uid` int(11) NOT NULL,
  `deposit` double(16,3) NOT NULL,
  `en` tinyint(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `mac` (`mac`)
) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=10869793 ;

-- --------------------------------------------------------

--
-- Структура таблицы `mac`
--

DROP TABLE IF EXISTS `mac`;
CREATE TABLE IF NOT EXISTS `mac` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `port` int(11) NOT NULL,
  `mac` varchar(255) NOT NULL,
  `sw_id` int(11) NOT NULL,
  `date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `port` (`port`,`mac`,`sw_id`)
) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=5293 ;

-- --------------------------------------------------------

--
-- Структура таблицы `packets`
--

DROP TABLE IF EXISTS `packets`;
CREATE TABLE IF NOT EXISTS `packets` (
  `gid` int(11) NOT NULL,
  `name` varchar(255) NOT NULL,
  `credit` float(16,4) NOT NULL,
  `activated` smallint(6) NOT NULL DEFAULT '1',
  `month_traffic_limit` float(25,6) NOT NULL,
  `framed_ip` varchar(255) NOT NULL,
  `     framed_mask` varchar(40) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- --------------------------------------------------------

--
-- Структура таблицы `stat`
--

DROP TABLE IF EXISTS `stat`;
CREATE TABLE IF NOT EXISTS `stat` (
  `mac_n` bigint(255) NOT NULL,
  `login_n` bigint(255) NOT NULL,
  `sw_n` bigint(255) NOT NULL,
  `all_traf` float(30,3) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- --------------------------------------------------------

--
-- Структура таблицы `sw`
--

DROP TABLE IF EXISTS `sw`;
CREATE TABLE IF NOT EXISTS `sw` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL DEFAULT 'sw',
  `type_res` varchar(25) NOT NULL DEFAULT 'switch',
  `ip` bigint(255) NOT NULL,
  `parent_sw_id` int(11) NOT NULL,
  `snmppass` varchar(100) NOT NULL DEFAULT 'public',
  `snmpversion` varchar(5) NOT NULL DEFAULT '1',
  `snmpuser` varchar(100) NOT NULL,
  `type` varchar(100) NOT NULL,
  `model` varchar(255) NOT NULL,
  `ports` int(11) NOT NULL,
  `addr` varchar(255) NOT NULL,
  `disallow_ports` varchar(255) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=256 ;
</pre>

Примеры данных:

<pre lang="sql" line="1">INSERT INTO `freenibs` VALUES(373, '00:e0:4c:75:00:48', 'olya18', 415, 7.690, 0);
INSERT INTO `freenibs` VALUES(7855579, '40:61:86:2c:89:d8', '192.168.1.100', 0, -2048.000, 0);
INSERT INTO `sw` VALUES(1, 'sw', 'switch', 2886730242, 0, 'public', '1', '', 'dlink', ' D-Link DES-3028 Fast Ethernet Switch', 24, '', '25,26,27,28');

</pre>

index.php:

<pre lang="php" line="1"><?php
 include_once("engine.php");
 $db=new db_mysql(HOST,USER,DB_PASS,DB,DEBUG_DB);
 if(DEBUG_DB=="true") echo '$db obj is ok'."<br>\n";
 //$db->SET_NAMES("cp1251");
 //$db->SET_COLLATE("latin1_swedish_ci");
 $db->SET_COLLATE("cp1251_general_ci");
 
 $db_nibs=new db_mysql(HOST_NIBS,USER_NIBS,DB_NIBS_PASS,DB_NIBS,DEBUG_DB);
  if(DEBUG_DB=="true") echo '$db_nibs obj is ok'."

<br />\n";
 //$db_nibs->SET_NAMES("cp1251");
 //$db->SET_COLLATE("latin1_swedish_ci");
 $db_nibs->SET_COLLATE("cp1251_general_ci");
 
 $page=new page(&$db,&$db_nibs);
 if(DEBUG_DB=="true") echo '$page obj is ok'."<br />\n";
 switch($_GET['page']){
 	case "sw":
 		break;
 	default:
 		$page->top();
 		$page->show_all_sw();
 		$page->bottom();
 		break;
 }
 
?>
</pre>

engine.php:

<pre lang="php" line="1"><?php
@include_once("define.php");
include_once("PHPTelnet.php");
include_once("telnet.class.php");
if(DEBUG_DB==true){
	include_once("db.php");
	include_once("page.php");	
}
else{
	@include_once("db.php");
	@include_once("page.php");	
}

function quote_smart($value)
{
    // если magic_quotes_gpc включена - используем stripslashes
    if (get_magic_quotes_gpc()) {
        $value = stripslashes($value);
    }
    // Если переменная - число, то экранировать её не нужно
    // если нет - то окружем её кавычками, и экранируем
    if (!is_numeric($value)) {
        $value = mysql_real_escape_string($value);
    }
    return $value;
}
function crypt_password($clear,$cryptscheme, $salt = '')
    {
        

        if ($cryptscheme == 'sha')
        {
            $hash = sha1($clear);
            $cryptedpass = '{SHA}' . base64_encode(pack('H*', $hash));
        }
        else
        {
            if ($salt != '')
            {
                if ($cryptscheme == 'des')
                {
                    $salt = substr($salt, 0, 2);
                }
                else
                if ($cryptscheme == 'md5')
                {
                    $salt = substr($salt, 0, 12);
                }
                else
                {
                    $salt = '';
                }
            }
            $cryptedpass = crypt($clear, $salt);
        }

        return $cryptedpass;
    }
	function dec_hex($int){
	    $res=dechex($int);
	    if (strlen($res)==1) $res='0'.$res;
	    $res=strtoupper($res);
	    return $res;
	}
    function snmptable($host, $community, $oid) {
    // TODO: get original state and restore at bottom
    snmp_set_oid_numeric_print(TRUE);
    snmp_set_quick_print(TRUE);
    snmp_set_enum_print(TRUE);

    $retval = array();
    $raw = snmprealwalk($host, $community, $oid);
    if (count($raw) == 0) return ($retval); // no data
   
    $prefix_length = 0;
    $largest = 0;
    foreach ($raw as $key => $value) {
        if ($prefix_length == 0) {
            // don't just use $oid's length since it may be non-numeric
            $prefix_elements = count(explode('.',$oid));
            $tmp = '.' . strtok($key, '.');
            while ($prefix_elements > 1) {
                $tmp .= '.' . strtok('.');
                $prefix_elements--;
            }
            $tmp .= '.';
            $prefix_length = strlen($tmp);
        }
        $key = substr($key, $prefix_length);
        $index = explode('.', $key, 2);
        isset($retval[$index[1]]) or $retval[$index[1]] = array();
        if ($largest &lt; $index[0]) $largest = $index[0];
        $retval[$index[1]][$index[0]] = $value;
    }

    if (count($retval) == 0) return ($retval); // no data

    // fill in holes and blanks the agent may "give" you
    foreach($retval as $k => $x) {
        for ($i = 1; $i &lt;= $largest; $i++) {
        if (! isset($retval[$k][$i])) {
                $retval[$k][$i] = '';
            }
        }
        ksort($retval[$k]);
    }
    return($retval);
}

?>
</pre>

define.php:

<pre lang="php" line="1"><?php
	define("DEBUG_DB","false");
	
    define("ADMIN_MAIL","valeranew@ukr.net");
    define("DB","skmsw");
    define("USER","skmsw");
    define("HOST","localhost");
    define("DB_PASS","password");
    
    define("DB_NIBS","freenibs");
    define("USER_NIBS","freenibs");
    define("HOST_NIBS","localhost");
    define("DB_NIBS_PASS","password");
  
    define("COMUNITY_READ","public");
    define("COMUNITY_READ2","public_snmp");
    define("COMUNITY_DEF_DLINK_READ","public");
    /* OID  нормально работает, но приколы вывода:
     * smc: SMC Networks SMC8624T 1
     * dlink : D-Link DES-3026 Fast Ethernet Switch  (D-Link DES-3016 Fast Ethernet Switch)
     * dell :  Ethernet Stackable Switching System  
          PowerConnect 3348 
          			юзать=>"OID_DELL_sysDescr" 
     * extreem : Summit200-48 - Version 7.3e.2 (Build 4) by Release_Master 02/24/05 19:20:09 
     * */
   define("OID_sysDescr",".1.3.6.1.2.1.1.1"); 
   define("OID_DELL_sysDescr",".1.3.6.1.2.1.1.5.0");
   define("OID_DELL_enterprises",".1.3.6.1.4.1.674");

  	
  define("OID_standart_ports",".1.3.6.1.2.1.2.1.0");
  define("OID_dell_ports",".1.3.6.1.2.1.2.2.1.7"); /* Включают и вланы IF-MIB::ifAdminStatus.46 = INTEGER: up(1) */
  define("OID_dell_ports_descr",".1.3.6.1.2.1.2.2.1.2");  	
  define("OID_dell_ports_speed",".1.3.6.1.2.1.2.2.1.5");

  
  define("OID_mac_on_ports",".1.3.6.1.2.1.17.7.1.2.2.1.2");
  define("OID_cisco_mac_on_ports",".1.3.6.1.2.1.17.4.3.1.1");
  define("OID_ports_updown",".1.3.6.1.2.1.2.2.1.8");
  
  
  
  define("PAGE_MES_1","Данные не доступны");
  define("PAGE_MES_2","Данные o свиче");
  define("PAGE_MES_3","Тип");
  define("PAGE_MES_4","Версия");
  define("PAGE_MES_5","Количество портов");
?>

</pre>

PHPTelnet.php:

<pre lang="php" line="1"><?php
/*
PHPTelnet 1.1.1
by Antone Roundy
adapted from code found on the PHP website
public domain
*/

class PHPTelnet {
	var $show_connect_error=1;

	var $use_usleep=0;	// change to 1 for faster execution
		// don't change to 1 on Windows servers unless you have PHP 5
	var $sleeptime=125000;
	var $loginsleeptime=1000000;

	var $fp=NULL;
	var $loginprompt;

	var $conn1;
	var $conn2;
	
	/*
	0 = success
	1 = couldn't open network connection
	2 = unknown host
	3 = login failed
	4 = PHP version too low
	*/
	function Connect($server,$user,$pass) {
		$rv=0;
		$vers=explode('.',PHP_VERSION);
		$needvers=array(4,3,0);
		$j=count($vers);
		$k=count($needvers);
		if ($k<$j) $j=$k;
		for ($i=0;$i<$j;$i++) {
			if (($vers[$i]+0)>$needvers[$i]) break;
			if (($vers[$i]+0)&lt;$needvers[$i]) {
				$this->ConnectError(4);
				return 4;
			}
		}
		
		$this->Disconnect();
		
		if (strlen($server)) {
			if (preg_match('/[^0-9.]/',$server)) {
				$ip=gethostbyname($server);
				if ($ip==$server) {
					$ip='';
					$rv=2;
				}
			} else $ip=$server;
		} else $ip='127.0.0.1';
		
		if (strlen($ip)) {
			if ($this->fp=fsockopen($ip,23)) {
				fputs($this->fp,$this->conn1);
				$this->Sleep();
				
				fputs($this->fp,$this->conn2);
				$this->Sleep();
				$this->GetResponse($r);
				$r=explode("\n",$r);
				$this->loginprompt=$r[count($r)-1];

				fputs($this->fp,"$user\r");
				$this->Sleep();

				fputs($this->fp,"$pass\r");
				if ($this->use_usleep) usleep($this->loginsleeptime);
				else sleep(1);
				$this->GetResponse($r);
				$r=explode("\n",$r);
				if (($r[count($r)-1]=='')||($this->loginprompt==$r[count($r)-1])) {
					$rv=3;
					$this->Disconnect();
				}
			} else $rv=1;
		}
		
		if ($rv) $this->ConnectError($rv);
		return $rv;
	}
	
	function Disconnect($exit=1) {
		if ($this->fp) {
			if ($exit) $this->DoCommand('exit',$junk);
			fclose($this->fp);
			$this->fp=NULL;
		}
	}

	function DoCommand($c,&$r) {
		if ($this->fp) {
			fputs($this->fp,"$c\r");
			$this->Sleep();
			$this->GetResponse($r);
			$r=preg_replace("/^.*?\n(.*)\n[^\n]*$/","$1",$r);
		}
		return $this->fp?1:0;
	}
	
	function GetResponse(&$r) {
		$r='';
		do { 
			$r.=fread($this->fp,1000);
			$s=socket_get_status($this->fp);
		} while ($s['unread_bytes']);
	}
	
	function Sleep() {
		if ($this->use_usleep) usleep($this->sleeptime);
		else sleep(1);
	}
	
	function PHPTelnet() {
		$this->conn1=chr(0xFF).chr(0xFB).chr(0x1F).chr(0xFF).chr(0xFB).
			chr(0x20).chr(0xFF).chr(0xFB).chr(0x18).chr(0xFF).chr(0xFB).
			chr(0x27).chr(0xFF).chr(0xFD).chr(0x01).chr(0xFF).chr(0xFB).
			chr(0x03).chr(0xFF).chr(0xFD).chr(0x03).chr(0xFF).chr(0xFC).
			chr(0x23).chr(0xFF).chr(0xFC).chr(0x24).chr(0xFF).chr(0xFA).
			chr(0x1F).chr(0x00).chr(0x50).chr(0x00).chr(0x18).chr(0xFF).
			chr(0xF0).chr(0xFF).chr(0xFA).chr(0x20).chr(0x00).chr(0x33).
			chr(0x38).chr(0x34).chr(0x30).chr(0x30).chr(0x2C).chr(0x33).
			chr(0x38).chr(0x34).chr(0x30).chr(0x30).chr(0xFF).chr(0xF0).
			chr(0xFF).chr(0xFA).chr(0x27).chr(0x00).chr(0xFF).chr(0xF0).
			chr(0xFF).chr(0xFA).chr(0x18).chr(0x00).chr(0x58).chr(0x54).
			chr(0x45).chr(0x52).chr(0x4D).chr(0xFF).chr(0xF0);
		$this->conn2=chr(0xFF).chr(0xFC).chr(0x01).chr(0xFF).chr(0xFC).
			chr(0x22).chr(0xFF).chr(0xFE).chr(0x05).chr(0xFF).chr(0xFC).chr(0x21);
	}
	
	function ConnectError($num) {
		if ($this->show_connect_error) switch ($num) {
		case 1: echo '

<br />[PHP Telnet] <a href="http://www.geckotribe.com/php-telnet/errors/fsockopen.php">Connect failed: Unable to open network connection</a><br />'; break;
		case 2: echo '<br />[PHP Telnet] <a href="http://www.geckotribe.com/php-telnet/errors/unknown-host.php">Connect failed: Unknown host</a><br />'; break;
		case 3: echo '<br />[PHP Telnet] <a href="http://www.geckotribe.com/php-telnet/errors/login.php">Connect failed: Login failed</a><br />'; break;
		case 4: echo '<br />[PHP Telnet] <a href="http://www.geckotribe.com/php-telnet/errors/php-version.php">Connect failed: Your server\'s PHP version is too low for PHP Telnet</a><br />'; break;
		}
	}
}

return;
?>

</pre>

telnet.class.php:

<pre lang="php" line="1"><?php
/*
$Id: telnet.class.php,v 1.2 2004/03/22 10:01:35 mb Exp $

Originally written by Marc Ennaji (in french),
modified by Matthias Blaser <mb@adfinis.ch>

- translated most function- and variable names from french to english
- added get_buffer-method to get results of the last command
  sent to server
- added hack to get socket_strerror working on old systems

You can find the original class which this translation is based on
on this url: http://px.sklar.com/code.html?id=634

The original class includes a small documentation about using it
in your own applications, but be aware, all functions are in french there, this
one is partly translated.
*/

// hack to get socket_strerror working on old systems
if(!function_exists("socket_strerror")){
	function socket_strerror($sh){
		if(function_exists("strerror")){
			return strerror($sh);
		} else {
			return false;
		}
	}
}

// telnet class
define ("TELNET_ERROR", 0);
define ("TELNET_OK", 1);
define ("TELNET_ASK_CONFIRMATION", 2);
define ("LIBELLE_CONFIRMATION", "[confirm]");

class telnet {

	var $socket  = NULL;
	var $host = "";
	var $port = "23";
	var $error = "";
	var $codeError = "";
	var $prompt = "\$ ";
	var $log = NULL;  // file handle
	var $repertoireLog= "";
	var $nomFichierLog = "";
	var $test;

	var $buffer = "";

	//------------------------------------------------------------------------
	function connect(){
		$this->socket = fsockopen($this->host,$this->port);

		if (!$this->socket){
			$this->error = "unable to open a telnet connection: " . socket_strerror($this->socket) . "\n";
			return TELNET_ERROR;
		}

		socket_set_timeout($this->socket,1,0);
		return TELNET_OK;
	}

	//------------------------------------------------------------------------
	function read_to($chaine){
		$NULL = chr(0);
		$IAC = chr(255);
		$buf = '';

		if (!$this->socket){
			$this->error = "telnet socket is not open";
			return TELNET_ERROR;
		}

		while (1){
			$c = $this->getc();

			if ($c === false){
			 // plus de caracteres a lire sur la socket
				if ($this->contientErreur($buf)){
					return TELNET_ERROR;
				}

				$this->error = " Couldn't find the requested : '" . $chaine . "', it was not in the data returned from server : '" . $buf . "'" ;
				$this->logger($this->error);
				return TELNET_ERROR;
			}

			if ($c == $NULL || $c == "\021"){
				continue;
			}

			if ($c == $IAC){
				// Interpreted As Command
				$c = $this->getc();

				if ($c != $IAC){
					// car le 'vrai' caractere 255 est doublé pour le differencier du IAC
					if (! $this->negocierOptionTelnet($c)){
						return TELNET_ERROR;
					} else {
						continue;
					}
				}

			}

			$buf .= $c;

			// append current char to global buffer
			$this->buffer .= $c;

			// indiquer à l'utilisateur de la classe qu'il a une demande de confirmation
			if (substr($buf,strlen($buf)-strlen(LIBELLE_CONFIRMATION)) == LIBELLE_CONFIRMATION){
				$this->logger($this->getDernieresLignes($buf));
				return TELNET_ASK_CONFIRMATION;
			}

			if ((substr($buf,strlen($buf)-strlen($chaine))) == $chaine){
				// on a trouve la chaine attendue

				$this->logger($this->getDernieresLignes($buf));

				if ($this->contientErreur($buf)){
					return TELNET_ERROR;
				} else {
					return TELNET_OK;
				}
			}
		}
	}

	//------------------------------------------------------------------------
	function getc(){
		return fgetc($this->socket);
	}

	//------------------------------------------------------------------------
	function get_buffer(){
		$buf = $this->buffer;

		// cut last line (is always prompt)
		$buf = explode("\n", $buf);
		unset($buf[count($buf)-1]);
		$buf = join("\n",$buf);
		return trim($buf);
	}

	//------------------------------------------------------------------------
	function negocierOptionTelnet($commande){
		// on negocie des options minimales

		$IAC = chr(255);
		$DONT = chr(254);
		$DO = chr(253);
		$WONT = chr(252);
		$WILL = chr(251);

		if (($commande == $DO) || ($commande == $DONT)){
			$opt = $this->getc();
			//echo "wont ".ord($opt)."\n";
			fwrite($this->socket,$IAC.$WONT.$opt);
		} else if (($commande == $WILL) || ($commande == $WONT)) {
			$opt = fgetc($this->socket);
			//echo "dont ".ord($opt)."\n";
			fwrite($this->socket,$IAC.$DONT.$opt);
		} else {
			$this->error = "Error : unknown command ".ord($commande)."\n";
			return false;
		}

		return true;
	}

	//------------------------------------------------------------------------
	function write($buffer, $valeurLoggee = "", $ajouterfinLigne = true){

		// clear buffer from last command
		$this->buffer = "";

		if (! $this->socket){
			$this->error = "telnet socket is not open";
			return TELNET_ERROR;
		}

		if ($ajouterfinLigne){
			$buffer .= "\n";
		}

		if (fwrite($this->socket,$buffer) &lt; 0){
			$this->error = "error writing to socket";
			return TELNET_ERROR;
		}

		if ($valeurLoggee != ""){
			// cacher les valeurs confidentielles dans la log (mots de passe...)
			$buffer = $valeurLoggee . "\n";
		}

		if (! $ajouterfinLigne){
			// dans la log (mais pas sur la socket), rajouter tout de meme le caractere de fin de ligne
			$buffer .= "\n";
		}

		$this->logger("> " .$buffer);

		return TELNET_OK;
	}

	//------------------------------------------------------------------------
	function disconnect(){
		if ($this->socket){
			if (! fclose($this->socket)){
				$this->error = "error while closing telnet socket";
				return TELNET_ERROR;
			}

			$this->socket = NULL;
		}

		$this->setLog(false,"");
		return TELNET_OK;
	}

	//------------------------------------------------------------------------
	function contientErreur($buf){
		$messagesErreurs[] = "nvalid";       // Invalid input, ...
		$messagesErreurs[] = "o specified";  // No specified atm, ...
		$messagesErreurs[] = "nknown";       // Unknown profile, ...
		$messagesErreurs[] = "o such file or directory"; // sauvegarde dans un repertoire inexistant
		$messagesErreurs[] = "llegal";       // illegal file name, ...

		foreach ($messagesErreurs as $erreur){
			if (strpos ($buf, $erreur) === false)
				continue;

				// une erreur est détectée
				$this->error =  "Un message d'erreur a été détecté dans la réponse de l'hôte distant : " .
					"

<BR /><BR />" . $this->getDernieresLignes($buf,"<BR />") . "<BR />";

				return true;
			}

		return false;
	}

	//------------------------------------------------------------------------
	function wait_prompt(){
		return $this->read_to($this->prompt);
	}

	//------------------------------------------------------------------------
	function set_prompt($s){
		$this->prompt = $s;
		return TELNET_OK;
	}

	//------------------------------------------------------------------------
	function set_host($s){
		$this->host = $s;
	}

	//------------------------------------------------------------------------
	function set_port($s){
		$this->port = $s;
	}

	//------------------------------------------------------------------------
	function get_last_error(){
		return $this->error;
	}

	//------------------------------------------------------------------------
	function setLog($activerLog, $traitement){

		if ($this->log && $activerLog){
			return TELNET_OK;
		}

		if ($activerLog){
			$this->repertoireLog =  "/log/" . date("m");

			// repertoire mensuel inexistant ?
			if (! file_exists($this->repertoireLog)){
				if (mkdir($this->repertoireLog, 0700) === false){
					$this->error = "Impossible de créer le repertoire de log " .  $this->repertoireLog;
					return TELNET_ERROR;
				}
			}

			global $HTTP_SERVER_VARS;

			$this->nomFichierLog = 	date("d") . "_" .
				date("H:i:s") . "_" .

			$traitement . "_" .
				$HTTP_SERVER_VARS["PHP_AUTH_USER"]
				. ".log";

			$this->log = fopen($this->repertoireLog . "/" . $this->nomFichierLog,"a");

			if (empty($this->log)){
				$this->error = "Impossible de créer le fichier de log " . $this->nomFichierLog;
				return TELNET_ERROR;
			}

			$this->logger("----------------------------------------------\r\n");
			$this->logger("Début de la log de l'utilisateur " . $HTTP_SERVER_VARS["PHP_AUTH_USER"] .
				", adresse IP " . $HTTP_SERVER_VARS["REMOTE_ADDR"] . "\r\n");

			$this->logger("Connexion telnet sur " . $this->host . ", port " . $this->port . "\r\n");
			$this->logger("Date : " . date("d-m-Y").  "  à " . date("H:i:s") . "\r\n");
			$this->logger("Type de traitement effectué : " . $traitement . "\r\n");
			$this->logger("----------------------------------------------\r\n");
			return TELNET_OK;

		} else {
			if ($this->log){
				$this->logger("----------------------------------------------\r\n");
				$this->logger("Fin de la log\r\n");

				fflush($this->log);

				if (! fclose($this->log)){
					$this->error = "erreur a la fermeture du fichier de log";
					return TELNET_ERROR;
				}

				$this->log = NULL;
			}

			return TELNET_OK;
		}
	}

	//------------------------------------------------------------------------
	function logger($s){
		if ($this->log){
			fwrite($this->log, $s);
		}
	}

	//------------------------------------------------------------------------
	function getDernieresLignes($s, $separateur="\n"){
		// une reponse telnet contient (en principe) en premiere ligne l'echo de la commande utilisateur.
		// cette methode renvoie tout sauf la premiere ligne, afin de ne pas polluer les logs telnet

		$lignes = split("\n",$s);
		$resultat = "";
		$premiereLigne = true;

		while(list($key, $data) = each($lignes)){
			if ($premiereLigne){
				$premiereLigne = false;
			} else {
				if ($data != ""){
					$resultat .= $data . $separateur;
				}
			}
		}

		$resultat == substr($resultat,strlen($resultat)-1); // enlever le dernier caractere de fin de ligne

		return $resultat;
	}

	//------------------------------------------------------------------------
}   //    Fin de la classe
?>

</pre>

db.php:

<pre lang="php" line="1"><?php

class db_mysql{
    protected $query;
	protected $res;
    public $num;
    protected $link;
    protected $debug;
    protected $collation;
    protected $collate;
    protected $host;
    protected $user;
    protected $passw;
    protected $db;
    protected $set_force_featch;
        
    public function  __construct ($HOST,$USER,$PASSW,$DB)
        {
                $this->query=NULL;
                self::set_debug(false);
                self::set_force_featch(true);
                self::init($HOST,$USER,$PASSW,$DB,false);
        }

		function __destruct()
		{
					@mysql_close($this->link); //	    @self::close_db();	    
		}
		
		public function set_debug($d)	{
					if(is_bool($d)){
						$this->debug=$d;
					}
					else{
						$this->debug=false;
					}
		}
				
		public function set_force_featch($d){
				if(is_bool($d))	{
						$this->set_force_featch=$d;	
				}
				else	{
						$this->set_force_featch=true;
				}
		}
						
		public function SET_NAMES($names="utf8"){
			$this->collation="SET NAMES ".$names;
			self::query($this->collation);
		}

		public function SET_COLLATE($names="utf8_general_ci"){
			$this->collate="SET COLLATE ".$names;
			self::query($this->collation);
		}
        public function  init($HOST,$USER,$PASSW,$DB,$init_collation_setup=false){
	        	if(!is_bool($init_collation_setup))	{
						$init_collation_setup=false;	
				}
				self::set_host($HOST);
                self::set_user($USER);
                self::set_passw($PASSW);
                self::set_db($DB);
                $this->query=NULL;
                if($this->debug==false){
                		$this->link=@mysql_connect($this->host,$this->user, $this->passw)or die(ERR1);
                		@mysql_select_db($this->db,$this->link) or die(ERR2);
                }
                else
                {
                	$this->link=@mysql_connect($this->host,$this->user, $this->passw)or die(mysql_error());
                	mysql_select_db($this->db,$this->link) or die(mysql_error());
                }
                
				if($init_collation_setup==true){
						self::query($this->collation);
				}
        }

        function connect(){
                $this->query=NULL;
                //$this->ar=array();
                                
                if($this->debug==false){
                		$this->link=@mysql_connect($this->host,$this->user, $this->passw)or die(ERR1);
                		@mysql_select_db($this->db,$this->link) or die(ERR2);
                }
                else
                {
                	$this->link=mysql_connect($this->host,$this->user, $this->passw)or die(mysql_error());
                	mysql_select_db($this->db,$this->link) or die(mysql_error());
                }

        }

        public function set_host($host){	$this->host=$host;	}
        public function set_user($user){	$this->user=$user;	}
        public function set_passw($passw){	$this->passw=$passw;	}
        public function set_db($db){	$this->db=$db;	}
        public function  query($q){
        	if($this->set_force_featch==true)
        	{
        		$this->query=@mysql_db_query($this->db,$q,$this->link);
        	}
        	else
        	{
	        		if($this->debug==false){
		        				$this->query=@mysql_db_query($this->db,$q,$this->link) or die(ERR3);	
	        		}
	        		else
	        		{
		        			$this->query=mysql_db_query($this->db,$q,$this->link) or die(mysql_error());
	        		}
        	}
                
        }
        
        public function num_rows(){
             	   $this->num=mysql_num_rows($this->query);
                	return $this->num;
        }
        public function  fetch_row(){
		        if($this->set_force_featch==true)
		        	{
		        		$this->res=@mysql_fetch_row($this->query);
		        	}
		        	else
		        	{
			        		if($this->debug==false){
				        				$this->res=@mysql_fetch_row($this->query) or die(ERR4);	
			        		}
			        		else
			        		{
				        			$this->res=mysql_fetch_row($this->query) or die(mysql_error());
			        		}
		        	}
                return $this->res;
        }
        public function  fetch_array(){
        	
        	
        		   if($this->set_force_featch==true)
		        	{
		        		$this->res=mysql_fetch_array($this->query);
		        	}
		        	else
		        	{
			        		if($this->debug==false){
									$this->res=@mysql_fetch_array($this->query) or die(ERR5);	
			        		}
			        		else
			        		{
				        			$this->res=mysql_fetch_array($this->query) or die(mysql_error());
			        		}
		        	}
                return $this->res;
        }

        public function db_select()
        {
                    		if($this->debug==false){
									@mysql_select_db($this->db,$this->link) or die(ERR2);	
			        		}
			        		else
			        		{
				        			mysql_select_db($this->db,$this->link) or die(mysql_error());
			        		}
        }
	public function free_result()
	{
		mysql_free_result($this->res);
	}
	public function mysql_error(){
		return mysql_error($this->link);
	}

	public function close_db()
	{
        if($this->debug==false){
					@mysql_close($this->link)or die(ERR6);	
		}
		else
		{
					mysql_close($this->link)or die(mysql_error());
		}
	}

}
?>

</pre>

page.php:

<pre lang="php" line="1"><?php 
class page{
	protected $db;
	protected $db_nibs;
	protected $telnet;
	protected $result_telnet_connect;
	protected $sw_type;
	public function __construct (&#038;$db,&#038;$db_nibs){
			$this->db=&$db;
			$this->db_nibs=&$db_nibs;
	}
	public function top(){ 
			@include_once("pages/top.php"); 
	}
	public function bottom(){ 
			@include_once("pages/bottom.php"); 
	}

	public function telnet_disconnect(){ $this->telnet->Disconnect(); }
	public function telnet($ip,$login,$pass){
		$this->telnet=new PHPTelnet();
		$this->telnet->show_connect_error=0;

		// if the first argument to Connect is blank,
		// PHPTelnet will connect to the local host via 127.0.0.1
		$this->result_telnet_connect = $this->telnet->Connect($ip,$login,$pass);
		
		switch ($this->result_telnet_connect) {
		case 0:
		//$this->telnet->DoCommand('enter command here', $result);
		// NOTE: $result may contain newlines
		//echo $result;
		//$this->telnet->DoCommand('another command', $result);
		//echo $result;
		// say Disconnect(0); to break the connection without explicitly logging out
		
			return true;
		break;
		case 1:
		echo '[PHP Telnet] Connect failed: Unable to open network connection';
		break;
		case 2:
		echo '[PHP Telnet] Connect failed: Unknown host';
		break;
		case 3:
		echo '[PHP Telnet] Connect failed: Login failed';
		break;
		case 4:
		echo '[PHP Telnet] Connect failed: Your PHP version does not support PHP Telnet';
		break;
		}
		return false;
	}
	public function initial_config_sw($ip){
	}
	public function initial_extreme_config_sw($ip){
		//delete vlan Mac
		
	}

	public function save_current_sw_config(){
	}
	public function save_extreme_current_sw_config(){
		$this->telnet->DoCommand("save", $this->result_telnet_connect);
		$this->telnet->DoCommand("yes", $this->result_telnet_connect);
		$this->telnet->DoCommand("
", $this->result_telnet_connect);
	}
	/* $ports_tagged=1,2,3,4,5.... */
	public function create_vlan($vlanid,$ports_tagged,$ports_untagged,$debug=false){
		switch($this->sw_type){
			case "dlink":
			break;
			case "dell":
			break;
			case "extreme":
				self::create_extreem_vlan($vlanid,$ports_tagged,$ports_untagged,$debug);
			break;
		}
		
	}
	public function create_extreem_vlan($vlanid,$ports_tagged,$ports_untagged,$debug=false){
	if($debug==true){
		echo "create vlan vlan$vlanid\n";
		echo "configure vlan vlan$vlanid tag $vlanid\n";
		echo "configure vlan vlan$vlanid add ports  $ports_tagged tagged\n";
		echo "configure vlan vlan$vlanid add ports  $ports_untagged untagged\n";
	}
	$this->telnet->DoCommand("create vlan vlan$vlanid", $this->result_telnet_connect);
			//create vlan vlan$vlanid
	$this->telnet->DoCommand("configure vlan vlan$vlanid tag $vlanid", $this->result_telnet_connect);

	$this->telnet->DoCommand("configure vlan vlan$vlanid add ports  $ports_tagged tagged", $this->result_telnet_connect);
	
			//configure vlan vlan$vlanid add ports  $ports_tagged tagged
	$this->telnet->DoCommand("configure vlan vlan$vlanid add ports  $ports_untagged untagged", $this->result_telnet_connect);
	
			//configure vlan vlan$vlanid add ports  $ports_untagged untagged
	}

	public function create_dell_vlan($vlanid,$ports_tagged,$ports_untagged,$debug=false){
	if($debug==true){
		echo "configure\n";
		echo "vlan database\n";
		echo "vlan $vlanid\n";
		echo "exit\n";
	

	}

	/*$this->telnet->DoCommand("configure", $this->result_telnet_connect);
	$this->telnet->DoCommand("vlan database", $this->result_telnet_connect);
	$this->telnet->DoCommand("vlan $vlanid", $this->result_telnet_connect);
	$this->telnet->DoCommand("exit", $this->result_telnet_connect);
	*/
	 $script = new telnet; 
	
	$ar_of_ports_tagged=explode(",",$ports_tagged);
	$c=0;
		foreach($ar_of_ports_tagged as $port){
			if(is_numeric($port)&&($port>0)){
				
				if($c==0)
					$port_line="1/e".$port.",";
				else
					$port_line=",1/e".$port."";
				$c++;
			}
		}
		//exist any ports
		if($c>0){
			
			//$this->telnet->DoCommand("interface range ethernet $port_line", $this->result_telnet_connect);
			$this->telnet->DoCommand("switchport access vlan $vlanid", $this->result_telnet_connect);
		}
	}


	public function delete_vlan($vlanid){
	}
	public function delete_extreme_vlan($vlanid,$debug=false){
		if($debug==true){
			echo "delete vlan vlan$vlanid\n";
		}
		$this->telnet->DoCommand("delete vlan vlan$vlanid", $this->result_telnet_connect);
		
	}	

	public function remove_port_from_vlan($vlanid,$port_remove){
	}
	public function remove_extreme_port_from_vlan($vlanid,$port_remove){
		//configure vlan vlan$vlanid delete ports  $port_remove
	}
	
	public function add_port_to_vlan($vlanid,$port,$type){
		switch($type){
			case "T":
			break;
			case "U":
			break;
		}
	}

	public function scan_sw_by_ip($ip){
   			    $type=unknown;
				$version=no_version;
				$ports=48;
				$SNMP_COMUNITY_READ=COMUNITY_READ;	
				echo "snmpwalk(".$ip.",".$SNMP_COMUNITY_READ.",".OID_sysDescr.",".")";
				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
				
				if(strlen($result[0])<2){
					$SNMP_COMUNITY_READ=COMUNITY_DEF_DLINK_READ;
				//session.version = SNMP_VERSION_2c;
				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
				}
				if(strlen($result[0])<2){
					$SNMP_COMUNITY_READ=COMUNITY_READ2;
				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
				}
				if(strlen($result[0])<2){
					$type=PAGE_MES_1;
					$version=no_version;
					$ports=48;
					return array("version"=>$version,"type"=>$type,"ports"=>$ports,"ip"=>$ip);
				}
				else{
					$result=$result[0];
					//echo print_r($result);
					/* OID  ????????? ????????, ?? ??????? ??????:
					* dlink : D-Link DES-3026 Fast Ethernet Switch
					* dell :  Ethernet Stackable Switching System  
						PowerConnect 3348 
									?????=>"OID_DELL_sysDescr" 
					* extreem : Summit200-48 - Version 7.3e.2 (Build 4) by Release_Master 02/24/05 19:20:09 
					* SMC: SMC Networks SMC8624T 1
					* */
					$dlink_oid_pattern="/\bD-Link\b/i";
					$dlink_oid_pattern2="/\bDLink\b/i";
					$dlink_oid_pattern3="/\bDES\b/i";
					$extreem_oid_pattern="/\bSummit/i";
					$smc_oid_pattern="/\bSMC/i";
					$dell_oid_pattern="/\bStackable\b/i";
					$dell__oid_pattern="/\bEthernet\b/i";
					$dell2_oid_pattern="/\bPowerConnect\b/i";
					$dell_ports_24_patern="/\d\d24/";
					$dell_ports_48_patern="/\d\d48/";
					$cisco_oid_pattern="/\bcisco\b/i";
					$cisco2_oid_pattern="/\bCISCO \b/i";
					$netgear_FSM_pattern="/\bFSM/i";
					
				if( ( preg_match($dlink_oid_pattern,$result))|| (preg_match($dlink_oid_pattern2,$result)) || (preg_match($dlink_oid_pattern3,$result))){
					$type=dlink;
					$version=$result;
					$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_standart_ports);
					$ports=48;
						if(preg_match("/3026/",$version)){
									$ports=24;
						}elseif(preg_match("/3028/",$version)){
									$ports=24;
						}elseif(preg_match("/3528/",$version)){
									$ports=24;
						}elseif(preg_match("/3526/",$version)){
									$ports=24;
						}elseif(preg_match("/3026/",$version)){
									$ports=24;
						}elseif(preg_match("/3016/",$version)){
									$ports=16;
						}elseif(preg_match("/3010/",$version)){
									$ports=10;
						}
						 
				}
				elseif(preg_match($extreem_oid_pattern,$result)){
					$type="extreem";
					$version=$result;
					$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_standart_ports);
					$ports=48;
					
				}elseif(preg_match($netgear_FSM_pattern,$result)){
					$type="netgear";
					$version=str_replace("Stackable Switch","",$result);
					$ports=48;					
					if(preg_match("/FSM7328S/",$version)){
									$ports=24;
						}elseif(preg_match("/FSM7352S/",$version)){
									$ports=48;
						}
					
				}
				elseif((preg_match($cisco_oid_pattern,$result))|| (preg_match($cisco2_oid_pattern,$result)) ){
					$type="cisco";
					$version=$result;
					//$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_standart_ports);
					$ports=48;
						if(preg_match("/C3500/",$version)){
							$ports=48;
							$version="Cisco C3500XL";
						}else if(preg_match("/WS-C2948/",$version)){
                                                         $ports=48;
                                                         $version="Cisco WS-C2948";
                                                 }
				}
				elseif(preg_match($smc_oid_pattern,$result)){
					$type="SMC";
					$version=$result;
					$ports=48;
						if(preg_match("/8624/",$version)){
									$ports=24;
						}
					
				}
				elseif((preg_match($dell_oid_pattern,$result))||(preg_match($dell__oid_pattern,$result))){
					$result=@snmpwalk($ip,$SNMP_COMUNITY_READ,OID_DELL_enterprises);
						$type="dell_un";
						$version=$result;
						$ports=48;
						foreach($result as $key){
						if(preg_match($dell2_oid_pattern,$key)){
							$version="Dell ".str_replace("\"","",$key);
							$type="dell";
							if(preg_match($dell_ports_48_patern,$key)){
								$ports=48;
							}elseif(preg_match($dell_ports_24_patern,$key)){
								$ports=24;
							}
							$arr=array();
							break;
						}
					}

				}
				echo "type $type \"ports\"=>$ports,\"ip\"=>$ip)\n";
				return array("version"=>str_replace("STRING:","",$version),"type"=>$type,"ports"=>$ports,"ip"=>$ip);
			}
			
	}
	public function arpwatch_macs(){
		$q="DELETE FROM  `freenibs`  WHERE `user` LIKE '10.%'";
		$this->db->query($q);
		$q="DELETE FROM 
				`arpwatch`
				WHERE `date` < FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -604000 )";
		$this->db_nibs->query($q);
		$q="SELECT *
			FROM `arpwatch` ORDER BY `date";
		$this->db_nibs->query($q);
		$n=$this->db_nibs->num_rows();
		if($n>0){
			for($i=0;$i<$n;$i++){
				$row=$this->db_nibs->fetch_array();
				$ip=$row['ip'];
				$mac=$row['arp'];
				$q="INSERT INTO `freenibs` (
						`mac` ,
						`user` ,
						`deposit`
						)
						VALUES (
						'".quote_smart(strtolower($mac))."','".quote_smart($ip)."', '-2048'
						)
						 ON DUPLICATE KEY UPDATE
						`user`='".quote_smart($ip)."'
					;";
				$this->db->query($q);
			}
				
	   }
	}
	public function clear_(){ 	
	$q="DELETE FROM `mac` WHERE `date` < FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -86400 )
		AND `mac` NOT
		IN (
		
		SELECT `mac`
		FROM `freenibs`
		)";
	$this->db->query($q);
		$q="DELETE FROM `mac` WHERE `date` < FROM_UNIXTIME( UNIX_TIMESTAMP( NOW( ) ) -259200 )
		AND `mac` 
		IN (
		
		SELECT `mac`
		FROM `freenibs`
		)";
	$this->db->query($q);
	}
	public function cron (){
		self::clear_();
		self::arpwatch_macs();
		self::users_macs();
		$field_to_select="INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`";
		$q="SELECT 
				".$field_to_select."
			FROM `sw`
				  ORDER BY `id`";
		//echo $q;
		$this->db->query($q);
		$n=$this->db->num_rows();
		$query=array();
		if($n>0){
			echo '#!/bin/sh'."\n";
			$zzz=0;
			for($i=0;$i<$n;$i++){
			$zzz++;	
				$row=$this->db->fetch_array();
				echo "/usr/bin/php -q /var/www/skmsw/cron_one_ip.php ".$row['nas_ip']." >>/dev/null &\n";
				passthru("/usr/bin/php -q /var/www/skmsw/cron_one_ip.php ".$row['nas_ip']." >>/dev/null &");
			if(zzz>4){ sleep(5); $zzz=0; }
			}
		}
		$dis=self::clear_disallow();
	}
	public function cron_one_ip($ip){
		echo "clear_disallow_ip($ip)\n";
		$dis=self::clear_disallow_ip($ip);
		echo " done clear_disallow_ip($ip)\n";
		echo "scan_by_ip_switch($dis,$ip);\n";
		self::scan_by_ip_switch($dis,$ip);
		echo " done scan";
		//$dis=self::clear_disallow();
	}
	public function clear_disallow_ip($ip){
		if(strlen($ip)>0)
		$q="SELECT 
				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
			FROM `sw`
			WHERE `ip`=INET_ATON('".$ip."')";
		else
		$q="SELECT 
				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
			FROM `sw`";
		$this->db->query($q);
		$n=$this->db->num_rows();
		//echo $q."\n";
		if($n>0){
			for($i=0;$i<$n;$i++){
				 $row=$this->db->fetch_array();
					 if(strlen($row['ports'])>0)
						 $disallow[]=array("ip"=>$row['nas_ip'],"ports"=>$row['ports'],"id"=>$row['id']);
						 $dis[$row['nas_ip']]=array("ip"=>$row['nas_ip'],"ports"=>$row['ports'],"id"=>$row['id']);
						 
			}
		}
		foreach($disallow as $disallow_array){
			$ip=$disallow_array['ip'];
			$id=$disallow_array['id'];
			$p=explode(",",$disallow_array['ports']);
			foreach($p as $port_val){
				$q="DELETE FROM `mac` WHERE `sw_id` = '".quote_smart($id)."' AND `port`='".quote_smart($port_val)."'";
				//echo $q."\n";
				$this->db->query($q);
			}
		}
		return $dis;
	}
	public function clear_disallow(){
		$q="SELECT 
				INET_NTOA(`ip`) AS `nas_ip`,`id`,`disallow_ports` AS `ports`
			FROM `sw`";
		$this->db->query($q);
		$n=$this->db->num_rows();
		//echo $n."\n";
		if($n>0){
			for($i=0;$i<$n;$i++){
				 $row=$this->db->fetch_array();
					 if(strlen($row['ports'])>0)
						 $disallow[]=array("ip"=>$row['nas_ip'],"ports"=>$row['ports'],"id"=>$row['id']);
						 $dis[$row['nas_ip']]=array("ip"=>$row['nas_ip'],"ports"=>$row['ports'],"id"=>$row['id']);
						 
			}
		}
		foreach($disallow as $disallow_array){
			$ip=$disallow_array['ip'];
			$id=$disallow_array['id'];
			$p=explode(",",$disallow_array['ports']);
			foreach($p as $port_val){
				$q="DELETE FROM `mac` WHERE `sw_id` = '".quote_smart($id)."' AND `port`='".quote_smart($port_val)."'";
				//echo $q."\n";
				$this->db->query($q);
			}
		}
		return $dis;
	}
	public function users_macs(){	
		$q="SELECT `actions`.`call_from`,`actions`.`user`,`users`.`uid`,`users`.`deposit`,`users`.`credit`
			FROM `actions`, `users`
			WHERE 
				`actions`.`call_from` LIKE '%:%'
			AND	
				`users`.`user`=`actions`.`user`
				AND
				 	`start_time`>FROM_UNIXTIME(UNIX_TIMESTAMP(NOW() )-90000)
			GROUP BY `actions`.`call_from`";
		$this->db_nibs->query($q);
		$n=$this->db_nibs->num_rows();
		if($n>0){
			for($i=0;$i<$n;$i++){
			 $row=$this->db_nibs->fetch_array();
			$m=explode("/",$row['call_from']); //10.200.30.16 / 00:1d:92:f7:46:60 / vlan51
			$mac=strtolower(trim($m[1]));
			$user=$row['user'];
			$uid=$row['uid'];
			$deposit=$row['deposit']+$row['credit'];
			$q="INSERT INTO  `freenibs` (
					`mac` ,
					`user`,
					`uid`,
					`deposit`
					)
					VALUES (
					'".quote_smart($mac)."', '".quote_smart($user)."','".quote_smart($uid)."','".quote_smart($deposit)."'
					)
					ON DUPLICATE KEY UPDATE
					`mac`='".quote_smart($mac)."', `user`='".quote_smart($user)."',`uid`='".quote_smart($uid)."',`deposit`='".quote_smart($deposit)."';";
				$this->db->query($q);
			}
		}
		$q="SELECT `blocked`,`mac_addr`,`user`,`uid`,`deposit`,`credit` FROM `users` WHERE `mac_addr` LIKE '%:%'";
		$this->db_nibs->query($q);
		$n=$this->db_nibs->num_rows();
	if($n>0){
		for($i=0;$i<$n;$i++){
			 $row=$this->db_nibs->fetch_array();
			$mac=strtolower($row['mac_addr']);
			$user=$row['user'];
			$uid=$row['uid'];
			$deposit=$row['deposit']+$row['credit'];
			//echo $user." ".$mac."\n";
			$blocked=$row['blocked'];

			$q="INSERT INTO `freenibs` (
					`mac` ,
					`user`,
					`uid`,
					`deposit`
					)
					VALUES (
					'".quote_smart($mac)."', '".quote_smart($user)."','".quote_smart($uid)."','".quote_smart($deposit)."'
					)
					ON DUPLICATE KEY UPDATE
					`en`='".quote_smart($blocked)."',`mac`='".quote_smart($mac)."', `user`='".quote_smart($user)."',`uid`='".quote_smart($uid)."',`deposit`='".quote_smart($deposit)."';";
					$this->db->query($q);
		}
	  }
	}
	public function user_to_port_sw(){

		
	}
	
	public function scan_macs_from_ip($ip,$nas_id,$dis,$type,$model){
				$disallow=$dis[$ip];
				$p=explode(",",$disallow['ports']);
				$SNMP_COMUNITY_READ=COMUNITY_READ;
				if($ip=='127.0.0.1'){
					//трюк для ЦИСКИ, так как ей надо указывать комьюнити в виде community@vlan
					 $SNMP_COMUNITY_READ="public@25";
				}
				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
				if(strlen($result[0])<2){
					$SNMP_COMUNITY_READ=COMUNITY_DEF_DLINK_READ;
					$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
				}
				if(strlen($result[0])<2){
					$SNMP_COMUNITY_READ=COMUNITY_READ2;
				$result=snmpwalk($ip,$SNMP_COMUNITY_READ,OID_sysDescr);
				}
				echo "SNMP_COMUNITY_READ $SNMP_COMUNITY_READ\n";
				if(strlen($result[0])<2){
					return array();
				}
				else{
					if($type=="cisco")
						$res=snmprealwalk($ip,$SNMP_COMUNITY_READ,OID_cisco_mac_on_ports);
					else{
						//$res=snmp2_real_walk($ip,$SNMP_COMUNITY_READ,OID_mac_on_ports);
						$res=snmprealwalk($ip,$SNMP_COMUNITY_READ,OID_mac_on_ports);
						//print_r($res);
					}

					/*  old cisco
					 $res=snmprealwalk($ip,"public@54",".1.3.6.1.2.1.17.4.3.1.2");
                                         foreach ($res as $ind=>$port){
                                             $arr=explode('.',$ind);
                                                $c=count($arr);
                                                 $port=explode(':',$port);
                                                 $port_temp=$port;
                                                 $port=(int)$port[1];
                                         if($ip=='172.16.2.26'){
                                                $port=$cisco_rp[$port];
                                          }

                                          $mc=dec_hex($arr[$c-6]).':'.dec_hex($arr[$c-5]).':'.dec_hex($arr[$c-4]).':'.dec_hex($arr[$c-3]).':'.dec_hex($arr[$c-2]).':'.dec_hex($arr[$c-1]);
                                                 $mac=strtolower($mc);
                                             $main[$mac]=$port;
                                             echo $mac." - $port - $port_t[0]--.1.3.6.1.2.1.17.1.4.1.2.".$port."\n";
                                         }
					*/

					foreach ($main as $mac=>$port){
						if(!(in_array($port,$p))){
					    $query="
					     INSERT INTO `mac` (
							
							`mac` ,
							`sw_id`,
							`port`,
							`date`
							)
							VALUES (
							'".quote_smart($mac)."' , '".quote_smart($nas_id)."', '".quote_smart($port)."',NOW()
							)
							ON DUPLICATE KEY UPDATE
							`mac`='".quote_smart($mac)."' , 
							`sw_id`='".quote_smart($nas_id)."', 
							`port`='".quote_smart($port)."',
							`date`=NOW();";
							
					    $this->db->query($query);
					}
					}
										
				}
	}
	
	public function scan_all_switches($dis){
		$field_to_select="INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`";
		$q="SELECT 
				".$field_to_select."
			FROM `sw`
				  ORDER BY `id`";
		$this->db->query($q);
		$n=@$this->db->num_rows();
		$query=array();
		if($n>0){
			for($i=0;$i<$n;$i++){
				$row=$this->db->fetch_array();
				$sw=self::scan_sw_by_ip($row['nas_ip'],$dis);
				$switches[]=array(
						"ip"=>$row['nas_ip'],
						"id"=>$row['id'],
						"type"=>$row['type'],
						"model"=>$row['model'],
						"disallow_ports"=>$row['disallow_ports']
						);
				
				echo "process ".$row['nas_ip']."\n";
				if($sw['type']!="unknown"){
				$q1="UPDATE
					`sw`	SET
							`type`='".quote_smart($sw['type'])."',  
							`model`='".quote_smart($sw['version'])."', 
							`ports`='".quote_smart($sw['ports'])."'
					WHERE
						`id`='".quote_smart($row['id'])."'";
				$query[]=array("d"=>$q,"u"=>$q1);
				}
			}
			foreach($query as $qw){
				$this->db->query($qw['u']);
			}
			foreach($switches as $switch){
				echo "process mas on ".$switch['ip']." id:".$switch['id']."\n";
				self::scan_macs_from_ip($switch['ip'],$switch['id'],$dis,$switch['type'],$switch['model']);
			}
		}
		if(DEBUG_DB=="true")
					echo $this->db->mysql_error();	
	}
	public function scan_by_ip_switch($dis,$ip){
		$field_to_select="INET_NTOA(`ip`) AS `nas_ip`,`id`,`type`,`name`,`model` AS `version`,`ports`";
		$q="SELECT 
				".$field_to_select."
			FROM `sw`
			WHERE
				`ip`=INET_ATON('".$ip."')
				  ORDER BY `id`";
		$this->db->query($q);
		$n=$this->db->num_rows();
		$query=array();
		if($n>0){
			
			for($i=0;$i<$n;$i++){
				$row=$this->db->fetch_array();
				$sw=self::scan_sw_by_ip($row['nas_ip'],$dis);
				$switches[]=array(
						"ip"=>$row['nas_ip'],
						"id"=>$row['id'],
						"type"=>$row['type'],
						"model"=>$row['model'],
						"disallow_ports"=>$row['disallow_ports']
						);
				
				echo "process ".$row['nas_ip']."\n";
				$q="D ELETE FROM `sw` WHERE `id`='".quote_smart($row['id'])."';";
				$q1="UPDATE
					`sw`	SET
							`type`='".quote_smart($sw['type'])."',  
							`model`='".quote_smart($sw['version'])."', 
							`ports`='".quote_smart($sw['ports'])."'
					WHERE
						`id`='".quote_smart($row['id'])."'";
				$query[]=array("d"=>$q,"u"=>$q1);				
			}
			foreach($query as $qw){
				//echo $qw['u']."\n";
				$this->db->query($qw['u']);
			}
			foreach($switches as $switch){
				echo "process on switch: ".$switch['ip']." id:".$switch['id']."\n";
				self::scan_macs_from_ip($switch['ip'],$switch['id'],$dis,$switch['type'],$switch['model']);
			}
		}
		if(DEBUG_DB=="true")
					echo $this->db->mysql_error();	
	}
	
	public function show_all_sw(){
	$field_to_select="
			`freenibs`.`mac`,`freenibs`.`user`,`freenibs`.`uid`,`freenibs`.`deposit`,
			`mac`.`port`,`mac`.`sw_id`,
			`sw`.`name`,`sw`.`id`, INET_NTOA(`sw`.`ip`) AS `nas_ip`,`sw`.`type`,`sw`.`model` AS `version`,`sw`.`ports`,`sw`.`addr`
			 ";					
	switch($_GET['sort']){
	case "ul":
		$q="SELECT 
				".$field_to_select."
			FROM `freenibs`,`mac`,`sw`
			WHERE
					`mac`.`mac`=`freenibs`.`mac`
				AND
					`sw`.`id`=`mac`.`sw_id`	
				  ORDER BY `sw`.`id`	";
	break;
	case "id":
		if(strlen($_GET['id'])>1){
			$add_=" 
					`id`='".quote_smart($_GET['id'])."'";
		}
		$q="SELECT  
				".$field_to_select."
			FROM 
					`freenibs`,`mac`,`sw`
			WHERE
				".$add_."
				AND
					`mac`.`mac`=`freenibs`.`mac`
				AND
					`sw`.`id`=`mac`.`sw_id`	
				  ORDER BY 
				  		`sw`.`id`,`sw`.`ports`
				  		";
			//echo $q;
	break;
	case "type":
		switch($_GET['sub_type']){
		default:
			if(strlen($_GET['sub_type'])>1){
				$add_="
					 
						`sw`.`type` ='".quote_smart($_GET['sub_type'])."'
						";
			}
			
			$q="SELECT  
				".$field_to_select."
			FROM 
					`freenibs`,`mac`,`sw`
			WHERE
					`mac`.`mac`=`freenibs`.`mac`
				AND
					`sw`.`id`=`mac`.`sw_id`	
				AND
				  		
  			      ".$add_."
				
				
				  ORDER BY 
				  		`sw`.`type`,`sw`.`name`,`mac`.`port`
				  		";
		break;
		}
	break;


	default:
		$q="SELECT  
				".$field_to_select."
			FROM 
					`freenibs`,`mac`,`sw`
			WHERE
					`mac`.`mac`=`freenibs`.`mac`
				AND
					`sw`.`id`=`mac`.`sw_id`	
				
				  ORDER BY `sw`.`id`,`mac`.`port`
				  		";
		
	break;		
	}
		$this->db->query($q);
		$n=$this->db->num_rows();
		$c=0;
			if($n>0){
				
				$nasid=-1;
				$nastemp=-1;
				$ports=array();

				$n_of_ports=48;
						$header_sw.="

<td>
  <a href=\"?sort=ul\">Àäðåññ</a>
  
  <td>
    <td>
      <a href=\"?sort=id\">ID</a>
      
      <td>
        <td>
          <a href=\"?sort=type\">type</a>
          
          <td>
            ";
            					
            						echo $header_sw;
            					echo "
            					<div style=\"font-size:12px\"><table  border=\"1px\">
            
            <tr>
              ";
              				if(strlen($_GET['id'])>1) $n++;
              				for($i=0;$i<$n;$i++){
              					if( !( (strlen($_GET['id'])>1)&&($i==$n))){
              					 	 $row=$this->db->fetch_array();
              						$nasid=$row['id'];
              						
              					}
              					else{
              					  $nasid++;
              					 
              					}
              					
              					  	if($i==0) {
              					  		$nasid=$row['id'];
              					  		$nastemp=$nasid;
              							$temp_nas_ip=$row['nas_ip'];
              							$temp_name=$row['name'];
              							$temp_type=$row['type'];
              							$temp_id=$row['id'];
              							$temp_ports=$row['ports'];
              							$temp_version=$row['version'];
              					  		if(preg_match("/\bVersion/i",$row['version'])){
              									$temp_version=explode("Version",$row['version']);
              									$row['version']=$temp_version['0'];
              									$temp_version=$row['version'];
              								}
              					  	}
              					  	
              					    if($nastemp!=$nasid){
              							if($_GET['snmp']=="true")
              								$sw_res=self::scan_sw_by_ip($temp_nas_ip);
              
              				      			  if( ($temp_ports>0)&&($temp_ports<100))
              				      			  	$n_of_ports=$temp_ports;
              				      			  else
              				      			  	$n_of_ports=48;
              
              								$c++;
              								if($c>1){
              									$c=0;
              									$td_pre=" border=\"1px\" ";
              								}
              								else {
              									$td_pre=' ';
              								}
              								echo "
              				      			
              				      			<tr ".$td_pre.">
              				      				 <td  rowspan=\"2\" nowrap=\"nowrap\" bgcolor=\"#999999\">
              								<a href=\"http://".$temp_nas_ip."\"  target=\"_blank\">".$temp_name."</a>
              									<br />".str_replace("Fast Ethernet Switch","",$temp_version)."
              							</td>
              							<td rowspan=\"2\">
              								<a href=\"?sort=id&id=".$temp_id."\" target=\"_blank\"> ".$temp_id."</a></td>
              							<td ".$td_pre." rowspan=\"2\">
              								<a href=\"?sort=type&sub_type=".$temp_type."\">
              										".$temp_type."
              								</a>
              							</td>";
              				      			$nastemp=$nasid;	
              								$header_ports='';
              				      			for($i=1;$i<$n_of_ports+1;$i++){
              									
              				      				$header_ports.="<td ".$td_pre."  bgcolor=\"#CCCCCC\">".$i."</td>";
              				      			}
              							
              				      			echo "	<tr ".$td_pre.">$header_ports
            </tr>
            									
            
            <tr>
              <td>
                
              </td>
              									
              
              <td>
                
              </td>
              									
              
              <td>
                
              </td>	";
              				      			for($i=1;$i<$n_of_ports+1;$i++){
              				      				if(strlen($ports[$i])>0){
              									echo "
              
              <td>
                ".$ports[$i]."
              </td>";
              					      					
              				      				}
              				      				else{
              				      					echo "<td bgcolor=\"#FFFF00\"> </td>";
              				      				}
              				      				
              				      			}
              			      				echo "
            </tr>";
            			      				$ports='';
            			      				$ports=array();
            			      		}else{
            			      			
            							$temp_nas_ip=$row['nas_ip'];
            							$temp_name=$row['name'];
            							$temp_type=$row['type'];
            							$temp_id=$row['id'];
            							$temp_ports=$row['ports'];
            							$temp_version=$row['version'];
            			      			if(preg_match("/\bVersion/i",$row['version'])){
            									$temp_version=explode("Version",$row['version']);
            									$row['version']=$temp_version['0'];
            									$temp_version=$row['version'];
            								}
            			      		}
            
            
            					if(!(strlen($row['user'])>0))
            							$row['user']=$row['mac'];
            					if($row['deposit']>=0){
            						$ports[$row['port']].="<a href=\"http://admin/edit_user.php?uid=".$row['uid']."\" target=\"_blank\" >".$row['user']."</a>
            
            <br />";	
            					}else{
            						$ports[$row['port']].="<b><a style=\"color: red\" href=\"https://admin/edit_user.php?uid=".$row['uid']."\" target=\"_blank\">".$row['user']."</a></b><br />";	
            					}
            				}
            				if($_GET['id']>1){
            					switch($_GET['snmp']){
            					case "true":
            						echo "</tr>
            						</table></div>";
            						echo "
            
            <p>
              ".PAGE_MES_2.":
            </p>
            						
            
            <p>
              ".PAGE_MES_3.":	$sw_res[type]
            </p>
            						
            
            <p>
              ".PAGE_MES_4."	$sw_res[version]
            </p>
            						
            
            <p>
              ".PAGE_MES_5."	$sw_res[ports]
            </p>
            						
            
            <p>
              Ip	$sw_res[ip]
            </p>";
            					break;
            					default:
            						echo "</tr>
            						</table></div>";
            						echo "
            						
            
            <p>
              <a href=\"?sort=id&id=".$temp_id."&snmp=true\">Get data by snmp</a>
              						
              
              <p>
                ".PAGE_MES_2.":
              </p>
              						
              
              <p>
                ".PAGE_MES_3.":	$temp_type
              </p>
              						
              
              <p>
                ".PAGE_MES_4."	
              </p>
              						
              
              <p>
                ".PAGE_MES_5."	
              </p>
              						
              
              <p>
                Ip	$temp_nas_ip
              </p>";
              					break;
              					}
              				}
              			}
              		
              		
              	}
              }
              ?>
              
              </pre>
              
              
              <p>
                pages/top.php:
              </p>
              
              
              <pre lang="php" line="1">
<?php ?>

      
          
        
</pre>


<p>
  pages/bottom.php:
</p>


<pre lang="php" line="1">
<?php ?>
&lt;/html>
</pre>


<p>
  cron.php:
</p>


<pre lang="php" line="1">
#!/usr/bin/php
<?php
 include_once("engine.php");
  $db=new db_mysql(HOST,USER,DB_PASS,DB,DEBUG_DB);
 if(DEBUG_DB=="true") echo '$db obj is ok'."<br>\n";
 
 $db->SET_NAMES("utf8");
 
 $db_nibs=new db_mysql(HOST_NIBS,USER_NIBS,DB_NIBS_PASS,DB_NIBS,DEBUG_DB);
 if(DEBUG_DB=="true") echo '$db_nibs obj is ok'."

<br />\n";
 //$db_nibs->SET_NAMES("cp1251");
 //$db->SET_COLLATE("latin1_swedish_ci");
 //$db_nibs->SET_COLLATE("cp1251_general_ci");
 $db_nibs->SET_NAMES("utf8");
 $page=new page(&$db,&$db_nibs);
 
 $page->cron();
 
?>
</pre>


<p>
  cron_one_ip.php:
</p>


<pre lang="php" line="1">
#!/usr/bin/php -q
<?php 
$path="/var/www/skmsw";
 $ip=$argv['1'];
if(file_exists($path."/pid/".str_replace(".","",$ip))){
	echo "exist";
}
else{
$f=fopen($path."/pid/".str_replace(".","",$ip),"w"); 
fwrite($f,"do"); 
include_once("engine.php");
  $db=new db_mysql(HOST,USER,DB_PASS,DB,DEBUG_DB);
 if(DEBUG_DB=="true") echo '$db obj is ok'."<br>\n";
 	 $db->SET_NAMES("utf8");
 
 $db_nibs=new db_mysql(HOST_NIBS,USER_NIBS,DB_NIBS_PASS,DB_NIBS,DEBUG_DB);
 if(DEBUG_DB=="true") echo '$db_nibs obj is ok'."

<br />\n";
 //$db_nibs->SET_NAMES("cp1251");
 //$db->SET_COLLATE("latin1_swedish_ci");
 //$db_nibs->SET_COLLATE("cp1251_general_ci");
 $db_nibs->SET_NAMES("utf8");
 $page=new page(&$db,&$db_nibs);
 $page->cron_one_ip($ip);



unlink($path."/pid/".str_replace(".","",$ip)); 
}
 ?>

</pre>